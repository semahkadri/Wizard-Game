<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#8B5CF6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Wizard â€¢ Complete Card Game</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="./icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./icons/icon-512x512.png">
    <link rel="shortcut icon" href="./icons/icon-192x192.png">

    <!-- PWA -->
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="./icons/icon-192x192.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;900&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Socket.IO for Online Multiplayer -->
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js" crossorigin="anonymous"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            /* Primary Colors */
            --primary: #8B5CF6;
            --primary-light: #A78BFA;
            --primary-dark: #7C3AED;
            --secondary: #06B6D4;
            --secondary-light: #22D3EE;
            --accent: #EC4899;
            --success: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;

            /* Suit Colors */
            --dwarf: #8B4513;
            --dwarf-light: #CD853F;
            --elf: #228B22;
            --elf-light: #90EE90;
            --giant: #DC143C;
            --giant-light: #FF6347;
            --human: #1E90FF;
            --human-light: #87CEEB;
            --wizard: #9400D3;
            --wizard-gold: #FFD700;
            --jester: #FF1493;
            --jester-light: #FFB6C1;

            /* Backgrounds */
            --bg-primary: #0F172A;
            --bg-secondary: #1E293B;
            --bg-tertiary: #334155;
            --bg-card: rgba(30, 41, 59, 0.9);
            --bg-glass: rgba(139, 92, 246, 0.1);

            /* Text */
            --text-primary: #F1F5F9;
            --text-secondary: #CBD5E1;
            --text-tertiary: #94A3B8;

            /* Game Table */
            --table-felt: #1B4332;
            --table-border: #2D6A4F;

            /* Shadows */
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.4);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.5);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.6);
            --glow-primary: 0 0 30px rgba(139, 92, 246, 0.6);
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 50%, #0F172A 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* ===== SETUP SCREEN ===== */
        #setupScreen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            padding: 2rem 1rem;
            padding-bottom: 4rem;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .setup-container {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 2rem 2.5rem;
            padding-bottom: 2.5rem;
            max-width: 550px;
            width: 100%;
            border: 2px solid rgba(139, 92, 246, 0.3);
            box-shadow: var(--shadow-lg), var(--glow-primary);
            margin: 1rem auto;
            margin-bottom: 3rem;
        }

        .setup-title {
            font-family: 'Orbitron', monospace;
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 1rem;
        }

        .setup-subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .player-count-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .player-count-btn {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            padding: 1.5rem;
            border: 3px solid rgba(139, 92, 246, 0.3);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        .player-count-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(139, 92, 246, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .player-count-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .player-count-btn:hover {
            border-color: var(--primary);
            transform: translateY(-5px) scale(1.05);
            box-shadow: var(--glow-primary);
        }

        .player-count-btn.selected {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            border-color: var(--primary);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 0 40px rgba(139, 92, 246, 0.8);
            animation: pulse-selected 2s ease-in-out infinite;
        }

        @keyframes pulse-selected {
            0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.6); }
            50% { box-shadow: 0 0 40px rgba(139, 92, 246, 1); }
        }

        .player-names {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .player-input-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .player-number {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 900;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            border-radius: 12px;
            flex-shrink: 0;
        }

        .player-name-input {
            flex: 1;
            font-family: 'Inter', sans-serif;
            font-size: 1.1rem;
            padding: 1rem 1.5rem;
            background: var(--bg-secondary);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .player-name-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: var(--glow-primary);
        }

        .btn {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            padding: 1.2rem 2.5rem;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            position: relative;
            overflow: hidden;
        }

        .btn-start {
            width: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            box-shadow: var(--shadow-md), var(--glow-primary);
        }

        .btn-start:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg), 0 0 40px rgba(139, 92, 246, 0.8);
        }

        .btn-start:active {
            transform: translateY(0);
        }

        .trump-choice-btn {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 1.1rem;
            padding: 2rem 1rem;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .trump-choice-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .trump-choice-btn:active {
            transform: translateY(-2px) scale(1.02);
        }

        /* ===== GAME TABLE ===== */
        #gameScreen {
            display: none;
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        .game-table {
            width: 100%;
            height: 100%;
            position: relative;
            background:
                radial-gradient(circle at 50% 50%, rgba(27, 67, 50, 0.4) 0%, transparent 70%),
                linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
        }

        /* Game Header - Compact and Professional */
        .game-header {
            position: fixed;
            top: 10px;
            left: 10px;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 0.6rem;
            padding: 0.4rem 0.8rem;
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 8px;
            border: 2px solid rgba(139, 92, 246, 0.3);
            box-shadow: var(--shadow-md);
            z-index: 600;
            max-width: 600px;
            flex-wrap: nowrap;
        }

        .new-game-btn {
            font-family: 'Orbitron', monospace;
            font-size: 0.7rem;
            font-weight: 700;
            padding: 0.35rem 0.7rem;
            background: linear-gradient(135deg, #DC143C 0%, #FF6347 100%);
            border: 2px solid #FF6347;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(220, 20, 60, 0.3);
            white-space: nowrap;
        }

        .new-game-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 25px rgba(220, 20, 60, 0.5);
            background: linear-gradient(135deg, #FF1493 0%, #FF69B4 100%);
        }

        .new-game-btn:active {
            transform: translateY(0) scale(0.98);
        }

        .trump-card-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.3rem 0.6rem;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 8px;
            border: 2px solid var(--primary);
        }

        .trump-label {
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-size: 0.7rem;
        }

        .trump-suit {
            font-size: 1.1rem;
            font-weight: 900;
            font-family: 'Orbitron', monospace;
            padding: 0.2rem 0.5rem;
            border-radius: 6px;
            display: inline-block;
            border: 2px solid;
            transition: all 0.3s ease;
            animation: trumpPulse 2s ease-in-out infinite;
        }

        @keyframes trumpPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Trump Suit Colors */
        .trump-suit.dwarf {
            background: linear-gradient(135deg, rgba(139, 69, 19, 0.3), rgba(205, 133, 63, 0.3));
            border-color: #CD853F;
            color: #CD853F;
            box-shadow: 0 0 20px rgba(205, 133, 63, 0.5);
        }

        .trump-suit.elf {
            background: linear-gradient(135deg, rgba(34, 139, 34, 0.3), rgba(144, 238, 144, 0.3));
            border-color: #90EE90;
            color: #90EE90;
            box-shadow: 0 0 20px rgba(144, 238, 144, 0.5);
        }

        .trump-suit.giant {
            background: linear-gradient(135deg, rgba(220, 20, 60, 0.3), rgba(255, 99, 71, 0.3));
            border-color: #FF6347;
            color: #FF6347;
            box-shadow: 0 0 20px rgba(255, 99, 71, 0.5);
        }

        .trump-suit.human {
            background: linear-gradient(135deg, rgba(30, 144, 255, 0.3), rgba(135, 206, 235, 0.3));
            border-color: #87CEEB;
            color: #87CEEB;
            box-shadow: 0 0 20px rgba(135, 206, 235, 0.5);
        }

        .trump-suit.wizard {
            background: linear-gradient(135deg, rgba(148, 0, 211, 0.3), rgba(255, 215, 0, 0.3));
            border-color: #FFD700;
            color: #FFD700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
        }

        .trump-suit.jester {
            background: linear-gradient(135deg, rgba(255, 20, 147, 0.3), rgba(255, 182, 193, 0.3));
            border-color: #FF69B4;
            color: #FF69B4;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.5);
        }

        .trump-suit.none {
            background: rgba(128, 128, 128, 0.2);
            border-color: #888;
            color: #888;
            box-shadow: none;
            animation: none;
        }

        .round-display {
            font-family: 'Orbitron', monospace;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--primary);
            white-space: nowrap;
        }

        .phase-display {
            font-size: 0.7rem;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        /* Center Trick Area - LARGE PROFESSIONAL TABLE */
        .trick-area {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 500px;
            height: 500px;
            background:
                radial-gradient(circle, rgba(27, 67, 50, 0.8) 0%, rgba(27, 67, 50, 0.6) 100%);
            border-radius: 50%;
            border: 8px solid var(--table-border);
            box-shadow:
                inset 0 4px 20px rgba(0, 0, 0, 0.6),
                0 10px 40px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
            pointer-events: none;
        }

        .trick-cards-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
        }

        .trick-card-wrapper {
            position: absolute;
            z-index: 700;
        }

        .trick-card-wrapper .card {
            pointer-events: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
            position: relative;
            z-index: 701;
        }

        /* Player Areas (4 positions around table) */
        .player-area {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            z-index: 100;
        }

        /* PROFESSIONAL PLAYER POSITIONING - MASSIVE SPACING for 500px table + max 20 cards */

        /* Bottom Player (Main Player) - Cards extend UPWARD - FAR BELOW TABLE */
        .player-area.bottom {
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            max-width: 1200px;
        }

        /* Top Player - Cards extend DOWNWARD - BELOW GAME HEADER */
        .player-area.top {
            top: 4rem;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Left Player - Cards extend RIGHTWARD */
        .player-area.left {
            left: 2rem;
            top: 50%;
            transform: translateY(-50%);
        }

        /* Right Player - Cards extend LEFTWARD */
        .player-area.right {
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
        }

        /* Top-Left Player - Diagonal positioning - BELOW GAME HEADER */
        .player-area.top.left {
            top: 4rem;
            left: 2%;
            transform: none;
        }

        /* Top-Right Player - Diagonal positioning - BELOW GAME HEADER */
        .player-area.top.right {
            top: 4rem;
            right: 2%;
            transform: none;
        }

        .player-info {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            padding: 0.4rem 0.8rem;
            border-radius: 12px;
            border: 2px solid rgba(139, 92, 246, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.4rem;
            min-width: 120px;
            opacity: 0.85;
        }

        .player-info.active {
            border-color: var(--primary);
            box-shadow: var(--glow-primary);
            animation: pulseGlow 1.5s ease-in-out infinite;
            opacity: 1 !important;
            transform: scale(1.05);
            transition: transform 0.3s ease;
        }

        @keyframes pulseGlow {
            0%, 100% {
                box-shadow: var(--glow-primary);
                border-color: var(--primary);
            }
            50% {
                box-shadow: 0 0 50px rgba(139, 92, 246, 1), 0 0 80px rgba(139, 92, 246, 0.6);
                border-color: rgba(139, 92, 246, 1);
            }
        }

        .your-turn-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            font-size: 0.75rem;
            font-weight: bold;
            border-radius: 20px;
            margin-top: 0.3rem;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.5);
            animation: bounceIn 0.5s ease, shimmer 2s ease-in-out infinite;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes shimmer {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .player-name {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 0.85rem;
            color: var(--text-primary);
        }

        .player-stats {
            display: flex;
            gap: 0.6rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .player-hand {
            display: flex;
            gap: -40px;
            justify-content: center;
            perspective: 1000px;
        }

        .player-area.bottom .player-hand {
            gap: 0.3rem;
            flex-wrap: wrap;
            max-width: 800px;
        }

        /* Compact other players' hands - EXTRA compact for tiny cards */
        .player-area.top .player-hand,
        .player-area.left .player-hand,
        .player-area.right .player-hand,
        .player-area.top.left .player-hand,
        .player-area.top.right .player-hand {
            gap: -25px;
        }

        /* ===== CARD STYLES ===== */
        .card {
            width: 90px;
            height: 126px;
            position: relative;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
            z-index: 75;
        }

        .card:hover {
            transform: translateY(-20px) scale(1.1);
            z-index: 1000 !important;
        }

        .card.selected {
            transform: translateY(-30px) scale(1.15);
            z-index: 999 !important;
        }

        .card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* Main player cards should be clickable and ABOVE trick area (1) but BELOW trick cards (500) */
        .player-area.bottom .card {
            cursor: pointer;
            z-index: 110;
        }

        /* Other player cards - SMALL and SEMI-TRANSPARENT */
        .player-area.top .card,
        .player-area.left .card,
        .player-area.right .card,
        .player-area.top.left .card,
        .player-area.top.right .card {
            cursor: default;
            z-index: 105;
            width: 55px;
            height: 77px;
            opacity: 0.75;
        }

        /* Make opponent card content smaller */
        .player-area.top .card-value,
        .player-area.left .card-value,
        .player-area.right .card-value,
        .player-area.top.left .card-value,
        .player-area.top.right .card-value {
            font-size: 0.7rem;
        }

        .player-area.top .card-symbol-small,
        .player-area.left .card-symbol-small,
        .player-area.right .card-symbol-small,
        .player-area.top.left .card-symbol-small,
        .player-area.top.right .card-symbol-small {
            font-size: 0.6rem;
        }

        .player-area.top .card-symbol-large,
        .player-area.left .card-symbol-large,
        .player-area.right .card-symbol-large,
        .player-area.top.left .card-symbol-large,
        .player-area.top.right .card-symbol-large {
            font-size: 1.4rem;
        }

        .player-area.top .card-suit-name,
        .player-area.left .card-suit-name,
        .player-area.right .card-suit-name,
        .player-area.top.left .card-suit-name,
        .player-area.top.right .card-suit-name {
            font-size: 0.35rem;
        }

        .card.playing {
            animation: playCard 0.8s ease;
        }

        @keyframes playCard {
            0% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-100px) scale(1.2) rotate(5deg); }
            100% { transform: translate(var(--target-x), var(--target-y)) scale(0.9); }
        }

        .card-face {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            background: white;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 3px solid;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .card-back {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .card-back::before {
            content: '';
            position: absolute;
            inset: 10px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
        }

        .card-corner {
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.15rem;
        }

        .card-corner.top-left {
            position: absolute;
            top: 0;
            left: 0;
        }

        .card-corner.bottom-right {
            position: absolute;
            bottom: 0;
            right: 0;
            transform: rotate(180deg);
        }

        .card-value {
            font-family: 'Orbitron', monospace;
            font-weight: 900;
            font-size: 1.3rem;
            line-height: 1;
        }

        .card-symbol-small {
            font-size: 1.2rem;
            line-height: 1;
        }

        .card-center {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.3rem;
        }

        .card-symbol-large {
            font-size: 3rem;
            line-height: 1;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .card-suit-name {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Special card styles */
        .card-face.wizard {
            background: linear-gradient(135deg, #1a0033 0%, #330066 50%, #1a0033 100%);
            border-color: var(--wizard-gold);
        }

        .card-face.wizard .card-value,
        .card-face.wizard .card-suit-name {
            color: var(--wizard-gold);
        }

        .card-face.wizard .card-center {
            position: relative;
        }

        .card-face.wizard .card-symbol-large {
            animation: wizardGlow 2s ease-in-out infinite;
        }

        @keyframes wizardGlow {
            0%, 100% { filter: drop-shadow(0 0 10px gold); }
            50% { filter: drop-shadow(0 0 20px gold); }
        }

        .card-face.jester {
            background: linear-gradient(135deg, #ff69b4 0%, #ff1493 50%, #ff69b4 100%);
            border-color: var(--jester);
        }

        /* ===== BIDDING MODAL ===== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(5px);
            display: none;
            align-items: flex-start;
            justify-content: center;
            padding-top: 10vh;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: rgba(18, 18, 28, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 2rem;
            max-width: 450px;
            width: 90%;
            border: 3px solid rgba(139, 92, 246, 0.5);
            box-shadow: var(--shadow-lg), var(--glow-primary), 0 0 60px rgba(139, 92, 246, 0.4);
            animation: scaleIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }

        .modal-minimize-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(139, 92, 246, 0.2);
            border: 2px solid var(--primary);
            color: var(--primary);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 2rem;
            font-weight: 900;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-bottom: 8px;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .modal-minimize-btn:hover {
            background: rgba(139, 92, 246, 0.4);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.6);
        }

        .bidding-minimized-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-family: 'Orbitron', monospace;
            font-size: 1rem;
            font-weight: 700;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            border: 3px solid var(--primary);
            color: white;
            border-radius: 16px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.5);
            animation: pulse 2s ease-in-out infinite;
            z-index: 9999;
            transition: all 0.3s ease;
        }

        .bidding-minimized-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 30px rgba(139, 92, 246, 0.7);
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 4px 20px rgba(139, 92, 246, 0.5); }
            50% { box-shadow: 0 4px 40px rgba(139, 92, 246, 1); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-title {
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            font-weight: 900;
            color: var(--primary);
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .modal-text {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .bid-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .bid-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            border: none;
            color: white;
            font-size: 2rem;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bid-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--glow-primary);
        }

        .bid-btn:active {
            transform: scale(0.95);
        }

        .bid-value {
            font-family: 'Orbitron', monospace;
            font-size: 4rem;
            font-weight: 900;
            color: var(--primary);
            min-width: 120px;
            text-align: center;
        }

        /* Bid History Panel */
        .bid-history-panel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(18, 18, 28, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            border: 2px solid rgba(139, 92, 246, 0.4);
            box-shadow: var(--shadow-lg), 0 0 30px rgba(139, 92, 246, 0.3);
            z-index: 90;
            max-width: 180px;
            animation: slideInLeft 0.4s ease;
        }

        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .bid-history-title {
            font-family: 'Orbitron', monospace;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .bid-history-item {
            display: flex;
            justify-content: space-between;
            padding: 0.4rem 0.6rem;
            margin-bottom: 0.4rem;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 6px;
            border-left: 3px solid var(--primary);
            font-size: 0.85rem;
        }

        .bid-history-item .player-name-bid {
            font-weight: 600;
            color: var(--text-primary);
        }

        .bid-history-total {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 2px solid rgba(139, 92, 246, 0.3);
            display: flex;
            justify-content: space-between;
            font-weight: 700;
            font-size: 0.95rem;
        }

        .bid-history-total .total-label {
            color: var(--accent);
        }

        .bid-history-total .total-value {
            color: var(--wizard-gold);
            font-family: 'Orbitron', monospace;
        }

        /* Rules Modal Styles */
        .rules-tab {
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 0.85rem;
            padding: 0.75rem 1rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .rules-tab:hover {
            color: var(--text-primary);
            background: rgba(139, 92, 246, 0.1);
        }

        .rules-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: rgba(139, 92, 246, 0.1);
        }

        .rules-content {
            display: none;
        }

        .rules-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .rules-section {
            background: rgba(139, 92, 246, 0.05);
            border-left: 4px solid var(--primary);
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
        }

        .rules-section h4 {
            color: var(--primary);
            font-family: 'Orbitron', monospace;
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
        }

        .rules-section p, .rules-section li {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 0.5rem;
        }

        .rules-section ul, .rules-section ol {
            padding-left: 1.5rem;
        }

        .rules-section table {
            margin-top: 0.75rem;
        }

        /* RTL support for Tunisian Arabic tab */
        #tunisianRules .rules-section {
            border-left: none;
            border-right: 3px solid var(--primary);
        }

        #tunisianRules ul, #tunisianRules ol {
            padding-left: 0;
            padding-right: 1.5rem;
        }

        .rules-section table th {
            color: var(--primary);
            font-weight: 700;
        }

        .rules-section table td {
            color: var(--text-secondary);
        }

        .modal-close-btn:hover {
            background: rgba(255,255,255,0.2) !important;
            transform: rotate(90deg);
        }

        .bid-history-item .bid-amount {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            color: var(--accent);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1400px) {
            .trick-area {
                width: 450px;
                height: 450px;
            }

            .player-area.bottom {
                bottom: 2rem;
                max-width: 1000px;
            }

            .player-area.top {
                top: 4rem;
            }

            .player-area.left {
                left: 2rem;
            }

            .player-area.right {
                right: 2rem;
            }

            .player-area.top.left,
            .player-area.top.right {
                top: 4rem;
                left: 2%;
            }

            .player-area.top.right {
                right: 2%;
                left: auto;
            }
        }

        @media (max-width: 1024px) {
            .trick-area {
                width: 380px;
                height: 380px;
            }

            .player-area.bottom {
                bottom: 2rem;
                max-width: 800px;
            }

            .player-area.top {
                top: 3.5rem;
            }

            .player-area.left {
                left: 1.5rem;
            }

            .player-area.right {
                right: 1.5rem;
            }

            .player-area.top.left,
            .player-area.top.right {
                top: 3.5rem;
                left: 2%;
            }

            .player-area.top.right {
                right: 2%;
                left: auto;
            }
        }

        @media (max-width: 768px) {
            .card {
                width: 65px;
                height: 91px;
            }

            .card-value {
                font-size: 0.8rem;
            }

            .card-symbol-small {
                font-size: 0.7rem;
            }

            .card-symbol-large {
                font-size: 1.6rem;
            }

            .card-suit-name {
                font-size: 0.4rem;
            }

            .trick-area {
                width: 260px;
                height: 260px;
            }

            .player-area.bottom {
                bottom: 1.5rem;
                max-width: 500px;
            }

            .player-area.top {
                top: 3rem;
            }

            .player-area.left {
                left: 1rem;
            }

            .player-area.right {
                right: 1rem;
            }

            .player-area.top.left,
            .player-area.top.right {
                top: 3rem;
                left: 1%;
            }

            .player-area.top.right {
                right: 1%;
                left: auto;
            }

            .player-info {
                min-width: 130px;
                padding: 0.4rem 0.7rem;
            }

            .player-name {
                font-size: 0.8rem;
            }

            .player-stats {
                font-size: 0.65rem;
                gap: 0.4rem;
            }
        }

        /* ===== PARTICLE SYSTEM ===== */
        .particle {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            animation: fall linear forwards;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Loading Animation */
        .loading {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 80px;
            height: 80px;
            border: 6px solid rgba(139, 92, 246, 0.3);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== CONFETTI & CELEBRATIONS ===== */
        .confetti {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            border-radius: 50%;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(0) rotateZ(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotateZ(720deg);
                opacity: 0;
            }
        }

        .elimination-particle {
            position: fixed;
            font-size: 2rem;
            pointer-events: none;
            z-index: 9999;
            animation: eliminationExplode 1s ease-out forwards;
        }

        @keyframes eliminationExplode {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
            }
            100% {
                transform: translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) scale(1);
                opacity: 0;
            }
        }

        @keyframes sparkleExplode {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
            }
            100% {
                transform: translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) scale(1);
                opacity: 0;
            }
        }

        /* Statistics Dashboard */
        .stats-dashboard {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            padding: 0.75rem 1rem;
            border-radius: 12px;
            border: 2px solid rgba(139, 92, 246, 0.3);
            max-width: 180px;
            z-index: 90;
        }

        .stats-title {
            font-family: 'Orbitron', monospace;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .stat-value {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        /* Elimination Modal */
        #eliminationModal .modal {
            border: 3px solid var(--danger);
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, var(--bg-secondary) 100%);
        }

        .eliminated-avatar {
            filter: grayscale(1) opacity(0.5);
            animation: skull-bounce 0.5s ease-in-out;
        }

        @keyframes skull-bounce {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(-10deg); }
            75% { transform: translateY(-10px) rotate(10deg); }
        }

        /* Winner Modal Enhancement */
        #winnerModal .modal {
            border: 3px solid var(--wizard-gold);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, var(--bg-secondary) 100%);
            animation: winner-glow 2s ease-in-out infinite;
        }

        @keyframes winner-glow {
            0%, 100% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 60px rgba(255, 215, 0, 0.8); }
        }

        /* ===== TOAST NOTIFICATION SYSTEM ===== */
        .toast-container {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 10001;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            pointer-events: none;
        }

        .toast {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            padding: 1.25rem 1.75rem;
            border-radius: 16px;
            border: 2px solid;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 300px;
            animation: toastSlideIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            pointer-events: all;
            position: relative;
            overflow: hidden;
        }

        .toast::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: currentColor;
        }

        .toast.error {
            border-color: var(--danger);
            color: var(--danger);
        }

        .toast.success {
            border-color: var(--success);
            color: var(--success);
        }

        .toast.info {
            border-color: var(--primary);
            color: var(--primary);
        }

        .toast.warning {
            border-color: var(--warning);
            color: var(--warning);
        }

        .toast-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .toast-message {
            flex: 1;
            color: var(--text-primary);
            font-weight: 600;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.5rem;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .toast-close:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(90deg);
        }

        @keyframes toastSlideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes toastSlideOut {
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        /* ===== CARD SHAKE ANIMATION ===== */
        @keyframes cardShake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px) rotate(-2deg); }
            20%, 40%, 60%, 80% { transform: translateX(10px) rotate(2deg); }
        }

        @keyframes cardInvalidGlow {
            0%, 100% { box-shadow: 0 0 0 rgba(239, 68, 68, 0); }
            50% { box-shadow: 0 0 30px rgba(239, 68, 68, 1); }
        }

        .card.invalid {
            animation: cardShake 0.5s ease, cardInvalidGlow 0.5s ease;
            border-color: var(--danger) !important;
        }

        /* ===== CARD FLYING ANIMATION ===== */
        .card.flying {
            animation: cardFlyToWinner 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards !important;
            z-index: 1000 !important;
        }

        @keyframes cardFlyToWinner {
            0% {
                transform: translate(0, 0) scale(1) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: translate(var(--fly-x-mid), var(--fly-y-mid)) scale(1.3) rotate(var(--fly-rotate));
                opacity: 1;
            }
            100% {
                transform: translate(var(--fly-x), var(--fly-y)) scale(0.3) rotate(calc(var(--fly-rotate) * 2));
                opacity: 0;
            }
        }

        /* ===== ENHANCED CARD DESIGNS ===== */
        .card-face::before {
            content: '';
            position: absolute;
            inset: 4px;
            border-radius: 6px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 100%);
            pointer-events: none;
        }

        .card-face::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(255, 255, 255, 0.3) 50%,
                transparent 70%
            );
            transform: rotate(45deg);
            animation: cardShine 3s ease-in-out infinite;
        }

        @keyframes cardShine {
            0%, 100% { transform: translateX(-100%) rotate(45deg); }
            50% { transform: translateX(100%) rotate(45deg); }
        }

        .card:hover .card-face::after {
            animation: cardShine 0.8s ease-in-out;
        }

        /* Card patterns for each suit */
        .card-face.dwarf-pattern {
            background:
                linear-gradient(180deg, white 0%, #CD853F15 100%),
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(139, 69, 19, 0.05) 10px, rgba(139, 69, 19, 0.05) 20px);
        }

        .card-face.elf-pattern {
            background:
                linear-gradient(180deg, white 0%, #90EE9015 100%),
                repeating-linear-gradient(-45deg, transparent, transparent 10px, rgba(34, 139, 34, 0.05) 10px, rgba(34, 139, 34, 0.05) 20px);
        }

        .card-face.giant-pattern {
            background:
                linear-gradient(180deg, white 0%, #FF634715 100%),
                repeating-linear-gradient(90deg, transparent, transparent 10px, rgba(220, 20, 60, 0.05) 10px, rgba(220, 20, 60, 0.05) 20px);
        }

        .card-face.human-pattern {
            background:
                linear-gradient(180deg, white 0%, #87CEEB15 100%),
                repeating-linear-gradient(0deg, transparent, transparent 10px, rgba(30, 144, 255, 0.05) 10px, rgba(30, 144, 255, 0.05) 20px);
        }

        /* Enhanced wizard and jester cards */
        .card-face.wizard {
            background:
                radial-gradient(circle at 30% 30%, rgba(148, 0, 211, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(255, 215, 0, 0.3) 0%, transparent 50%),
                linear-gradient(135deg, #1a0033 0%, #330066 50%, #1a0033 100%);
            box-shadow:
                inset 0 0 30px rgba(255, 215, 0, 0.3),
                0 0 20px rgba(148, 0, 211, 0.5);
        }

        .card-face.jester {
            background:
                radial-gradient(circle at 20% 80%, rgba(255, 20, 147, 0.3) 0%, transparent 40%),
                radial-gradient(circle at 80% 20%, rgba(255, 215, 0, 0.3) 0%, transparent 40%),
                linear-gradient(135deg, #ff69b4 0%, #ff1493 50%, #ff69b4 100%);
            box-shadow: 0 0 20px rgba(255, 20, 147, 0.5);
        }

        /* Particle trail for card flying */
        .card-trail-particle {
            position: fixed;
            pointer-events: none;
            font-size: 1.5rem;
            z-index: 999;
            animation: particleFloat 1s ease-out forwards;
        }

        @keyframes particleFloat {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--drift-x), var(--drift-y)) scale(0);
            }
        }

        /* Enhanced statistics dashboard */
        .stats-dashboard {
            background:
                linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, var(--bg-card) 100%);
            box-shadow:
                0 10px 40px rgba(0, 0, 0, 0.5),
                inset 0 0 30px rgba(139, 92, 246, 0.1);
        }

        .stat-item {
            transition: all 0.3s ease;
            padding: 0.75rem;
            border-radius: 8px;
        }

        .stat-item:hover {
            background: rgba(139, 92, 246, 0.1);
            transform: translateX(5px);
        }

        .stat-value {
            font-family: 'Orbitron', monospace;
            font-size: 0.9rem;
        }

        /* Trump card indicator enhancement */
        .trump-card-display {
            position: relative;
            overflow: visible;
        }

        .trump-card-display::before {
            content: '';
            position: absolute;
            inset: -5px;
            border-radius: 12px;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            opacity: 0.3;
            filter: blur(10px);
            z-index: -1;
            animation: trumpGlow 2s ease-in-out infinite;
        }

        @keyframes trumpGlow {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.05); }
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .toast-container {
                right: 10px;
                left: 10px;
            }

            .toast {
                min-width: 0;
            }

            .game-header {
                gap: 0.5rem;
                padding: 0.35rem 0.7rem;
                flex-wrap: wrap;
                max-width: 500px;
                top: 8px;
                left: 8px;
            }

            .new-game-btn {
                font-size: 0.65rem;
                padding: 0.3rem 0.6rem;
            }

            .trump-suit {
                font-size: 1rem;
                padding: 0.15rem 0.4rem;
            }

            .round-display {
                font-size: 0.7rem;
            }

            .phase-display {
                font-size: 0.65rem;
            }

            .bid-history-panel,
            .stats-dashboard {
                max-width: 140px;
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
            }

            .stats-title,
            .bid-history-title {
                font-size: 0.75rem;
                margin-bottom: 0.4rem;
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /*   ONLINE MULTIPLAYER LOBBY SYSTEM STYLES                         */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        #lobbyScreen, #joinRoomScreen, #waitingRoomScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 50%, #0F172A 100%);
            z-index: 10000;
            animation: fadeIn 0.3s ease;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 2rem 0;
        }

        .lobby-container, .room-container, .waiting-room-container {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 3rem 2.5rem;
            border: 2px solid rgba(139, 92, 246, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            max-width: 500px;
            width: 90%;
            animation: slideUp 0.5s ease;
            margin: auto;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .lobby-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .lobby-title {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, #8B5CF6, #EC4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 30px rgba(139, 92, 246, 0.5);
        }

        .lobby-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .player-name-input-section {
            margin-bottom: 2rem;
        }

        .name-input {
            width: 100%;
            padding: 1rem 1.5rem;
            font-size: 1.1rem;
            font-family: 'Inter', sans-serif;
            background: rgba(139, 92, 246, 0.1);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            color: var(--text-primary);
            transition: all 0.3s ease;
            text-align: center;
        }

        .name-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.2);
            transform: scale(1.02);
        }

        .lobby-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .lobby-btn {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(236, 72, 153, 0.1));
            border: 2px solid rgba(139, 92, 246, 0.4);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .lobby-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s ease;
        }

        .lobby-btn:hover::before {
            left: 100%;
        }

        .lobby-btn:hover {
            transform: translateY(-4px) scale(1.02);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
        }

        .lobby-btn-create {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(16, 185, 129, 0.1));
            border-color: rgba(34, 197, 94, 0.4);
        }

        .lobby-btn-create:hover {
            border-color: #22C55E;
            box-shadow: 0 10px 30px rgba(34, 197, 94, 0.4);
        }

        .lobby-btn-join {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.1));
            border-color: rgba(59, 130, 246, 0.4);
        }

        .lobby-btn-join:hover {
            border-color: #3B82F6;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }

        .btn-icon {
            font-size: 2rem;
        }

        .btn-text {
            font-family: 'Orbitron', monospace;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .btn-subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .connection-status {
            text-align: center;
            padding: 1rem;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .status-indicator {
            font-size: 1.2rem;
            animation: pulse 2s ease-in-out infinite;
        }

        .status-indicator.connected {
            color: #22C55E;
        }

        .status-indicator.disconnected {
            color: #EF4444;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        /* Room Join/Create Screens */
        .back-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1rem;
            cursor: pointer;
            padding: 0.5rem 1rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .back-btn:hover {
            color: var(--primary);
            transform: translateX(-4px);
        }

        .room-title {
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .room-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .room-code-input {
            width: 100%;
            padding: 1.5rem;
            font-size: 2rem;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            background: rgba(139, 92, 246, 0.1);
            border: 3px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            color: var(--text-primary);
            text-align: center;
            letter-spacing: 0.3em;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }

        .room-code-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.2);
        }

        .action-btn {
            width: 100%;
            padding: 1.2rem 2rem;
            font-size: 1.1rem;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            position: relative;
            overflow: hidden;
        }

        .join-btn {
            background: linear-gradient(135deg, #3B82F6, #2563EB);
            color: white;
        }

        .join-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.5);
        }

        .error-message {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid rgba(239, 68, 68, 0.4);
            border-radius: 10px;
            color: #FCA5A5;
            text-align: center;
            font-size: 0.9rem;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Waiting Room */
        .waiting-room-container {
            max-width: 600px;
        }

        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .room-code-display {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(139, 92, 246, 0.1);
            padding: 1rem 1.5rem;
            border-radius: 10px;
            border: 2px solid rgba(139, 92, 246, 0.3);
        }

        .room-code-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .room-code-value {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            letter-spacing: 0.2em;
        }

        .copy-code-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .copy-code-btn:hover {
            transform: scale(1.2);
        }

        .leave-room-btn {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid rgba(239, 68, 68, 0.4);
            color: #FCA5A5;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .leave-room-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: translateY(-2px);
        }

        .players-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.2rem;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-count-badge {
            background: var(--primary);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .players-list {
            display: grid;
            gap: 0.8rem;
        }

        .player-card {
            background: rgba(139, 92, 246, 0.1);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 10px;
            padding: 1rem 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            animation: playerJoin 0.4s ease;
        }

        @keyframes playerJoin {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .player-card.ready {
            border-color: #22C55E;
            background: rgba(34, 197, 94, 0.1);
        }

        .player-card.host {
            border-color: #F59E0B;
            background: rgba(245, 158, 11, 0.1);
        }

        .player-info-left {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .player-name-display {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .player-badge {
            font-size: 0.75rem;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            margin-left: 0.5rem;
        }

        .badge-host {
            background: #F59E0B;
            color: white;
        }

        .badge-ready {
            background: #22C55E;
            color: white;
        }

        .waiting-room-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .ready-btn {
            background: linear-gradient(135deg, #22C55E, #16A34A);
            color: white;
            flex: 1;
        }

        .ready-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(34, 197, 94, 0.5);
        }

        .ready-btn.active {
            background: linear-gradient(135deg, #EF4444, #DC2626);
        }

        .start-btn {
            background: linear-gradient(135deg, #8B5CF6, #7C3AED);
            color: white;
            animation: pulseButton 2s ease-in-out infinite;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.5);
        }

        @keyframes pulseButton {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.7);
            }
            50% {
                box-shadow: 0 0 0 20px rgba(139, 92, 246, 0);
            }
        }

        .btn-pulse {
            animation: pulse 1s ease-in-out infinite;
        }

        .waiting-status {
            text-align: center;
            padding: 1.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .waiting-animation {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .waiting-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            animation: waiting 1.4s ease-in-out infinite;
        }

        .waiting-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .waiting-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .waiting-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes waiting {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        #waitingText {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }
    </style>
</head>
<body>
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!--   ONLINE MULTIPLAYER LOBBY SYSTEM                        -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

    <!-- Lobby Entrance Screen -->
    <div id="lobbyScreen" style="display: flex;">
        <div class="lobby-container">
            <div class="lobby-header">
                <h1 class="lobby-title">ðŸŽ® WIZARD ONLINE</h1>
                <p class="lobby-subtitle">Play with friends around the world</p>
            </div>

            <div class="player-name-input-section">
                <label for="playerNameInput" style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem; display: block;">Your Name</label>
                <input
                    type="text"
                    id="playerNameInput"
                    class="name-input"
                    placeholder="Enter your name..."
                    maxlength="15"
                    autocomplete="off"
                />
            </div>

            <div class="lobby-actions">
                <button class="lobby-btn lobby-btn-create" onclick="showCreateRoom()">
                    <span class="btn-icon">ðŸŽ¯</span>
                    <span class="btn-text">CREATE ROOM</span>
                    <span class="btn-subtitle">Host a new game</span>
                </button>

                <button class="lobby-btn lobby-btn-join" onclick="showJoinRoom()">
                    <span class="btn-icon">ðŸ”—</span>
                    <span class="btn-text">JOIN ROOM</span>
                    <span class="btn-subtitle">Enter room code</span>
                </button>

                <button class="lobby-btn lobby-btn-local" onclick="playLocal()">
                    <span class="btn-icon">ðŸ </span>
                    <span class="btn-text">LOCAL GAME</span>
                    <span class="btn-subtitle">Play on this device</span>
                </button>

                <button class="lobby-btn" onclick="openRulesModal()" style="background: linear-gradient(135deg, #06B6D4 0%, #3B82F6 100%); margin-top: 1rem;">
                    <span class="btn-icon">ðŸ“–</span>
                    <span class="btn-text">HOW TO PLAY</span>
                    <span class="btn-subtitle">Learn the rules</span>
                </button>
            </div>

            <div class="connection-status">
                <span class="status-indicator" id="connectionIndicator">â—</span>
                <span id="connectionText">Connecting to server...</span>
            </div>
        </div>
    </div>

    <!-- Room Join Screen -->
    <div id="joinRoomScreen" style="display: none;">
        <div class="room-container">
            <button class="back-btn" onclick="backToLobby()">â† Back</button>

            <h2 class="room-title">Join Game Room</h2>
            <p class="room-subtitle">Enter the 6-digit code from your friend</p>

            <input
                type="text"
                id="roomCodeInput"
                class="room-code-input"
                placeholder="ABC123"
                maxlength="6"
                autocomplete="off"
                oninput="this.value = this.value.toUpperCase()"
            />

            <button class="action-btn join-btn" onclick="joinRoom()">
                <span>JOIN GAME</span>
                <span class="btn-arrow">â†’</span>
            </button>

            <div id="joinError" class="error-message" style="display: none;"></div>
        </div>
    </div>

    <!-- Waiting Room Screen -->
    <div id="waitingRoomScreen" style="display: none;">
        <div class="waiting-room-container">
            <div class="room-header">
                <div class="room-code-display">
                    <span class="room-code-label">ROOM CODE</span>
                    <span class="room-code-value" id="displayRoomCode">------</span>
                    <button class="copy-code-btn" onclick="copyRoomCode()" title="Copy code">
                        ðŸ“‹
                    </button>
                </div>
                <button class="leave-room-btn" onclick="leaveRoom()">Leave Room</button>
            </div>

            <div class="players-section">
                <h3 class="section-title">
                    <span>Players</span>
                    <span class="player-count-badge" id="playerCountBadge">0/6</span>
                </h3>
                <div class="players-list" id="playersList">
                    <!-- Player cards will be added here -->
                </div>
            </div>

            <div class="waiting-room-actions">
                <button
                    class="action-btn ready-btn"
                    id="readyBtn"
                    onclick="toggleReady()"
                >
                    <span id="readyBtnText">READY</span>
                </button>

                <button
                    class="action-btn start-btn"
                    id="startGameBtn"
                    onclick="startOnlineGame()"
                    style="display: none;"
                >
                    <span>START GAME</span>
                    <span class="btn-pulse">â—</span>
                </button>
            </div>

            <div class="waiting-status" id="waitingStatus">
                <div class="waiting-animation">
                    <div class="waiting-dot"></div>
                    <div class="waiting-dot"></div>
                    <div class="waiting-dot"></div>
                </div>
                <p id="waitingText">Waiting for players...</p>
            </div>
        </div>
    </div>

    <!-- Setup Screen -->
    <div id="setupScreen" style="display: none;">
        <div class="setup-container">
            <h1 class="setup-title">WIZARD</h1>
            <p class="setup-subtitle">ðŸŽ® Single Player vs AI Bots</p>

            <h3 style="margin-bottom: 1rem; color: var(--text-secondary); font-size: 1rem; text-transform: uppercase; letter-spacing: 0.1em;">Select Number of AI Opponents</h3>
            <div class="player-count-selector">
                <button class="player-count-btn" onclick="selectPlayerCount(3, this)">3</button>
                <button class="player-count-btn selected" onclick="selectPlayerCount(4, this)">4</button>
                <button class="player-count-btn" onclick="selectPlayerCount(5, this)">5</button>
                <button class="player-count-btn" onclick="selectPlayerCount(6, this)">6</button>
            </div>

            <h3 style="margin-bottom: 1rem; color: var(--text-secondary); font-size: 1rem; text-transform: uppercase; letter-spacing: 0.1em;">Enter Your Name</h3>
            <div class="player-names" id="playerNamesContainer">
                <!-- Dynamic player inputs -->
            </div>

            <button class="btn btn-start" onclick="startGame()">
                ðŸŽ® START GAME
            </button>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen">
        <div class="game-table">
            <!-- Game Header -->
            <div class="game-header">
                <button class="new-game-btn" onclick="confirmNewGame()" title="Start New Game">
                    ðŸ”„ NEW GAME
                </button>
                <button class="leave-room-btn" onclick="leaveGame()" title="Leave Game & Return to Lobby" style="margin-left: 0.5rem;">
                    â† LEAVE GAME
                </button>
                <div class="trump-card-display">
                    <span class="trump-label">Trump:</span>
                    <span class="trump-suit" id="trumpDisplay">â€”</span>
                </div>
                <div class="round-display" id="roundDisplay">Round 1/20</div>
                <div style="color: var(--text-secondary);">
                    <span id="phaseDisplay">Bidding...</span>
                </div>
            </div>

            <!-- Center Trick Area -->
            <div class="trick-area">
                <div class="trick-cards-container" id="trickArea">
                    <!-- Cards played appear here -->
                </div>
            </div>

            <!-- Player Areas (dynamically positioned) -->
            <div id="playerAreasContainer"></div>
        </div>
    </div>

    <!-- Bidding Modal -->
    <div class="modal-overlay" id="biddingModal">
        <div class="modal">
            <button class="modal-minimize-btn" onclick="minimizeBiddingModal()" title="Minimize to review cards">âˆ’</button>
            <h2 class="modal-title">Place Your Bid</h2>
            <p class="modal-text">
                <span id="biddingPlayerName">Player</span>, how many tricks will you win?
            </p>
            <div class="bid-controls">
                <button class="bid-btn" onclick="adjustBid(-1)">âˆ’</button>
                <div class="bid-value" id="bidValue">0</div>
                <button class="bid-btn" onclick="adjustBid(1)">+</button>
            </div>
            <button class="btn btn-start" onclick="confirmBid()">
                âœ“ CONFIRM BID
            </button>
            <p style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 1rem; text-align: center;">
                ðŸ’¡ Click âˆ’ to minimize and review your cards
            </p>
        </div>
    </div>

    <!-- Minimized Bidding Button -->
    <button class="bidding-minimized-btn" id="biddingMinimizedBtn" style="display: none;" onclick="restoreBiddingModal()">
        ðŸ“Š Complete Your Bid
    </button>

    <!-- Trump Selection Modal (when Wizard is flipped) -->
    <div class="modal-overlay" id="trumpSelectionModal">
        <div class="modal">
            <h2 class="modal-title" style="color: var(--wizard-gold);">â­ WIZARD TRUMP!</h2>
            <p class="modal-text">
                <span id="dealerName">Dealer</span>, a Wizard was flipped!<br>
                Choose the trump suit for this round:
            </p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 2rem 0;">
                <button class="trump-choice-btn" onclick="chooseTrumpSuit('dwarf')" style="background: linear-gradient(135deg, #8B4513, #CD853F);">
                    <div style="font-size: 3rem;">ðŸª¨</div>
                    <div style="font-weight: bold; margin-top: 0.5rem;">DWARF</div>
                </button>
                <button class="trump-choice-btn" onclick="chooseTrumpSuit('elf')" style="background: linear-gradient(135deg, #228B22, #90EE90);">
                    <div style="font-size: 3rem;">ðŸŒ¿</div>
                    <div style="font-weight: bold; margin-top: 0.5rem;">ELF</div>
                </button>
                <button class="trump-choice-btn" onclick="chooseTrumpSuit('giant')" style="background: linear-gradient(135deg, #DC143C, #FF6347);">
                    <div style="font-size: 3rem;">âš”ï¸</div>
                    <div style="font-weight: bold; margin-top: 0.5rem;">GIANT</div>
                </button>
                <button class="trump-choice-btn" onclick="chooseTrumpSuit('human')" style="background: linear-gradient(135deg, #1E90FF, #87CEEB);">
                    <div style="font-size: 3rem;">ðŸ’§</div>
                    <div style="font-weight: bold; margin-top: 0.5rem;">HUMAN</div>
                </button>
            </div>
        </div>
    </div>

    <!-- Bid History Panel -->
    <div class="bid-history-panel" id="bidHistoryPanel" style="display: none;">
        <div class="bid-history-title">
            ðŸ“Š Bids This Round
        </div>
        <div id="bidHistoryList">
            <!-- Bid items will be added here dynamically -->
        </div>
    </div>

    <!-- Statistics Dashboard -->
    <div class="stats-dashboard" id="statsDashboard" style="display: none;">
        <div class="stats-title">ðŸ“Š STATISTICS</div>
        <div class="stat-item">
            <span class="stat-label">Active Players</span>
            <span class="stat-value" id="statActivePlayers">â€”</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Leader</span>
            <span class="stat-value" id="statLeader">â€”</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Avg Score</span>
            <span class="stat-value" id="statAvgScore">â€”</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Highest Score</span>
            <span class="stat-value" id="statHighScore">â€”</span>
        </div>
    </div>

    <!-- Elimination Modal -->
    <div class="modal-overlay" id="eliminationModal">
        <div class="modal">
            <h2 class="modal-title" style="color: var(--danger);">ðŸ’€ ELIMINATED!</h2>
            <div style="text-align: center; margin: 2rem 0;">
                <div id="eliminatedAvatar" style="margin-bottom: 1rem;"></div>
                <h3 style="font-size: 1.5rem; margin-bottom: 0.5rem;" id="eliminatedName"></h3>
                <p style="color: var(--text-secondary);">
                    Eliminated in Round <strong id="eliminatedRound"></strong>
                </p>
                <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                    Final Score: <strong id="eliminatedScore"></strong>
                </p>
            </div>
            <p class="modal-text" id="eliminationMessage" style="font-style: italic; color: var(--danger);"></p>
            <button class="btn btn-start" onclick="closeEliminationModal()">
                Continue
            </button>
        </div>
    </div>

    <!-- Winner Modal -->
    <div class="modal-overlay" id="winnerModal">
        <div class="modal">
            <h2 class="modal-title" style="color: var(--wizard-gold); font-size: 2.5rem;">
                ðŸ† CHAMPION!
            </h2>
            <div style="text-align: center; margin: 2rem 0;">
                <div id="winnerAvatar" style="margin-bottom: 1rem;"></div>
                <h3 style="font-size: 2rem; margin-bottom: 0.5rem;" id="winnerName"></h3>
                <p style="color: var(--wizard-gold); font-size: 1.5rem; font-weight: 700;">
                    <span id="winnerScore"></span> Points
                </p>
            </div>
            <p class="modal-text" id="winnerMessage" style="font-size: 1.2rem; font-weight: 600;"></p>
            <button class="btn btn-start" onclick="location.reload()">
                ðŸŽ® NEW GAME
            </button>
        </div>
    </div>

    <!-- NEW GAME Confirmation Modal -->
    <div class="modal-overlay" id="newGameConfirmModal">
        <div class="modal" style="max-width: 400px;">
            <h2 class="modal-title" style="color: #DC143C;">ðŸ”„ Start New Game?</h2>
            <p class="modal-text" style="margin: 2rem 0;">
                Are you sure you want to start a new game?
                <br><br>
                <strong style="color: #DC143C;">âš ï¸ Current progress will be lost.</strong>
            </p>
            <div style="display: flex; gap: 1rem;">
                <button class="btn" style="flex: 1; background: var(--bg-secondary); border: 2px solid var(--text-tertiary);" onclick="closeNewGameConfirm()">
                    âŒ Cancel
                </button>
                <button class="btn btn-start" style="flex: 1; background: linear-gradient(135deg, #DC143C 0%, #FF6347 100%);" onclick="executeNewGame()">
                    âœ“ New Game
                </button>
            </div>
        </div>
    </div>

    <!-- Leave Game Confirmation Modal -->
    <div class="modal-overlay" id="leaveGameModal">
        <div class="modal" style="max-width: 450px;">
            <h2 class="modal-title" style="color: #FFA500;">ðŸ‘‹ Leave Game?</h2>
            <div style="text-align: center; margin: 2rem 0;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">ðŸ˜¢</div>
                <p class="modal-text" style="font-size: 1.1rem;">
                    Are you sure you want to leave the game<br>and return to the lobby?
                </p>
                <p style="color: var(--text-secondary); margin-top: 1.5rem; font-size: 0.9rem;">
                    âš ï¸ Your current progress will be lost
                </p>
            </div>
            <div style="display: flex; gap: 1rem;">
                <button class="btn" style="flex: 1; background: var(--bg-secondary); border: 2px solid var(--primary);" onclick="closeLeaveGameModal()">
                    âŒ Stay
                </button>
                <button class="btn btn-start" style="flex: 1; background: linear-gradient(135deg, #FFA500 0%, #FF6347 100%);" onclick="confirmLeaveGame()">
                    âœ“ Leave
                </button>
            </div>
        </div>
    </div>

    <!-- Rules Modal -->
    <div class="modal-overlay" id="rulesModal">
        <div class="modal" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <button class="modal-close-btn" onclick="closeRulesModal()" style="position: absolute; top: 1rem; right: 1rem; background: rgba(255,255,255,0.1); border: none; color: white; font-size: 1.5rem; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; transition: all 0.3s ease;">âœ•</button>

            <h2 class="modal-title" style="color: var(--wizard-gold); font-size: 2rem; margin-bottom: 1.5rem;">
                ðŸŽ´ WIZARD GAME RULES
            </h2>

            <!-- Tabs -->
            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 2rem; border-bottom: 2px solid rgba(139, 92, 246, 0.3);">
                <button class="rules-tab active" onclick="switchRulesTab('quick')" id="quickTab">
                    âš¡ Quick Start
                </button>
                <button class="rules-tab" onclick="switchRulesTab('detailed')" id="detailedTab">
                    ðŸ“– Detailed Rules
                </button>
                <button class="rules-tab" onclick="switchRulesTab('advanced')" id="advancedTab">
                    ðŸŽ¯ Pro Tips
                </button>
                <button class="rules-tab" onclick="switchRulesTab('tunisian')" id="tunisianTab" style="font-weight: 700;">
                    ðŸ‡¹ðŸ‡³ Ø¨Ø§Ù„ØªÙˆÙ†Ø³ÙŠ
                </button>
            </div>

            <!-- Quick Start Tab -->
            <div id="quickRules" class="rules-content active">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">ðŸš€ Quick Start Guide</h3>

                <div class="rules-section">
                    <h4>ðŸŽ¯ GOAL</h4>
                    <p>Predict EXACTLY how many tricks you'll win. Score points for accuracy!</p>
                </div>

                <div class="rules-section">
                    <h4>ðŸŽ´ CARDS</h4>
                    <p><strong>60 cards total:</strong></p>
                    <ul>
                        <li>ðŸª¨ <strong>Dwarf</strong> (Brown suit, 13 cards)</li>
                        <li>ðŸŒ¿ <strong>Elf</strong> (Green suit, 13 cards)</li>
                        <li>âš”ï¸ <strong>Giant</strong> (Red suit, 13 cards)</li>
                        <li>ðŸ’§ <strong>Human</strong> (Blue suit, 13 cards)</li>
                        <li>â­ <strong>Wizard</strong> (4 cards) - ALWAYS WINS!</li>
                        <li>ðŸƒ <strong>Jester</strong> (4 cards) - ALWAYS LOSES!</li>
                    </ul>
                </div>

                <div class="rules-section">
                    <h4>ðŸŽ® HOW TO PLAY</h4>
                    <ol>
                        <li><strong>Deal:</strong> Round 1 = 1 card each, Round 2 = 2 cards, etc.</li>
                        <li><strong>Trump:</strong> Flip a card. That suit is trump (beats all others)</li>
                        <li><strong>Bid:</strong> Dealer bids first. Predict your tricks!</li>
                        <li><strong>Play:</strong> Player left of dealer plays first card</li>
                        <li><strong>Follow Suit:</strong> You must play same suit if you have it</li>
                        <li><strong>Win Trick:</strong> Wizard > Trump > Lead Suit > Others</li>
                    </ol>
                </div>

                <div class="rules-section">
                    <h4>ðŸ’° SCORING</h4>
                    <ul>
                        <li>âœ… <strong>Exact Bid:</strong> +20 + (10 Ã— tricks won)</li>
                        <li>âŒ <strong>Wrong Bid:</strong> -10 Ã— difference</li>
                    </ul>
                    <p style="margin-top: 0.5rem;"><em>Example: Bid 3, won 3 = +50 points | Bid 2, won 5 = -30 points</em></p>
                </div>
            </div>

            <!-- Detailed Rules Tab -->
            <div id="detailedRules" class="rules-content">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">ðŸ“– Detailed Rules</h3>

                <div class="rules-section">
                    <h4>ðŸ”„ GAME FLOW</h4>
                    <ol>
                        <li><strong>20 Rounds Total</strong> - Game lasts exactly 20 rounds</li>
                        <li><strong>Dealer Rotates</strong> anticlockwise each round</li>
                        <li><strong>Cards Per Round:</strong> Round number = cards dealt</li>
                        <li><strong>Elimination:</strong> Lowest scorers eliminated at rounds 10, 12, 15 (6 players)</li>
                    </ol>
                </div>

                <div class="rules-section">
                    <h4>ðŸŽº TRUMP CARD RULES</h4>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr style="border-bottom: 1px solid rgba(139, 92, 246, 0.3);">
                            <th style="text-align: left; padding: 0.5rem;">Card Flipped</th>
                            <th style="text-align: left; padding: 0.5rem;">Trump Result</th>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">ðŸª¨ðŸŒ¿âš”ï¸ðŸ’§ Regular Suit</td>
                            <td style="padding: 0.5rem;">That suit is trump</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">â­ Wizard</td>
                            <td style="padding: 0.5rem;"><strong>Dealer chooses</strong> any suit</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">ðŸƒ Jester</td>
                            <td style="padding: 0.5rem;">NO trump this round</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">Round 20 (no cards left)</td>
                            <td style="padding: 0.5rem;">NO trump</td>
                        </tr>
                    </table>
                </div>

                <div class="rules-section">
                    <h4>ðŸŽ¯ BIDDING RULES</h4>
                    <ul>
                        <li>Dealer bids <strong>first</strong></li>
                        <li>Bidding goes <strong>anticlockwise</strong></li>
                        <li>Bid from <strong>0 to round number</strong></li>
                        <li>Total bids can be more or less than tricks available</li>
                        <li>Last player to bid has most information!</li>
                    </ul>
                </div>

                <div class="rules-section">
                    <h4>ðŸƒ PLAYING TRICKS</h4>
                    <ul>
                        <li>Player <strong>left of dealer</strong> leads first card</li>
                        <li>Play continues <strong>anticlockwise</strong></li>
                        <li><strong>Must follow suit</strong> if you have it</li>
                        <li>If you can't follow suit, play anything</li>
                        <li>Wizards & Jesters can be played anytime</li>
                        <li>Trick winner leads next trick</li>
                    </ul>
                </div>

                <div class="rules-section">
                    <h4>ðŸ† WINNING TRICKS - Priority Order</h4>
                    <ol>
                        <li>â­ <strong>Wizard</strong> - Always wins (first wizard played wins if multiple)</li>
                        <li>ðŸŽº <strong>Trump Suit</strong> - Beats non-trump (highest trump wins)</li>
                        <li>ðŸŽ´ <strong>Lead Suit</strong> - Highest card of lead suit wins</li>
                        <li>ðŸƒ <strong>Jester</strong> - Always loses (if only jesters, first played wins)</li>
                    </ol>
                </div>

                <div class="rules-section">
                    <h4>ðŸ’¯ SCORING EXAMPLES</h4>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr style="border-bottom: 1px solid rgba(139, 92, 246, 0.3);">
                            <th style="text-align: left; padding: 0.5rem;">Bid</th>
                            <th style="text-align: left; padding: 0.5rem;">Won</th>
                            <th style="text-align: left; padding: 0.5rem;">Score</th>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">3</td>
                            <td style="padding: 0.5rem;">3</td>
                            <td style="padding: 0.5rem; color: var(--success);">+50 (20 + 30)</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">2</td>
                            <td style="padding: 0.5rem;">5</td>
                            <td style="padding: 0.5rem; color: var(--danger);">-30 (off by 3)</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">0</td>
                            <td style="padding: 0.5rem;">0</td>
                            <td style="padding: 0.5rem; color: var(--success);">+20 (exact!)</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">4</td>
                            <td style="padding: 0.5rem;">1</td>
                            <td style="padding: 0.5rem; color: var(--danger);">-30 (off by 3)</td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- Advanced Tips Tab -->
            <div id="advancedRules" class="rules-content">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">ðŸŽ¯ Pro Tips & Strategy</h3>

                <div class="rules-section">
                    <h4>ðŸ’¡ BIDDING STRATEGY</h4>
                    <ul>
                        <li><strong>Wizards = Guaranteed Tricks</strong> - Always count them!</li>
                        <li><strong>High Trumps</strong> (A, K, Q) = Very likely to win</li>
                        <li><strong>Aces in Non-Trump</strong> = 70% win rate</li>
                        <li><strong>Void in a Suit?</strong> = Can trump it if you have trump cards</li>
                        <li><strong>Jesters</strong> = Never win, but can dump safely</li>
                        <li><strong>Bid Last?</strong> = Advantage! You know everyone's bids</li>
                    </ul>
                </div>

                <div class="rules-section">
                    <h4>ðŸŽ´ PLAYING STRATEGY</h4>
                    <ul>
                        <li><strong>Leading:</strong> Play high if you need tricks, low if you don't</li>
                        <li><strong>Following:</strong> Try to win if behind, dump if ahead</li>
                        <li><strong>Trump Cards:</strong> Save them or use them strategically</li>
                        <li><strong>Wizards:</strong> Use to guarantee critical tricks</li>
                        <li><strong>Jesters:</strong> Play when you don't want the trick</li>
                        <li><strong>Watch Bids:</strong> Know who wants tricks and who doesn't!</li>
                    </ul>
                </div>

                <div class="rules-section">
                    <h4>ðŸ§  ADVANCED TACTICS</h4>
                    <ul>
                        <li><strong>Card Counting:</strong> Track which suits have been played</li>
                        <li><strong>Trump Management:</strong> Don't waste high trumps early</li>
                        <li><strong>Blocking:</strong> Prevent others from making their bids</li>
                        <li><strong>Jester Timing:</strong> Play when someone else will win anyway</li>
                        <li><strong>Position Awareness:</strong> Being last to play = huge advantage</li>
                        <li><strong>Risk vs Reward:</strong> Sometimes bid 0 for easy +20 points</li>
                    </ul>
                </div>

                <div class="rules-section">
                    <h4>âš ï¸ COMMON MISTAKES</h4>
                    <ul>
                        <li>âŒ Forgetting to count Wizards as guaranteed tricks</li>
                        <li>âŒ Bidding too aggressively without trump cards</li>
                        <li>âŒ Not following suit when required (illegal!)</li>
                        <li>âŒ Playing Wizard too early in the round</li>
                        <li>âŒ Ignoring other players' bids</li>
                        <li>âŒ Focusing only on your cards, not the flow of play</li>
                    </ul>
                </div>

                <div class="rules-section">
                    <h4>ðŸ… WINNING TIPS</h4>
                    <p><strong>The key to winning Wizard is ACCURACY, not ambition!</strong></p>
                    <ul>
                        <li>âœ… Better to bid 1 and make it (+30) than bid 3 and miss (-20+)</li>
                        <li>âœ… Conservative bids are safer early in the game</li>
                        <li>âœ… Take calculated risks when behind on points</li>
                        <li>âœ… Control tempo - decide when to take tricks</li>
                        <li>âœ… Remember: Everyone can't make their bid - use this!</li>
                    </ul>
                </div>
            </div>

            <!-- Tunisian Arabic Tab -->
            <div id="tunisianRules" class="rules-content" dir="rtl" style="text-align: right; font-family: 'Inter', 'Segoe UI', Tahoma, sans-serif; line-height: 2;">
                <h3 style="color: var(--wizard-gold); margin-bottom: 1.5rem; font-size: 1.6rem;">ðŸ‡¹ðŸ‡³ ÙƒÙŠÙØ§Ø´ ØªÙ„Ø¹Ø¨ Wizard Ø¨Ø§Ù„ØªÙˆÙ†Ø³ÙŠ</h3>

                <div class="rules-section" style="border-right: 3px solid var(--wizard-gold); border-left: none; padding-right: 1rem; padding-left: 0;">
                    <h4 style="color: var(--secondary);">ðŸŽ¯ Ø§Ù„Ù‡Ø¯Ù Ù…ØªØ§Ø¹ Ø§Ù„Ù„Ø¹Ø¨Ø©</h4>
                    <p style="font-size: 1.05rem;">
                        Ø§Ù„ÙÙƒØ±Ø© Ø¨Ø³ÙŠØ·Ø© Ø¨Ø±Ø´Ø§: <strong style="color: var(--wizard-gold);">ØªÙˆÙ‚Ù‘Ø¹ Ù‚Ø¯Ù‘Ø§Ø´ Ù…Ù† "ØªØ±ÙŠÙƒ" (main/pli) Ø¨Ø§Ø´ ØªØ±Ø¨Ø­</strong> ÙÙŠ ÙƒÙ„ Ø¬ÙˆÙ„Ø©.
                        <br>ÙƒÙŠ ØªÙ‚ÙˆÙ„ "Ø¨Ø§Ø´ Ù†Ø±Ø¨Ø­ 3" Ùˆ ØªØ±Ø¨Ø­ Ø¨Ø§Ù„Ø¶Ø¨Ø· 3 â† ØªØ§Ø®Ùˆ Ù†Ù‚Ø§Ø·. ÙƒÙŠ ØªØºÙ„Ø· â† ØªØ®Ø³Ø± Ù†Ù‚Ø§Ø·.
                        <br><strong>Ø§Ù„Ù„ÙŠ ÙŠØ¬Ù…Ù‘Ø¹ Ø£ÙƒØ«Ø± Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„Ø¢Ø®Ø± Ù‡Ùˆ Ø§Ù„Ø±Ø§Ø¨Ø­!</strong>
                    </p>
                </div>

                <div class="rules-section" style="border-right: 3px solid var(--primary); border-left: none; padding-right: 1rem; padding-left: 0;">
                    <h4 style="color: var(--secondary);">ðŸŽ´ Ø§Ù„ÙƒÙˆØ§Ø±Ø· (60 ÙƒØ§Ø±Ø·Ø©)</h4>
                    <p>Ø§Ù„Ø¬Ùˆ ÙÙŠÙ‡ 60 ÙƒØ§Ø±Ø·Ø©ØŒ Ù…Ø´ 52 ÙƒÙŠÙ…Ø§ Ø§Ù„Ø¹Ø§Ø¯ÙŠ:</p>
                    <ul style="list-style: none; padding: 0;">
                        <li>ðŸª¨ <strong>Ø§Ù„Ù‚Ø²Ù… (Dwarf)</strong> - Ø£ØµÙØ±ØŒ 13 ÙƒØ§Ø±Ø·Ø© (1 Ù„Ù€ 13)</li>
                        <li>ðŸŒ¿ <strong>Ø§Ù„Ø¥Ù„Ù (Elf)</strong> - Ø£Ø®Ø¶Ø±ØŒ 13 ÙƒØ§Ø±Ø·Ø© (1 Ù„Ù€ 13)</li>
                        <li>âš”ï¸ <strong>Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚ (Giant)</strong> - Ø£Ø­Ù…Ø±ØŒ 13 ÙƒØ§Ø±Ø·Ø© (1 Ù„Ù€ 13)</li>
                        <li>ðŸ’§ <strong>Ø§Ù„Ø¥Ù†Ø³Ø§Ù† (Human)</strong> - Ø£Ø²Ø±Ù‚ØŒ 13 ÙƒØ§Ø±Ø·Ø© (1 Ù„Ù€ 13)</li>
                    </ul>
                    <p style="margin-top: 1rem; margin-bottom: 0.5rem; color: var(--text-tertiary); font-size: 0.9rem;">âœ¨ ÙƒÙˆØ§Ø±Ø· Ø®Ø§ØµÙ‘Ø© (Ù…Ø§ Ø¹Ù†Ø¯Ù‡Ù…Ø´ Ù„ÙˆÙ†ØŒ ÙŠØªÙ„Ø¹Ø¨Ùˆ ÙˆÙ‚ØªØ§Ø´ Ù…Ø§ ØªØ­Ø¨):</p>
                    <div style="display: flex; flex-direction: column; gap: 0.6rem;">
                        <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 140, 0, 0.08)); border: 1px solid rgba(255, 215, 0, 0.35); border-radius: 12px; padding: 0.8rem 1rem; display: flex; align-items: center; gap: 0.6rem; direction: rtl;">
                            <span style="font-size: 1.8rem;">â­</span>
                            <div>
                                <strong style="color: var(--wizard-gold); font-size: 1.05rem;">Ø§Ù„Ø³Ø§Ø­Ø± (Wizard)</strong><span style="color: var(--text-tertiary);"> â€” 4 ÙƒÙˆØ§Ø±Ø·</span>
                                <br><span style="color: var(--wizard-gold);">Ø¯ÙŠÙ…Ø§ ÙŠØ±Ø¨Ø­! ðŸ’ª Ù…Ø§ ÙŠØºÙ„Ø¨Ùˆ Ø­ØªÙ‰ Ø­Ø§Ø¬Ø©</span>
                            </div>
                        </div>
                        <div style="background: linear-gradient(135deg, rgba(255, 105, 180, 0.15), rgba(236, 72, 153, 0.08)); border: 1px solid rgba(255, 105, 180, 0.35); border-radius: 12px; padding: 0.8rem 1rem; display: flex; align-items: center; gap: 0.6rem; direction: rtl;">
                            <span style="font-size: 1.8rem;">ðŸƒ</span>
                            <div>
                                <strong style="color: var(--jester); font-size: 1.05rem;">Ø§Ù„Ù…Ù‡Ø±Ù‘Ø¬ (Jester)</strong><span style="color: var(--text-tertiary);"> â€” 4 ÙƒÙˆØ§Ø±Ø·</span>
                                <br><span style="color: var(--danger);">Ø¯ÙŠÙ…Ø§ ÙŠØ®Ø³Ø± ðŸ˜… Ù…Ø§ ÙŠØ±Ø¨Ø­ Ø£Ø¨Ø¯Ø§</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="rules-section" style="border-right: 3px solid var(--success); border-left: none; padding-right: 1rem; padding-left: 0;">
                    <h4 style="color: var(--secondary);">ðŸŽ® ÙƒÙŠÙØ§Ø´ ØªÙ…Ø´ÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø© - Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©</h4>
                    <ol style="padding-right: 1.2rem; padding-left: 0;">
                        <li style="margin-bottom: 0.8rem;">
                            <strong style="color: var(--primary-light);">Ø§Ù„ØªÙˆØ²ÙŠØ¹ ðŸƒ</strong><br>
                            Ø§Ù„Ø¬ÙˆÙ„Ø© 1 = ÙƒØ§Ø±Ø·Ø© ÙˆØ­Ø¯Ø© Ù„ÙƒÙ„ ÙˆØ§Ø­Ø¯<br>
                            Ø§Ù„Ø¬ÙˆÙ„Ø© 2 = ÙƒØ§Ø±Ø·ØªÙŠÙ† Ù„ÙƒÙ„ ÙˆØ§Ø­Ø¯<br>
                            Ø§Ù„Ø¬ÙˆÙ„Ø© 3 = 3 ÙƒÙˆØ§Ø±Ø·... ÙˆÙ‡ÙƒÙ‘Ø§ Ù„Ø­Ø¯ Ø§Ù„Ø¬ÙˆÙ„Ø© 20
                        </li>
                        <li style="margin-bottom: 0.8rem;">
                            <strong style="color: var(--primary-light);">Ø§Ù„Ø£ØªÙˆ (Trump) ðŸŽº</strong><br>
                            Ø¨Ø¹Ø¯ Ø§Ù„ØªÙˆØ²ÙŠØ¹ØŒ Ù†Ù‚Ù„Ø¨Ùˆ ÙƒØ§Ø±Ø·Ø© Ù…Ù† Ø§Ù„Ø¨Ø§Ù‚ÙŠ:
                            <ul style="margin-top: 0.3rem; padding-right: 1.2rem;">
                                <li>ÙƒØ§Ø±Ø·Ø© Ø¹Ø§Ø¯ÙŠØ© â† Ø§Ù„Ù„ÙˆÙ† Ù‡Ø°Ø§Ùƒ Ù‡Ùˆ Ø§Ù„Ø£ØªÙˆ</li>
                                <li>â­ Ø³Ø§Ø­Ø± â† Ø§Ù„Ù„ÙŠ ÙŠÙˆØ²Ù‘Ø¹ ÙŠØ®ØªØ§Ø± Ø§Ù„Ø£ØªÙˆ</li>
                                <li>ðŸƒ Ù…Ù‡Ø±Ù‘Ø¬ â† Ù…Ø§ ÙÙ…Ù‘Ø§Ø´ Ø£ØªÙˆ Ù‡Ø§Ù„Ø¬ÙˆÙ„Ø©</li>
                                <li>Ø§Ù„Ø¬ÙˆÙ„Ø© 20 â† Ù…Ø§ ÙŠØ¨Ù‚Ø§Ø´ ÙƒÙˆØ§Ø±Ø·ØŒ Ù…Ø§ ÙÙ…Ù‘Ø§Ø´ Ø£ØªÙˆ</li>
                            </ul>
                        </li>
                        <li style="margin-bottom: 0.8rem;">
                            <strong style="color: var(--primary-light);">Ø§Ù„Ù…Ø²Ø§ÙŠØ¯Ø© (Bidding) ðŸ“¢</strong><br>
                            ÙƒÙ„ ÙˆØ§Ø­Ø¯ ÙŠÙ‚ÙˆÙ„ Ù‚Ø¯Ù‘Ø§Ø´ Ù…Ù† ØªØ±ÙŠÙƒ Ø¨Ø§Ø´ ÙŠØ±Ø¨Ø­.<br>
                            <strong>Ø§Ù„Ù„ÙŠ ÙŠÙˆØ²Ù‘Ø¹ ÙŠØ¨Ø¯Ø§ Ø§Ù„Ø£ÙˆÙ„</strong>ØŒ ÙˆØ¨Ø¹Ø¯ ÙŠÙ…Ø´ÙŠ Ø¹ÙƒØ³ Ø¹Ù‚Ø§Ø±Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø©.
                            <br><em style="color: var(--text-tertiary);">Ù…Ø«Ù„Ø§: Ø¹Ù†Ø¯Ùƒ Ø³Ø§Ø­Ø± + 13 Ø£ØªÙˆ â† Ù‚ÙˆÙ„ 2</em>
                        </li>
                        <li style="margin-bottom: 0.8rem;">
                            <strong style="color: var(--primary-light);">Ø§Ù„Ù„Ø¹Ø¨ ðŸŽ´</strong><br>
                            <strong>Ø§Ù„Ù„ÙŠ Ø¹Ù„Ù‰ ÙŠØ³Ø§Ø± Ø§Ù„Ù…ÙˆØ²Ù‘Ø¹ ÙŠØ¨Ø¯Ø§</strong> ÙŠØ­Ø· Ø£ÙˆÙ„ ÙƒØ§Ø±Ø·Ø©.<br>
                            Ù„Ø§Ø²Ù… ØªØªØ¨Ù‘Ø¹ Ù†ÙØ³ Ø§Ù„Ù„ÙˆÙ† (suit) ÙƒØ§Ù† Ø¹Ù†Ø¯Ùƒ. ÙƒØ§Ù† Ù…Ø§ Ø¹Ù†Ø¯ÙƒØ´ â† Ø­Ø· Ø£ÙŠ Ø­Ø§Ø¬Ø©.<br>
                            â­ Ø§Ù„Ø³Ø§Ø­Ø± Ùˆ ðŸƒ Ø§Ù„Ù…Ù‡Ø±Ù‘Ø¬ ØªÙ†Ø¬Ù‘Ù… ØªÙ„Ø¹Ø¨Ù‡Ù… ÙˆÙ‚ØªØ§Ø´ Ù…Ø§ ØªØ­Ø¨.
                        </li>
                        <li style="margin-bottom: 0.8rem;">
                            <strong style="color: var(--primary-light);">Ø´ÙƒÙˆÙ† ÙŠØ±Ø¨Ø­ Ø§Ù„ØªØ±ÙŠÙƒØŸ ðŸ†</strong><br>
                            <table style="width: 100%; border-collapse: collapse; direction: rtl; text-align: right;">
                                <tr style="border-bottom: 1px solid rgba(139, 92, 246, 0.3);">
                                    <td style="padding: 0.4rem; color: var(--wizard-gold);"><strong>1. â­ Ø§Ù„Ø³Ø§Ø­Ø±</strong></td>
                                    <td style="padding: 0.4rem;">Ø¯ÙŠÙ…Ø§ ÙŠØ±Ø¨Ø­! (ÙƒØ§Ù† Ø²ÙˆØ² Ø³Ø§Ø­Ø± â† Ø§Ù„Ø£ÙˆÙ„ ÙŠØ±Ø¨Ø­)</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(139, 92, 246, 0.3);">
                                    <td style="padding: 0.4rem; color: var(--warning);"><strong>2. ðŸŽº Ø§Ù„Ø£ØªÙˆ</strong></td>
                                    <td style="padding: 0.4rem;">ÙŠØºÙ„Ø¨ ÙƒÙ„ Ø´ÙŠ Ù…Ø§Ø¹Ø¯Ø§ Ø§Ù„Ø³Ø§Ø­Ø±</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(139, 92, 246, 0.3);">
                                    <td style="padding: 0.4rem; color: var(--primary-light);"><strong>3. ðŸŽ´ Ù„ÙˆÙ† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</strong></td>
                                    <td style="padding: 0.4rem;">Ø§Ù„Ø£ÙƒØ¨Ø± ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù„ÙˆÙ† ÙŠØ±Ø¨Ø­</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.4rem; color: var(--danger);"><strong>4. ðŸƒ Ø§Ù„Ù…Ù‡Ø±Ù‘Ø¬</strong></td>
                                    <td style="padding: 0.4rem;">Ø¯ÙŠÙ…Ø§ ÙŠØ®Ø³Ø±</td>
                                </tr>
                            </table>
                        </li>
                    </ol>
                </div>

                <div class="rules-section" style="border-right: 3px solid var(--warning); border-left: none; padding-right: 1rem; padding-left: 0;">
                    <h4 style="color: var(--secondary);">ðŸ’° Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·</h4>
                    <div style="background: rgba(16, 185, 129, 0.15); padding: 1rem; border-radius: 12px; margin-bottom: 0.8rem;">
                        <strong style="color: var(--success); font-size: 1.1rem;">âœ… ÙƒÙŠ ØªØµÙŠØ¨ Ø§Ù„ØªÙˆÙ‚Ù‘Ø¹ Ø¨Ø§Ù„Ø¶Ø¨Ø·:</strong><br>
                        <span style="font-size: 1.3rem; color: var(--wizard-gold);">20 + (10 Ã— Ø¹Ø¯Ø¯ Ø§Ù„ØªØ±ÙŠÙƒØ§Øª)</span><br>
                        <em style="color: var(--text-tertiary);">Ù…Ø«Ø§Ù„: Ù‚Ù„Øª 3 Ùˆ Ø±Ø¨Ø­Øª 3 â† 20 + 30 = <strong style="color: var(--success);">+50 Ù†Ù‚Ø·Ø©</strong></em><br>
                        <em style="color: var(--text-tertiary);">Ù…Ø«Ø§Ù„: Ù‚Ù„Øª 0 Ùˆ Ø±Ø¨Ø­Øª 0 â† <strong style="color: var(--success);">+20 Ù†Ù‚Ø·Ø©</strong> (Ø¥ÙŠÙ‡ØŒ Ø­ØªÙ‰ Ø§Ù„ØµÙØ± ØªØ±Ø¨Ø­ Ø¹Ù„ÙŠÙ‡!)</em>
                    </div>
                    <div style="background: rgba(239, 68, 68, 0.15); padding: 1rem; border-radius: 12px;">
                        <strong style="color: var(--danger); font-size: 1.1rem;">âŒ ÙƒÙŠ ØªØºÙ„Ø· ÙÙŠ Ø§Ù„ØªÙˆÙ‚Ù‘Ø¹:</strong><br>
                        <span style="font-size: 1.3rem; color: var(--danger);">-10 Ã— Ø§Ù„ÙØ±Ù‚</span><br>
                        <em style="color: var(--text-tertiary);">Ù…Ø«Ø§Ù„: Ù‚Ù„Øª 2 Ùˆ Ø±Ø¨Ø­Øª 5 â† ÙØ±Ù‚ 3 â† <strong style="color: var(--danger);">-30 Ù†Ù‚Ø·Ø©</strong></em><br>
                        <em style="color: var(--text-tertiary);">Ù…Ø«Ø§Ù„: Ù‚Ù„Øª 4 Ùˆ Ø±Ø¨Ø­Øª 1 â† ÙØ±Ù‚ 3 â† <strong style="color: var(--danger);">-30 Ù†Ù‚Ø·Ø©</strong></em>
                    </div>
                </div>

                <div class="rules-section" style="border-right: 3px solid var(--danger); border-left: none; padding-right: 1rem; padding-left: 0;">
                    <h4 style="color: var(--secondary);">ðŸ’€ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ù‚ØµØ§Ø¡ (Elimination)</h4>
                    <p>Ø§Ù„Ù„Ø¹Ø¨Ø© ÙÙŠÙ‡Ø§ Ø¥Ù‚ØµØ§Ø¡! Ø§Ù„Ù„ÙŠ Ø¹Ù†Ø¯Ù‡ Ø£Ù‚Ù„ Ù†Ù‚Ø§Ø· ÙŠØ·ÙŠØ­:</p>
                    <table style="width: 100%; border-collapse: collapse; direction: rtl; text-align: right;">
                        <tr style="border-bottom: 1px solid rgba(239, 68, 68, 0.3);">
                            <th style="padding: 0.5rem;">Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø¹Ù‘Ø§Ø¨Ø©</th>
                            <th style="padding: 0.5rem;">Ø§Ù„Ø¥Ù‚ØµØ§Ø¡ ÙÙŠ Ø§Ù„Ø¬ÙˆÙ„Ø©</th>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">6 Ù„Ø¹Ù‘Ø§Ø¨Ø©</td>
                            <td style="padding: 0.5rem;">Ø§Ù„Ø¬ÙˆÙ„Ø© 10ØŒ 12ØŒ 15</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">5 Ù„Ø¹Ù‘Ø§Ø¨Ø©</td>
                            <td style="padding: 0.5rem;">Ø§Ù„Ø¬ÙˆÙ„Ø© 12ØŒ 15</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">4 Ù„Ø¹Ù‘Ø§Ø¨Ø©</td>
                            <td style="padding: 0.5rem;">Ø§Ù„Ø¬ÙˆÙ„Ø© 15</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">3 Ù„Ø¹Ù‘Ø§Ø¨Ø©</td>
                            <td style="padding: 0.5rem;">Ù…Ø§ ÙÙ…Ù‘Ø§Ø´ Ø¥Ù‚ØµØ§Ø¡</td>
                        </tr>
                    </table>
                    <p style="margin-top: 0.5rem; color: var(--text-tertiary);">ÙÙŠ Ø§Ù„Ø¢Ø®Ø± ÙŠØ¨Ù‚Ø§Ùˆ 3 Ù„Ø¹Ù‘Ø§Ø¨Ø© ÙŠØªÙ†Ø§ÙØ³Ùˆ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©!</p>
                </div>

                <div class="rules-section" style="border-right: 3px solid var(--accent); border-left: none; padding-right: 1rem; padding-left: 0;">
                    <h4 style="color: var(--secondary);">ðŸ§  Ù†ØµØ§Ø¦Ø­ Ø¨Ø§Ø´ ØªØ±Ø¨Ø­</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>Ø§Ù„Ø³Ø§Ø­Ø± = ØªØ±ÙŠÙƒ Ù…Ø¶Ù…ÙˆÙ†</strong> - Ø¯ÙŠÙ…Ø§ Ø­Ø³Ø¨Ùˆ!</li>
                        <li style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>Ø§Ù„Ù€13 ÙÙŠ Ø§Ù„Ø£ØªÙˆ = Ø±Ø¨Ø­ Ø´Ø¨Ù‡ Ù…Ø¶Ù…ÙˆÙ†</strong> (Ø£ÙƒØ¨Ø± ÙƒØ§Ø±Ø·Ø© ÙÙŠ Ø§Ù„Ù„ÙˆÙ†)</li>
                        <li style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>Ù…Ø§ Ø¹Ù†Ø¯ÙƒØ´ Ù„ÙˆÙ† Ù…Ø¹ÙŠÙ‘Ù†ØŸ</strong> â† ØªÙ†Ø¬Ù‘Ù… ØªØ¶Ø±Ø¨ Ø¨Ø§Ù„Ø£ØªÙˆ!</li>
                        <li style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>ÙƒØ§Ù† Ù…Ø´ Ù…ØªØ£ÙƒØ¯ØŒ Ù‚ÙˆÙ„ 0</strong> â† +20 Ù†Ù‚Ø·Ø© Ø³Ù‡Ù„Ø©</li>
                        <li style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>Ø§Ù„Ù…Ù‡Ø±Ù‘Ø¬</strong> â† Ø§Ø³ØªØ¹Ù…Ù„Ùˆ ÙƒÙŠ Ù…Ø§ ØªØ­Ø¨Ø´ ØªØ±Ø¨Ø­ Ø§Ù„ØªØ±ÙŠÙƒ</li>
                        <li style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>Ø±Ø§Ù‚Ø¨ Ø§Ù„Ù…Ø²Ø§ÙŠØ¯Ø©</strong> â† Ø´ÙˆÙ Ø´ÙƒÙˆÙ† Ø­Ø§Ø¨ ÙŠØ±Ø¨Ø­ ÙˆØ´ÙƒÙˆÙ† Ù„Ø§</li>
                        <li style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>Ø®Ø¨Ù‘ÙŠ Ø§Ù„Ø³Ø§Ø­Ø±</strong> Ù„Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø³Ø§Ø³ØŒ Ù…Ø§ ØªÙ„Ø¹Ø¨ÙˆØ´ Ù…Ù† Ø§Ù„Ø£ÙˆÙ„!</li>
                        <li style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>Ø§Ù„Ø¯Ù‚Ø© Ø£Ù‡Ù… Ù…Ù† Ø§Ù„Ø·Ù…Ø¹!</strong> Ø£Ø­Ø³Ù†Ù„Ùƒ ØªÙ‚ÙˆÙ„ 1 Ùˆ ØªØµÙŠØ¨ (+30) Ø®ÙŠØ± Ù…Ø§ ØªÙ‚ÙˆÙ„ 4 Ùˆ ØªØºÙ„Ø· (-30)</li>
                    </ul>
                </div>

                <div class="rules-section" style="border-right: 3px solid var(--secondary); border-left: none; padding-right: 1rem; padding-left: 0; background: rgba(139, 92, 246, 0.1); border-radius: 12px; padding: 1.2rem;">
                    <h4 style="color: var(--wizard-gold);">âš¡ Ù…Ù„Ø®Ù‘Øµ Ø³Ø±ÙŠØ¹ Ù„Ù„ÙŠ ÙŠØ­Ø¨ ÙŠØ¨Ø¯Ø§ ØªÙˆ</h4>
                    <ol style="padding-right: 1.2rem; padding-left: 0; font-size: 1.05rem;">
                        <li>ØªØªÙˆØ²Ù‘Ø¹ Ø§Ù„ÙƒÙˆØ§Ø±Ø· (Ø¬ÙˆÙ„Ø© 1 = ÙƒØ§Ø±Ø·Ø©ØŒ Ø¬ÙˆÙ„Ø© 2 = 2...)</li>
                        <li>Ù†Ø´ÙˆÙÙˆ Ø§Ù„Ø£ØªÙˆ (Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù„ÙŠ ÙŠØºÙ„Ø¨)</li>
                        <li>ÙƒÙ„ ÙˆØ§Ø­Ø¯ ÙŠÙ‚ÙˆÙ„ Ù‚Ø¯Ù‘Ø§Ø´ Ø¨Ø§Ø´ ÙŠØ±Ø¨Ø­</li>
                        <li>Ù†Ù„Ø¹Ø¨Ùˆ Ø§Ù„ÙƒÙˆØ§Ø±Ø· - Ù„Ø§Ø²Ù… ØªØªØ¨Ù‘Ø¹ Ø§Ù„Ù„ÙˆÙ†</li>
                        <li>â­ Ø§Ù„Ø³Ø§Ø­Ø± ÙŠØºÙ„Ø¨ Ø§Ù„ÙƒÙ„ØŒ ðŸƒ Ø§Ù„Ù…Ù‡Ø±Ù‘Ø¬ ÙŠØ®Ø³Ø± Ø¯ÙŠÙ…Ø§</li>
                        <li>ÙƒÙŠ ØªØµÙŠØ¨ Ø§Ù„ØªÙˆÙ‚Ù‘Ø¹ â† ØªØ±Ø¨Ø­ Ù†Ù‚Ø§Ø· ðŸŽ‰</li>
                        <li>ÙƒÙŠ ØªØºÙ„Ø· â† ØªØ®Ø³Ø± Ù†Ù‚Ø§Ø· ðŸ˜…</li>
                        <li>Ø£ÙƒØ«Ø± Ù†Ù‚Ø§Ø· = Ø§Ù„Ø±Ø§Ø¨Ø­! ðŸ†</li>
                    </ol>
                </div>
            </div>

            <button class="btn btn-start" onclick="closeRulesModal()" style="margin-top: 2rem;">
                âœ“ Got It!
            </button>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Loading Screen -->
    <div class="loading" id="loadingScreen">
        <div class="spinner"></div>
    </div>

    <script>
        // ===== GAME CONSTANTS =====

        const SUITS = {
            dwarf: {
                name: 'DWARF',
                symbol: 'ðŸª¨',
                color: '#8B4513',
                lightColor: '#CD853F',
                gradient: 'linear-gradient(180deg, white 0%, #CD853F15 100%)'
            },
            elf: {
                name: 'ELF',
                symbol: 'ðŸŒ¿',
                color: '#228B22',
                lightColor: '#90EE90',
                gradient: 'linear-gradient(180deg, white 0%, #90EE9015 100%)'
            },
            giant: {
                name: 'GIANT',
                symbol: 'âš”ï¸',
                color: '#DC143C',
                lightColor: '#FF6347',
                gradient: 'linear-gradient(180deg, white 0%, #FF634715 100%)'
            },
            human: {
                name: 'HUMAN',
                symbol: 'ðŸ’§',
                color: '#1E90FF',
                lightColor: '#87CEEB',
                gradient: 'linear-gradient(180deg, white 0%, #87CEEB15 100%)'
            },
            wizard: {
                name: 'WIZARD',
                symbol: 'â­',
                color: '#9400D3',
                goldColor: '#FFD700',
                special: true
            },
            jester: {
                name: 'JESTER',
                symbol: 'ðŸƒ',
                color: '#FF1493',
                lightColor: '#FFB6C1',
                special: true
            }
        };

        const PLAYER_POSITIONS = {
            3: ['bottom', 'top-left', 'top-right'],
            4: ['bottom', 'left', 'top', 'right'],
            5: ['bottom', 'left', 'top-left', 'top-right', 'right'],
            6: ['bottom', 'left', 'top-left', 'top', 'top-right', 'right']
        };

        // ===== GAME STATE =====

        let gameState = {
            // Setup
            playerCount: 4,
            playerNames: [],
            players: [],

            // Deck
            deck: [],

            // Round
            currentRound: 1,
            maxRounds: 20,
            trumpCard: null,
            trumpSuit: null,

            // Gameplay
            phase: 'setup', // setup|bidding|playing|scoring
            currentPlayerIndex: 0,
            dealerIndex: 0,
            leadPlayerIndex: 0,

            // Trick
            currentTrick: [],
            leadSuit: null,

            // Data
            playerHands: {},
            bids: {},
            tricksWon: {},
            scores: {},

            // Bidding
            currentBiddingPlayerIndex: 0,
            currentBid: 0,

            // Elimination System
            eliminated: [],
            eliminationSchedule: []
        };

        // ===== SETUP FUNCTIONS =====

        let selectedPlayerCount = 4;

        function selectPlayerCount(count, button) {
            selectedPlayerCount = count;
            gameState.playerCount = count;

            // Update UI
            document.querySelectorAll('.player-count-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            if (button) {
                button.classList.add('selected');
            }

            // Generate player name inputs
            generatePlayerInputs();
        }

        function generatePlayerInputs() {
            const container = document.getElementById('playerNamesContainer');
            container.innerHTML = '';

            for (let i = 0; i < selectedPlayerCount; i++) {
                const aiNames = ['ðŸ¤– AI Bot Alpha', 'ðŸ¤– AI Bot Beta', 'ðŸ¤– AI Bot Gamma', 'ðŸ¤– AI Bot Delta', 'ðŸ¤– AI Bot Epsilon'];
                const defaultName = i === 0 ? 'You' : aiNames[i - 1];
                const isAI = i !== 0;

                container.innerHTML += `
                    <div class="player-input-group">
                        <div class="player-number">${i + 1}</div>
                        <input
                            type="text"
                            class="player-name-input"
                            id="playerName${i}"
                            placeholder="${defaultName}"
                            value="${defaultName}"
                            ${isAI ? 'disabled style="opacity: 0.7; cursor: not-allowed; background: rgba(139, 92, 246, 0.1);"' : ''}
                        >
                    </div>
                `;
            }
        }

        function startGame() {
            // Collect player names - Only first player is human, rest are AI
            gameState.playerNames = [];
            for (let i = 0; i < selectedPlayerCount; i++) {
                const input = document.getElementById(`playerName${i}`);
                let name;
                if (i === 0) {
                    // Human player
                    name = input.value.trim() || 'You';
                } else {
                    // AI players
                    const aiNames = ['AI Bot Alpha', 'AI Bot Beta', 'AI Bot Gamma', 'AI Bot Delta', 'AI Bot Epsilon'];
                    name = aiNames[i - 1] || `AI Bot ${i}`;
                }
                gameState.playerNames.push(name);
            }

            gameState.players = gameState.playerNames;

            // Generate elimination schedule
            gameState.eliminationSchedule = generateEliminationSchedule(selectedPlayerCount);
            console.log(`ðŸ“‹ Elimination schedule:`, gameState.eliminationSchedule);

            // Initialize player data
            gameState.players.forEach(player => {
                gameState.playerHands[player] = [];
                gameState.bids[player] = null;
                gameState.tricksWon[player] = 0;
                gameState.scores[player] = 0;
            });

            // ALWAYS play 20 rounds (standard Wizard rules)
            gameState.maxRounds = 20;

            // Generate elimination schedule
            gameState.eliminationSchedule = generateEliminationSchedule(selectedPlayerCount);

            // Show loading
            showLoading();

            // Transition to game
            setTimeout(() => {
                document.getElementById('setupScreen').style.display = 'none';
                document.getElementById('gameScreen').style.display = 'block';
                hideLoading();

                // Setup game table
                setupGameTable();

                // Start first round
                startRound();
            }, 1000);
        }

        function setupGameTable() {
            const positions = PLAYER_POSITIONS[gameState.playerCount];
            const container = document.getElementById('playerAreasContainer');
            container.innerHTML = '';

            gameState.players.forEach((player, index) => {
                const position = positions[index];
                const positionClass = position.replace('-', ' ');

                container.innerHTML += `
                    <div class="player-area ${positionClass}" id="playerArea${index}">
                        <div class="player-info" id="playerInfo${index}">
                            <div class="player-name">
                                ${player}
                                <span id="playerBadge${index}" class="player-badge" style="display: none; margin-left: 0.5rem; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem; font-weight: bold;"></span>
                            </div>
                            <div class="player-stats">
                                <span>Bid: <strong id="playerBid${index}">â€”</strong></span>
                                <span>Tricks: <strong id="playerTricks${index}">0</strong></span>
                                <span>Score: <strong id="playerScore${index}">0</strong></span>
                            </div>
                        </div>
                        <div class="player-hand" id="playerHand${index}">
                            <!-- Cards rendered here -->
                        </div>
                    </div>
                `;
            });
        }

        // ===== CARD SYSTEM =====

        function createDeck() {
            const deck = [];

            // Regular suits (13 cards each)
            ['dwarf', 'elf', 'giant', 'human'].forEach(suit => {
                for (let value = 1; value <= 13; value++) {
                    deck.push({
                        id: `${suit}_${value}`,
                        suit: suit,
                        value: value,
                        ...SUITS[suit]
                    });
                }
            });

            // Wizards (4 cards)
            for (let i = 1; i <= 4; i++) {
                deck.push({
                    id: `wizard_${i}`,
                    suit: 'wizard',
                    value: 100,
                    ...SUITS.wizard
                });
            }

            // Jesters (4 cards)
            for (let i = 1; i <= 4; i++) {
                deck.push({
                    id: `jester_${i}`,
                    suit: 'jester',
                    value: 0,
                    ...SUITS.jester
                });
            }

            return deck;
        }

        function shuffleDeck(deck) {
            const shuffled = [...deck];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function renderCard(card, faceDown = false) {
            if (faceDown) {
                return `
                    <div class="card" data-card-id="${card.id}">
                        <div class="card-back">
                            <span style="font-size: 2.5rem;">â­</span>
                        </div>
                    </div>
                `;
            }

            const isSpecial = card.suit === 'wizard' || card.suit === 'jester';
            const displayValue = isSpecial ? '' : card.value;
            const cardClass = isSpecial ? card.suit : '';

            if (card.suit === 'wizard') {
                return `
                    <div class="card" data-card-id="${card.id}">
                        <div class="card-face wizard">
                            <div class="card-corner top-left">
                                <div class="card-symbol-small">${card.symbol}</div>
                            </div>
                            <div class="card-center">
                                <div class="card-symbol-large">${card.symbol}</div>
                                <div class="card-suit-name">${card.name}</div>
                            </div>
                            <div class="card-corner bottom-right">
                                <div class="card-symbol-small">${card.symbol}</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            if (card.suit === 'jester') {
                return `
                    <div class="card" data-card-id="${card.id}">
                        <div class="card-face jester" style="border-color: ${card.color};">
                            <div class="card-corner top-left">
                                <div class="card-symbol-small">${card.symbol}</div>
                            </div>
                            <div class="card-center">
                                <div class="card-symbol-large">${card.symbol}</div>
                                <div class="card-suit-name" style="color: white;">${card.name}</div>
                            </div>
                            <div class="card-corner bottom-right">
                                <div class="card-symbol-small">${card.symbol}</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="card" data-card-id="${card.id}">
                    <div class="card-face ${card.suit}-pattern" style="border-color: ${card.color};">
                        <div class="card-corner top-left">
                            <div class="card-value" style="color: ${card.color};">${displayValue}</div>
                            <div class="card-symbol-small">${card.symbol}</div>
                        </div>
                        <div class="card-center">
                            <div class="card-symbol-large">${card.symbol}</div>
                            <div class="card-suit-name" style="color: ${card.color};">${card.name}</div>
                        </div>
                        <div class="card-corner bottom-right">
                            <div class="card-value" style="color: ${card.color};">${displayValue}</div>
                            <div class="card-symbol-small">${card.symbol}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ===== ROUND MANAGEMENT =====

        function startRound() {
            console.log(`ðŸŽ² Starting Round ${gameState.currentRound}`);

            // Play new round sound
            if (gameState.currentRound > 1) {
                playSound('newRound');
            }

            // Clear bid history from previous round
            clearBidHistory();

            gameState.phase = 'dealing';
            updatePhaseDisplay();

            // Create and shuffle deck
            gameState.deck = shuffleDeck(createDeck());

            // Reset trick data
            gameState.currentTrick = [];
            gameState.leadSuit = null;
            gameState.players.forEach(player => {
                gameState.tricksWon[player] = 0;
                gameState.bids[player] = null;
            });

            // Deal cards
            const cardsPerPlayer = gameState.currentRound;
            gameState.players.forEach((player, index) => {
                gameState.playerHands[player] = gameState.deck.splice(0, cardsPerPlayer);
            });

            // Reveal trump card
            if (gameState.deck.length > 0) {
                gameState.trumpCard = gameState.deck[0];
                determineTrumpSuit();
            } else {
                gameState.trumpCard = null;
                gameState.trumpSuit = null;
                updateUI();
                setTimeout(() => startBidding(), 1500);
            }
        }

        function determineTrumpSuit() {
            if (gameState.trumpCard.suit === 'jester') {
                // Jester = No trump
                gameState.trumpSuit = null;
                console.log('ðŸƒ Jester flipped! NO TRUMP this round.');
                updateUI();
                setTimeout(() => startBidding(), 1500);
            } else if (gameState.trumpCard.suit === 'wizard') {
                // Wizard = Dealer chooses trump
                console.log('â­ Wizard flipped! Dealer must choose trump.');
                updateUI();

                // Check if dealer is human player (player 0)
                if (gameState.dealerIndex === 0) {
                    // Show trump selection modal to human dealer
                    setTimeout(() => {
                        showTrumpSelectionModal();
                    }, 1500);
                } else {
                    // AI dealer chooses trump (strategic or random)
                    setTimeout(() => {
                        const chosenSuit = aiChooseTrumpSuit();
                        gameState.trumpSuit = chosenSuit;
                        const dealerName = gameState.players[gameState.dealerIndex];
                        console.log(`ðŸ¤– Dealer ${dealerName} chose ${chosenSuit.toUpperCase()} as trump!`);
                        showToast(`Dealer chose ${SUITS[chosenSuit].symbol} ${chosenSuit.toUpperCase()} as trump!`, 'info', 3000);
                        updateUI();
                        setTimeout(() => startBidding(), 2000);
                    }, 1500);
                }
            } else {
                // Regular card = That suit is trump
                gameState.trumpSuit = gameState.trumpCard.suit;
                console.log(`ðŸŽ´ Trump suit: ${gameState.trumpSuit.toUpperCase()}`);
                updateUI();
                setTimeout(() => startBidding(), 1500);
            }
        }

        function showTrumpSelectionModal() {
            const dealerName = gameState.players[gameState.dealerIndex];
            document.getElementById('dealerName').textContent = dealerName;
            document.getElementById('trumpSelectionModal').classList.add('active');
            playSound('cardPlace');
        }

        function chooseTrumpSuit(suit) {
            gameState.trumpSuit = suit;
            document.getElementById('trumpSelectionModal').classList.remove('active');
            console.log(`ðŸ‘¤ Dealer chose ${suit.toUpperCase()} as trump!`);
            showToast(`You chose ${SUITS[suit].symbol} ${suit.toUpperCase()} as trump!`, 'success', 3000);
            playSound('bidConfirm');
            updateUI();
            setTimeout(() => startBidding(), 1000);
        }

        function aiChooseTrumpSuit() {
            const dealerPlayer = gameState.players[gameState.dealerIndex];
            const hand = gameState.playerHands[dealerPlayer];

            // Count cards of each suit in dealer's hand
            const suitCounts = {
                dwarf: hand.filter(c => c.suit === 'dwarf').length,
                elf: hand.filter(c => c.suit === 'elf').length,
                giant: hand.filter(c => c.suit === 'giant').length,
                human: hand.filter(c => c.suit === 'human').length
            };

            // Choose suit with most cards (strategic)
            let maxSuit = 'dwarf';
            let maxCount = suitCounts.dwarf;
            Object.keys(suitCounts).forEach(suit => {
                if (suitCounts[suit] > maxCount) {
                    maxCount = suitCounts[suit];
                    maxSuit = suit;
                }
            });

            return maxSuit;
        }

        function getNextActivePlayerIndex(startIndex) {
            // Find next non-eliminated player (anticlockwise direction)
            let index = startIndex;
            let attempts = 0;

            while (attempts < gameState.players.length) {
                const playerName = gameState.players[index];
                if (!gameState.eliminated || !gameState.eliminated.includes(playerName)) {
                    return index;
                }
                // Go anticlockwise (decrement with wrapping)
                index = (index - 1 + gameState.players.length) % gameState.players.length;
                attempts++;
            }

            // All players eliminated (shouldn't happen)
            return startIndex;
        }

        function startBidding() {
            gameState.phase = 'bidding';
            // Bidding starts WITH the dealer (dealer bids first)
            gameState.currentBiddingPlayerIndex = gameState.dealerIndex;
            updatePhaseDisplay();
            showBiddingForPlayer(gameState.currentBiddingPlayerIndex);
        }

        function showBiddingForPlayer(playerIndex) {
            const playerName = gameState.players[playerIndex];

            // Skip if player is eliminated
            if (gameState.eliminated && gameState.eliminated.includes(playerName)) {
                console.log(`Skipping eliminated player: ${playerName}`);
                const nextIndex = getNextActivePlayerIndex((playerIndex - 1 + gameState.players.length) % gameState.players.length);
                if (nextIndex !== playerIndex) {
                    showBiddingForPlayer(nextIndex);
                }
                return;
            }

            // AI AUTO-BID (only player 0 is human in local mode)
            if (playerIndex !== 0 && !onlineMode) {
                console.log(`ðŸ¤– AI bidding for ${playerName}...`);
                updateActivePlayer(playerIndex);
                setTimeout(() => {
                    const aiBid = calculateAIBid(playerIndex);
                    gameState.bids[playerName] = aiBid;
                    updateUI();
                    updateBidHistory(playerName, aiBid);
                    showToast(`${playerName} bids ${aiBid} trick${aiBid !== 1 ? 's' : ''}`, 'info', 1500);
                    playSound('bidConfirm');

                    // Check if all players bid
                    const activePlayers = gameState.players.filter(p => !gameState.eliminated || !gameState.eliminated.includes(p));
                    const biddedPlayers = activePlayers.filter(p => gameState.bids[p] !== null && gameState.bids[p] !== undefined);

                    if (biddedPlayers.length >= activePlayers.length) {
                        startPlaying();
                    } else {
                        const nextIndex = getNextActivePlayerIndex((playerIndex - 1 + gameState.players.length) % gameState.players.length);
                        gameState.currentBiddingPlayerIndex = nextIndex;
                        setTimeout(() => showBiddingForPlayer(nextIndex), 800);
                    }
                }, 1000);
                return;
            }

            // HUMAN PLAYER
            document.getElementById('biddingPlayerName').textContent = playerName;
            gameState.currentBid = 0;
            document.getElementById('bidValue').textContent = '0';
            document.getElementById('biddingModal').classList.add('active');

            // Highlight active player
            updateActivePlayer(playerIndex);
        }

        function adjustBid(delta) {
            const maxBid = gameState.currentRound;
            gameState.currentBid = Math.max(0, Math.min(maxBid, gameState.currentBid + delta));
            document.getElementById('bidValue').textContent = gameState.currentBid;
        }

        function confirmBid() {
            const playerIndex = gameState.currentBiddingPlayerIndex;
            const playerName = gameState.players[playerIndex];
            gameState.bids[playerName] = gameState.currentBid;

            // Play bid confirm sound
            playSound('bidConfirm');

            document.getElementById('biddingModal').classList.remove('active');
            document.getElementById('biddingMinimizedBtn').style.display = 'none';
            updateUI();

            // Update bid history
            updateBidHistory(playerName, gameState.currentBid);

            // Check if all active players have bid
            const activePlayers = gameState.players.filter(p => !gameState.eliminated || !gameState.eliminated.includes(p));
            const biddedPlayers = activePlayers.filter(p => gameState.bids[p] !== null && gameState.bids[p] !== undefined);

            if (biddedPlayers.length >= activePlayers.length) {
                // All active players have bid
                startPlaying();
            } else {
                // Next active player bids (anticlockwise)
                const nextIndex = getNextActivePlayerIndex((gameState.currentBiddingPlayerIndex - 1 + gameState.players.length) % gameState.players.length);
                gameState.currentBiddingPlayerIndex = nextIndex;

                setTimeout(() => {
                    showBiddingForPlayer(gameState.currentBiddingPlayerIndex);
                }, 500);
            }
        }

        function minimizeBiddingModal() {
            const modal = document.getElementById('biddingModal');
            const minimizedBtn = document.getElementById('biddingMinimizedBtn');

            modal.classList.remove('active');
            minimizedBtn.style.display = 'block';

            playSound('cardPlay');
            showToast('Bidding minimized. Review your cards!', 'info', 2000);
        }

        function restoreBiddingModal() {
            const modal = document.getElementById('biddingModal');
            const minimizedBtn = document.getElementById('biddingMinimizedBtn');

            modal.classList.add('active');
            minimizedBtn.style.display = 'none';

            playSound('bidConfirm');
        }

        function updateBidHistory(playerName, bid) {
            // Safety check - don't add if playerName is undefined
            if (!playerName || playerName === 'undefined') {
                console.error('âš ï¸ Attempted to add undefined player to bid history');
                return;
            }

            const historyPanel = document.getElementById('bidHistoryPanel');
            const historyList = document.getElementById('bidHistoryList');

            // Show panel
            historyPanel.style.display = 'block';

            // Add bid to history
            const bidItem = document.createElement('div');
            bidItem.className = 'bid-history-item';
            bidItem.innerHTML = `
                <span class="player-name-bid">${playerName}</span>
                <span class="bid-amount">${bid}</span>
            `;
            historyList.appendChild(bidItem);

            // Update total tricks bid
            updateBidTotal();
        }

        function updateBidTotal() {
            const historyList = document.getElementById('bidHistoryList');

            // Calculate total bids
            const activePlayers = gameState.players.filter(p => !gameState.eliminated || !gameState.eliminated.includes(p));
            const totalBids = activePlayers.reduce((sum, player) => {
                const bid = gameState.bids[player];
                return sum + (bid !== null && bid !== undefined ? bid : 0);
            }, 0);

            // Remove existing total if any
            const existingTotal = historyList.querySelector('.bid-history-total');
            if (existingTotal) {
                existingTotal.remove();
            }

            // Add total if all players have bid
            const biddedPlayers = activePlayers.filter(p => gameState.bids[p] !== null && gameState.bids[p] !== undefined);
            if (biddedPlayers.length >= activePlayers.length) {
                const totalItem = document.createElement('div');
                totalItem.className = 'bid-history-total';
                totalItem.innerHTML = `
                    <span class="total-label">Total Expected:</span>
                    <span class="total-value">${totalBids} tricks</span>
                `;
                historyList.appendChild(totalItem);
            }
        }

        function clearBidHistory() {
            document.getElementById('bidHistoryList').innerHTML = '';
            document.getElementById('bidHistoryPanel').style.display = 'none';
        }

        function updateTrumpDisplayWithColor(trump) {
            const trumpDisplay = document.getElementById('trumpDisplay');

            // Remove all suit classes
            trumpDisplay.className = 'trump-suit';

            if (trump) {
                trumpDisplay.textContent = trump.symbol + ' ' + trump.name;
                trumpDisplay.classList.add(trump.suit);
            } else {
                trumpDisplay.textContent = 'â€”';
                trumpDisplay.classList.add('none');
            }
        }

        function startPlaying() {
            gameState.phase = 'playing';

            // Playing starts LEFT of dealer (in clockwise order, left = +1)
            // Note: Dealer bids first, but player LEFT of dealer plays first card
            const startIndex = (gameState.dealerIndex + 1) % gameState.players.length;
            gameState.leadPlayerIndex = getNextActivePlayerIndex(startIndex);
            gameState.currentPlayerIndex = gameState.leadPlayerIndex;

            updatePhaseDisplay();
            updateUI();
            updateActivePlayer(gameState.currentPlayerIndex);

            console.log(`ðŸŽ® Playing phase started. Lead player: ${gameState.players[gameState.currentPlayerIndex]}`);

            // If AI starts, trigger them to play
            if (gameState.currentPlayerIndex !== 0) {
                setTimeout(() => playAICard(gameState.currentPlayerIndex), 1500);
            }
        }

        // ===== UI UPDATE =====

        function updateUI() {
            // Update round display
            document.getElementById('roundDisplay').textContent = `Round ${gameState.currentRound}/${gameState.maxRounds}`;

            // Update trump display with color
            if (gameState.trumpSuit) {
                const trump = SUITS[gameState.trumpSuit];
                updateTrumpDisplayWithColor(trump);
            } else {
                updateTrumpDisplayWithColor(null);
            }

            // Update player info and hands
            gameState.players.forEach((player, index) => {
                const isEliminated = gameState.eliminated && gameState.eliminated.includes(player);
                const playerArea = document.getElementById(`playerArea${index}`);
                const badgeEl = document.getElementById(`playerBadge${index}`);

                // Show elimination badge and gray out if eliminated
                if (isEliminated) {
                    badgeEl.textContent = 'ðŸ’€ OUT';
                    badgeEl.style.display = 'inline-block';
                    badgeEl.style.background = 'var(--danger)';
                    badgeEl.style.color = 'white';
                    playerArea.style.opacity = '0.5';
                    playerArea.style.filter = 'grayscale(60%)';
                } else {
                    badgeEl.style.display = 'none';
                    playerArea.style.opacity = '1';
                    playerArea.style.filter = 'none';
                }

                document.getElementById(`playerBid${index}`).textContent = gameState.bids[player] !== null ? gameState.bids[player] : 'â€”';
                document.getElementById(`playerTricks${index}`).textContent = gameState.tricksWon[player];
                document.getElementById(`playerScore${index}`).textContent = gameState.scores[player];

                // Render hand (only show face-up for main player - index 0)
                const handEl = document.getElementById(`playerHand${index}`);
                const cards = gameState.playerHands[player];

                if (index === 0) {
                    // Main player - show all cards face-up
                    handEl.innerHTML = cards.map(card => renderCard(card)).join('');

                    // Add click handlers
                    handEl.querySelectorAll('.card').forEach(cardEl => {
                        cardEl.addEventListener('click', () => {
                            console.log(`ðŸŽ¯ Card clicked: ${cardEl.dataset.cardId}, Phase: ${gameState.phase}, CurrentPlayer: ${gameState.currentPlayerIndex}`);

                            if (gameState.phase === 'playing' && gameState.currentPlayerIndex === 0) {
                                playCard(0, cardEl.dataset.cardId);
                            } else if (gameState.phase !== 'playing') {
                                console.log('âš ï¸ Not in playing phase yet!');
                            } else if (gameState.currentPlayerIndex !== 0) {
                                console.log('âš ï¸ Not your turn!');
                            }
                        });
                    });
                } else {
                    // Other players - show cards face-down
                    handEl.innerHTML = cards.map(card => renderCard(card, true)).join('');
                }
            });

            // Update trick area
            updateTrickArea();

            // Update statistics dashboard
            updateStatistics();
        }

        function updateTrickArea() {
            const trickEl = document.getElementById('trickArea');

            if (gameState.currentTrick.length === 0) {
                trickEl.innerHTML = '<p style="color: var(--text-tertiary); font-size: 1.2rem; pointer-events: none;">Waiting for cards...</p>';
            } else {
                trickEl.innerHTML = gameState.currentTrick.map((play, index) => `
                    <div class="trick-card-wrapper" style="position: absolute; text-align: center; animation: fadeIn 0.5s ease; z-index: ${700 + index}; pointer-events: none;">
                        ${renderCard(play.card)}
                        <div style="margin-top: 0.5rem; font-weight: 700; color: var(--text-secondary); font-size: 0.85rem; text-shadow: 0 2px 4px rgba(0,0,0,0.8);">
                            ${play.playerName}
                        </div>
                    </div>
                `).join('');

                // Position cards in circle - adapted for 500px trick area
                const cards = trickEl.querySelectorAll('.trick-card-wrapper');
                const numCards = gameState.currentTrick.length;
                const radius = 120; // Large radius for 500px trick area

                cards.forEach((cardEl, index) => {
                    // Start from top and go clockwise
                    const angle = (index / numCards) * Math.PI * 2 - Math.PI / 2;
                    const x = Math.cos(angle) * radius;
                    const y = Math.sin(angle) * radius;

                    // Apply transform with slight rotation for visual appeal
                    const rotation = (index - (numCards - 1) / 2) * 8; // Fan effect
                    cardEl.style.transform = `translate(${x}px, ${y}px) rotate(${rotation}deg)`;
                    cardEl.style.zIndex = 700 + index; // HIGHEST z-index - ALWAYS visible above game header
                });
            }
        }

        function updateActivePlayer(playerIndex) {
            gameState.players.forEach((player, index) => {
                const infoEl = document.getElementById(`playerInfo${index}`);

                // Remove any existing turn badge
                const existingBadge = infoEl.querySelector('.your-turn-badge');
                if (existingBadge) {
                    existingBadge.remove();
                }

                if (index === playerIndex) {
                    infoEl.classList.add('active');

                    // Add badge for human player
                    if (index === 0) {
                        const badge = document.createElement('div');
                        badge.className = 'your-turn-badge';

                        if (gameState.phase === 'playing') {
                            badge.textContent = 'ðŸ‘† YOUR TURN';
                        } else if (gameState.phase === 'bidding') {
                            badge.textContent = 'ðŸ’­ YOUR BID';
                        }

                        if (gameState.phase === 'playing' || gameState.phase === 'bidding') {
                            infoEl.appendChild(badge);
                        }
                    }
                } else {
                    infoEl.classList.remove('active');
                }
            });
        }

        function updatePhaseDisplay() {
            const phases = {
                'dealing': 'Dealing cards...',
                'bidding': 'Bidding phase',
                'playing': 'Playing tricks',
                'scoring': 'Calculating scores...'
            };
            document.getElementById('phaseDisplay').textContent = phases[gameState.phase] || '';
        }

        // ===== GAME LOGIC =====

        function playCard(playerIndex, cardId) {
            const player = gameState.players[playerIndex];
            const card = gameState.playerHands[player].find(c => c.id === cardId);

            if (!card) {
                console.log(`âŒ Card not found: ${cardId}`);
                return;
            }

            console.log(`ðŸƒ ${player} plays ${card.suit} ${card.value}`);

            // Validate play
            if (!isValidPlay(player, card)) {
                // Show toast notification instead of alert
                showToast('You must follow suit if possible!', 'error', 3000);

                // Shake the invalid card
                const cardElement = document.querySelector(`.card[data-card-id="${cardId}"]`);
                if (cardElement) {
                    shakeCard(cardElement);
                }

                // Play error sound
                playSound('error');

                console.log(`âŒ Invalid play: must follow suit ${gameState.leadSuit}`);
                return;
            }

            // Play card sound
            playSound('cardPlay');

            // Remove from hand
            gameState.playerHands[player] = gameState.playerHands[player].filter(c => c.id !== cardId);

            // Add to trick
            gameState.currentTrick.push({
                playerIndex: playerIndex,
                playerName: player,
                card: card
            });

            // Set lead suit - FIRST non-Wizard/non-Jester card determines suit
            if (!gameState.leadSuit && card.suit !== 'jester' && card.suit !== 'wizard') {
                gameState.leadSuit = card.suit;
                console.log(`ðŸŽ¯ Lead suit set to: ${gameState.leadSuit}`);
            }

            updateUI();

            // Next player (anticlockwise)
            gameState.currentPlayerIndex = (gameState.currentPlayerIndex - 1 + gameState.players.length) % gameState.players.length;
            updateActivePlayer(gameState.currentPlayerIndex);

            console.log(`ðŸ“ Trick: ${gameState.currentTrick.length}/${gameState.players.length} cards`);

            // Check if trick complete
            if (gameState.currentTrick.length === gameState.players.length) {
                console.log('ðŸ Trick complete! Resolving...');
                setTimeout(resolveTrick, 800);
            } else if (gameState.currentPlayerIndex !== 0) {
                // AI plays
                console.log(`ðŸ¤– AI turn: ${gameState.players[gameState.currentPlayerIndex]}`);
                setTimeout(() => playAICard(gameState.currentPlayerIndex), 1000);
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /*   SMART AI LOGIC - PROFESSIONAL BOT SYSTEM                      */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /*   SUPER INTELLIGENT AI - PROFESSIONAL LEVEL                     */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        function calculateAIBid(playerIndex) {
            const player = gameState.players[playerIndex];
            const hand = gameState.playerHands[player];
            const trumpSuit = gameState.trumpSuit;
            const numPlayers = gameState.players.filter(p => !gameState.eliminated || !gameState.eliminated.includes(p)).length;

            let estimatedTricks = 0;
            let certainTricks = 0;
            let probableTricks = 0;
            let possibleTricks = 0;

            // === GUARANTEED TRICKS (100% win rate) ===
            const wizards = hand.filter(c => c.suit === 'wizard').length;
            certainTricks += wizards;

            // === TRUMP ANALYSIS ===
            const trumpCards = hand.filter(c => c.suit === trumpSuit && c.suit !== 'wizard' && c.suit !== 'jester');
            if (trumpCards.length > 0) {
                // High trumps (A, K, Q) - 85% win rate
                const highTrumps = trumpCards.filter(c => ['A', 'K', 'Q'].includes(c.rank)).length;
                probableTricks += highTrumps * 0.85;

                // Medium trumps (J, 10, 9) - 60% win rate if have many trumps
                const mediumTrumps = trumpCards.filter(c => ['J', '10', '9'].includes(c.rank)).length;
                if (trumpCards.length >= 3) probableTricks += mediumTrumps * 0.6;
                else possibleTricks += mediumTrumps * 0.3;

                // Low trumps - only count if many trumps (can exhaust others)
                if (trumpCards.length >= 4) {
                    const lowTrumps = trumpCards.filter(c => parseInt(c.rank) <= 8 && parseInt(c.rank) >= 2).length;
                    possibleTricks += lowTrumps * 0.2;
                }
            }

            // === NON-TRUMP SUIT ANALYSIS ===
            const suitCounts = {};
            ['hearts', 'diamonds', 'clubs', 'spades'].forEach(suit => {
                if (suit !== trumpSuit) {
                    const suitCards = hand.filter(c => c.suit === suit);
                    suitCounts[suit] = suitCards;

                    if (suitCards.length > 0) {
                        // Aces - 70% win if not trump suit
                        const aces = suitCards.filter(c => c.rank === 'A').length;
                        probableTricks += aces * 0.7;

                        // Kings - 50% win if also have ace or multiple cards
                        const kings = suitCards.filter(c => c.rank === 'K').length;
                        if (suitCards.length >= 2 || aces > 0) {
                            probableTricks += kings * 0.5;
                        } else {
                            possibleTricks += kings * 0.3;
                        }

                        // Queens - 30% win if strong suit
                        const queens = suitCards.filter(c => c.rank === 'Q').length;
                        if (suitCards.length >= 3) {
                            possibleTricks += queens * 0.3;
                        }

                        // Void in suit (no cards) = good for trumping if have trumps
                        if (suitCards.length === 0 && trumpCards.length > 0) {
                            possibleTricks += 0.3; // Can trump this suit
                        }
                    }
                }
            });

            // === JESTER PENALTY ===
            const jesters = hand.filter(c => c.suit === 'jester').length;
            // Jesters always lose - reduce estimates
            possibleTricks -= jesters * 0.3;

            // === POSITION FACTOR ===
            // Later position = more info = slightly better
            const positionBonus = playerIndex * 0.05;

            // === CALCULATE TOTAL ===
            estimatedTricks = certainTricks + probableTricks + possibleTricks + positionBonus;

            // === RISK ADJUSTMENT based on player count ===
            // More players = more competition = be conservative
            const conservativeFactor = (numPlayers - 2) * 0.1;
            estimatedTricks *= (1 - conservativeFactor);

            // === ADD SLIGHT RANDOMNESS for realism ===
            const randomFactor = (Math.random() - 0.5) * 0.3; // -0.15 to +0.15
            estimatedTricks += randomFactor;

            // === BOUNDS CHECK ===
            estimatedTricks = Math.max(0, Math.min(gameState.currentRound, Math.round(estimatedTricks)));

            console.log(`ðŸ§  AI ${player} SMART BID: ${estimatedTricks} tricks | Certain:${certainTricks} Probable:${probableTricks.toFixed(1)} Possible:${possibleTricks.toFixed(1)} | Wizards:${wizards} Trumps:${trumpCards.length} Jesters:${jesters}`);
            return estimatedTricks;
        }

        function playAICard(playerIndex) {
            const player = gameState.players[playerIndex];
            const hand = gameState.playerHands[player];

            if (hand.length === 0) return;

            let cardToPlay = selectSmartAICard(playerIndex, hand);
            playCard(playerIndex, cardToPlay.id);
        }

        function selectSmartAICard(playerIndex, hand) {
            const player = gameState.players[playerIndex];
            const bid = gameState.bids[player] || 0;
            const tricksWon = gameState.tricksWon[player] || 0;
            const tricksRemaining = hand.length;
            const tricksNeeded = bid - tricksWon;
            const isLeading = gameState.currentTrick.length === 0;

            console.log(`ðŸ¤– AI ${player}: Bid ${bid}, Won ${tricksWon}, Need ${tricksNeeded} more`);

            // If leading the trick
            if (isLeading) {
                return selectLeadCard(hand, tricksNeeded, tricksRemaining);
            }

            // If following
            return selectFollowCard(hand, tricksNeeded, tricksRemaining);
        }

        function selectLeadCard(hand, tricksNeeded, tricksRemaining) {
            // If need all remaining tricks, play highest card
            if (tricksNeeded >= tricksRemaining) {
                return getHighestCard(hand);
            }

            // If already met bid, play lowest card
            if (tricksNeeded <= 0) {
                return getLowestCard(hand);
            }

            // Otherwise play medium card
            return getMediumCard(hand);
        }

        function selectFollowCard(hand, tricksNeeded, tricksRemaining) {
            const leadSuit = gameState.leadSuit;
            const trumpSuit = gameState.trumpSuit;

            // Get valid cards (must follow suit if possible)
            let validCards = hand.filter(c => c.suit === leadSuit || c.suit === 'wizard' || c.suit === 'jester');
            if (validCards.length === 0) validCards = hand; // Can play anything if can't follow

            // Determine if currently winning
            const currentWinner = getCurrentTrickWinner();
            const needToWin = tricksNeeded > 0;

            // If need to win this trick
            if (needToWin && tricksNeeded >= tricksRemaining) {
                // Play wizard if have one
                const wizard = validCards.find(c => c.suit === 'wizard');
                if (wizard) return wizard;

                // Try to play higher than current winner
                return getHighestCard(validCards);
            }

            // If don't need to win, play lowest
            if (tricksNeeded <= 0) {
                const jester = validCards.find(c => c.suit === 'jester');
                if (jester) return jester;
                return getLowestCard(validCards);
            }

            // Middle strategy - save wizards and high cards
            const nonSpecial = validCards.filter(c => c.suit !== 'wizard');
            if (nonSpecial.length > 0) {
                return getMediumCard(nonSpecial);
            }

            return validCards[0];
        }

        function getCurrentTrickWinner() {
            if (gameState.currentTrick.length === 0) return null;

            let winningPlay = gameState.currentTrick[0];
            for (let i = 1; i < gameState.currentTrick.length; i++) {
                const play = gameState.currentTrick[i];
                if (beats(play.card, winningPlay.card)) {
                    winningPlay = play;
                }
            }
            return winningPlay;
        }

        function beats(card1, card2) {
            if (card1.suit === 'wizard') return true;
            if (card2.suit === 'wizard') return false;
            if (card1.suit === 'jester') return false;
            if (card2.suit === 'jester') return true;

            const trumpSuit = gameState.trumpSuit;
            if (card1.suit === trumpSuit && card2.suit !== trumpSuit) return true;
            if (card2.suit === trumpSuit && card1.suit !== trumpSuit) return false;

            if (card1.suit !== card2.suit) return false;

            return getCardValue(card1) > getCardValue(card2);
        }

        function getCardValue(card) {
            if (card.rank === 'A') return 14;
            if (card.rank === 'K') return 13;
            if (card.rank === 'Q') return 12;
            if (card.rank === 'J') return 11;
            return parseInt(card.rank) || 0;
        }

        function getHighestCard(cards) {
            const wizards = cards.filter(c => c.suit === 'wizard');
            if (wizards.length > 0) return wizards[0];

            return cards.reduce((highest, card) => {
                if (card.suit === 'jester') return highest;
                if (highest.suit === 'jester') return card;

                const trumpSuit = gameState.trumpSuit;
                if (card.suit === trumpSuit && highest.suit !== trumpSuit) return card;
                if (highest.suit === trumpSuit && card.suit !== trumpSuit) return highest;

                return getCardValue(card) > getCardValue(highest) ? card : highest;
            }, cards[0]);
        }

        function getLowestCard(cards) {
            const jesters = cards.filter(c => c.suit === 'jester');
            if (jesters.length > 0) return jesters[0];

            return cards.reduce((lowest, card) => {
                if (card.suit === 'wizard') return lowest;
                if (lowest.suit === 'wizard') return card;

                return getCardValue(card) < getCardValue(lowest) ? card : lowest;
            }, cards[0]);
        }

        function getMediumCard(cards) {
            const nonSpecial = cards.filter(c => c.suit !== 'wizard' && c.suit !== 'jester');
            if (nonSpecial.length === 0) return cards[0];

            const sorted = [...nonSpecial].sort((a, b) => getCardValue(a) - getCardValue(b));
            return sorted[Math.floor(sorted.length / 2)];
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /*   ELIMINATION SYSTEM - PROFESSIONAL TOURNAMENT                   */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        function generateEliminationSchedule(numPlayers) {
            const schedule = [];
            // Fixed elimination rounds - always end with 3 final players
            switch(numPlayers) {
                case 6:
                    schedule.push(10, 12, 15); // 3 eliminations: 6â†’3
                    break;
                case 5:
                    schedule.push(12, 15); // 2 eliminations: 5â†’3
                    break;
                case 4:
                    schedule.push(15); // 1 elimination: 4â†’3
                    break;
                // 3 or fewer: no eliminations
            }
            return schedule;
        }

        function checkElimination() {
            const round = gameState.currentRound;
            if (gameState.eliminationSchedule.includes(round)) {
                console.log(`ðŸ’€ ELIMINATION ROUND ${round}!`);
                setTimeout(() => eliminatePlayer(), 1500);
            }
        }

        function eliminatePlayer() {
            const activePlayers = gameState.players.filter(p => !gameState.eliminated.includes(p));

            // Always end with 3 final players
            if (activePlayers.length <= 3) {
                showToast('Final 3 players! Play to round 20!', 'success', 3000);
                return;
            }

            // Find lowest scorer
            const scores = activePlayers.map(p => ({
                name: p,
                score: gameState.scores[p] || 0
            }));

            const lowest = Math.min(...scores.map(s => s.score));
            const toEliminate = scores.filter(s => s.score === lowest);

            // Single player elimination (no tie)
            const eliminated = toEliminate[0].name;
            gameState.eliminated.push(eliminated);

            console.log(`ðŸ’€ ${eliminated} ELIMINATED at round ${gameState.currentRound}!`);

            // Show elimination modal
            showEliminationModal(eliminated);
        }

        function showEliminationModal(playerName) {
            const modal = document.getElementById('eliminationModal');

            // Set player name and avatar
            document.getElementById('eliminatedName').textContent = playerName;
            document.getElementById('eliminatedRound').textContent = gameState.currentRound;
            document.getElementById('eliminatedScore').textContent = gameState.scores[playerName] || 0;

            // Add player avatar (first letter in circle)
            const avatarDiv = document.getElementById('eliminatedAvatar');
            avatarDiv.innerHTML = `
                <div style="
                    width: 80px;
                    height: 80px;
                    border-radius: 50%;
                    background: linear-gradient(135deg, var(--danger), #DC143C);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 2.5rem;
                    font-weight: bold;
                    margin: 0 auto;
                    box-shadow: 0 5px 20px rgba(220, 20, 60, 0.5);
                ">${playerName[0].toUpperCase()}</div>
            `;

            // Random elimination message
            const messages = [
                "The cards have spoken... farewell! ðŸƒ",
                "Your wizard has left the building ðŸšª",
                "Disconnected from the tournament ðŸ”Œ",
                "Better luck next time! ðŸŽ¯",
                "The tournament ends here âš”ï¸"
            ];
            document.getElementById('eliminationMessage').textContent = messages[Math.floor(Math.random() * messages.length)];

            modal.classList.add('active');
            playSound('cardPlace');

            // Update UI
            updateUI();
        }

        function closeEliminationModal() {
            document.getElementById('eliminationModal').classList.remove('active');
        }

        function isValidPlay(player, card) {
            if (gameState.currentTrick.length === 0) return true; // Leading
            if (card.suit === 'wizard' || card.suit === 'jester') return true; // Special cards

            const hand = gameState.playerHands[player];
            const hasLeadSuit = hand.some(c => c.suit === gameState.leadSuit);

            if (!hasLeadSuit) return true; // Can't follow suit
            return card.suit === gameState.leadSuit; // Must follow suit
        }

        function resolveTrick() {
            const winnerIndex = determineTrickWinner();
            const winner = gameState.players[winnerIndex];

            gameState.tricksWon[winner]++;

            console.log(`ðŸ† ${winner} wins the trick!`);

            // Play trick win sound
            playSound('trickWin');

            // Show toast notification
            showToast(`${winner} wins the trick!`, 'success', 2000);

            // Animate cards flying to winner with particle trail
            flyCardsToWinner(winnerIndex);

            // Also create sparkle particles
            createParticles(30, ['âœ¨', 'â­', 'ðŸ’«']);

            // Reset trick after animation
            setTimeout(() => {
                gameState.currentTrick = [];
                gameState.leadSuit = null;
                gameState.leadPlayerIndex = winnerIndex;
                gameState.currentPlayerIndex = winnerIndex;

                updateUI();
                updateActivePlayer(winnerIndex);

                // Check if round complete
                if (gameState.playerHands[gameState.players[0]].length === 0) {
                    setTimeout(endRound, 1000);
                } else if (winnerIndex !== 0) {
                    // AI leads next trick
                    setTimeout(() => playAICard(winnerIndex), 800);
                }
            }, 400); // Quick clear after winner determined
        }

        function determineTrickWinner() {
            let winningPlayIndex = 0;
            let winningPlay = gameState.currentTrick[0];

            for (let i = 1; i < gameState.currentTrick.length; i++) {
                const currentPlay = gameState.currentTrick[i];

                // PRIORITY 1: Wizard ALWAYS wins (if winning card is already Wizard, first Wizard keeps winning)
                if (winningPlay.card.suit === 'wizard') {
                    // Winning card is Wizard, nothing can beat it
                    continue;
                }

                // Current card is Wizard and winning is NOT Wizard - Wizard wins!
                if (currentPlay.card.suit === 'wizard') {
                    winningPlayIndex = i;
                    winningPlay = currentPlay;
                    continue;
                }

                // PRIORITY 2: Jester always loses
                if (currentPlay.card.suit === 'jester') continue;
                if (winningPlay.card.suit === 'jester') {
                    winningPlayIndex = i;
                    winningPlay = currentPlay;
                    continue;
                }

                // PRIORITY 3: Trump beats non-trump
                if (gameState.trumpSuit) {
                    const currentIsTrump = currentPlay.card.suit === gameState.trumpSuit;
                    const winningIsTrump = winningPlay.card.suit === gameState.trumpSuit;

                    if (currentIsTrump && !winningIsTrump) {
                        winningPlayIndex = i;
                        winningPlay = currentPlay;
                        continue;
                    }

                    if (currentIsTrump && winningIsTrump) {
                        if (currentPlay.card.value > winningPlay.card.value) {
                            winningPlayIndex = i;
                            winningPlay = currentPlay;
                        }
                        continue;
                    }
                }

                // PRIORITY 4: Lead suit (higher value wins)
                if (currentPlay.card.suit === gameState.leadSuit && winningPlay.card.suit === gameState.leadSuit) {
                    if (currentPlay.card.value > winningPlay.card.value) {
                        winningPlayIndex = i;
                        winningPlay = currentPlay;
                    }
                }
            }

            return winningPlay.playerIndex;
        }

        function endRound() {
            gameState.phase = 'scoring';
            updatePhaseDisplay();

            // Calculate scores (only for non-eliminated players)
            gameState.players.forEach(player => {
                // Skip eliminated players
                if (gameState.eliminated && gameState.eliminated.includes(player)) {
                    return;
                }

                const bid = gameState.bids[player];
                const actual = gameState.tricksWon[player];

                if (bid === actual) {
                    gameState.scores[player] += 20 + (10 * actual);
                } else {
                    gameState.scores[player] -= 10 * Math.abs(bid - actual);
                }
            });

            updateUI();

            // Show score summary
            showScoreSummary();

            // Check for elimination BEFORE moving to next round
            if (gameState.eliminationSchedule && gameState.eliminationSchedule.includes(gameState.currentRound)) {
                console.log(`âš ï¸ Elimination Round ${gameState.currentRound}!`);

                // Delay elimination to let players see scores first
                setTimeout(() => {
                    eliminatePlayer();

                    // Then proceed to next round after elimination modal
                    setTimeout(() => {
                        proceedToNextRound();
                    }, 5000); // Give time to see elimination
                }, 2000);
            } else {
                // No elimination, proceed normally
                setTimeout(() => {
                    proceedToNextRound();
                }, 3000);
            }
        }

        function proceedToNextRound() {
            // Move to next round
            gameState.currentRound++;
            // Dealer rotates anticlockwise
            gameState.dealerIndex = (gameState.dealerIndex - 1 + gameState.players.length) % gameState.players.length;

            if (gameState.currentRound <= gameState.maxRounds) {
                startRound();
            } else {
                endGame();
            }
        }

        function showScoreSummary() {
            // TODO: Show elegant score summary modal
            console.log('ðŸ“Š Round Complete');
            gameState.players.forEach(player => {
                console.log(`${player}: ${gameState.scores[player]} points`);
            });
        }

        function endGame() {
            const winner = gameState.players.reduce((a, b) =>
                gameState.scores[a] > gameState.scores[b] ? a : b
            );

            // Play celebration sound
            playSound('celebration');

            // Launch epic confetti celebration
            launchConfetti();

            // Show winner modal
            document.getElementById('winnerName').textContent = winner;
            document.getElementById('winnerScore').textContent = gameState.scores[winner];

            const randomMessage = winnerMessages[Math.floor(Math.random() * winnerMessages.length)];
            document.getElementById('winnerMessage').textContent = randomMessage;

            // Create winner avatar (simple emoji for now)
            const winnerIndex = gameState.players.indexOf(winner);
            const winnerEmoji = ['ðŸ‘‘', 'ðŸ†', 'â­', 'ðŸ’«'][winnerIndex % 4];
            document.getElementById('winnerAvatar').innerHTML = `<div style="font-size: 5rem;">${winnerEmoji}</div>`;

            document.getElementById('winnerModal').classList.add('active');

            console.log('ðŸ† GAME COMPLETE!');
            console.log(`Winner: ${winner} with ${gameState.scores[winner]} points`);
        }

        function confirmNewGame() {
            document.getElementById('newGameConfirmModal').classList.add('active');
            playSound('cardPlay');
        }

        function closeNewGameConfirm() {
            document.getElementById('newGameConfirmModal').classList.remove('active');
            playSound('cardPlay');
        }

        function executeNewGame() {
            // Hide confirmation modal
            document.getElementById('newGameConfirmModal').classList.remove('active');

            // Play sound
            playSound('newRound');

            // Hide game screen
            document.getElementById('gameScreen').style.display = 'none';

            // Hide any open modals
            document.getElementById('biddingModal').classList.remove('active');
            document.getElementById('biddingMinimizedBtn').style.display = 'none';
            document.getElementById('winnerModal').classList.remove('active');
            document.getElementById('eliminationModal').classList.remove('active');

            // Clear bid history
            clearBidHistory();

            // Hide stats dashboard
            document.getElementById('statsDashboard').style.display = 'none';

            // Show setup screen
            document.getElementById('setupScreen').style.display = 'flex';

            // Reset game state
            gameState = {
                phase: 'setup',
                players: [],
                playerCount: 0,
                playerHands: {},
                scores: {},
                bids: {},
                tricksWon: {},
                eliminated: [],
                eliminationSchedule: [],
                currentBid: 0,
                currentBiddingPlayerIndex: 0,
                dealerIndex: 0,
                leadPlayerIndex: 0,
                currentPlayerIndex: 0,
                currentTrick: [],
                leadSuit: null,
                deck: [],
                currentRound: 1,
                maxRounds: 20,
                trumpCard: null,
                trumpSuit: null,
            };

            console.log('ðŸ”„ New game initiated');
            showToast('Returning to setup...', 'info', 2000);
        }

        // ===== RULES MODAL FUNCTIONS =====

        function openRulesModal() {
            document.getElementById('rulesModal').classList.add('active');
            playSound('cardPlace');
        }

        function closeRulesModal() {
            document.getElementById('rulesModal').classList.remove('active');
            playSound('cardPlace');
        }

        function switchRulesTab(tabName) {
            // Remove active from all tabs and contents
            document.querySelectorAll('.rules-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.rules-content').forEach(content => content.classList.remove('active'));

            // Add active to selected tab and content
            document.getElementById(`${tabName}Tab`).classList.add('active');
            document.getElementById(`${tabName}Rules`).classList.add('active');

            playSound('cardPlay');
        }

        // ===== SOUND EFFECTS SYSTEM =====

        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioContext = null;

        function initAudio() {
            if (!audioContext) {
                audioContext = new AudioContext();
            }
        }

        function playSound(type) {
            initAudio();

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);

            switch(type) {
                case 'cardPlay':
                    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                    break;

                case 'bidConfirm':
                    oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime); // E5
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.15);
                    break;

                case 'trickWin':
                    // Two-tone success sound
                    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                    oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.25);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.25);
                    break;

                case 'error':
                    oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;

                case 'celebration':
                    // Ascending arpeggio
                    const notes = [523.25, 659.25, 783.99, 1046.50]; // C, E, G, C
                    notes.forEach((freq, index) => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        osc.frequency.setValueAtTime(freq, audioContext.currentTime + index * 0.1);
                        gain.gain.setValueAtTime(0.2, audioContext.currentTime + index * 0.1);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + index * 0.1 + 0.3);
                        osc.start(audioContext.currentTime + index * 0.1);
                        osc.stop(audioContext.currentTime + index * 0.1 + 0.3);
                    });
                    return; // Skip the default stop

                case 'newRound':
                    oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // A4
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;

                default:
                    oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
            }
        }

        // ===== UTILITY FUNCTIONS =====

        function showLoading() {
            document.getElementById('loadingScreen').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingScreen').classList.remove('active');
        }

        function createParticles(count, emojis) {
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.fontSize = (Math.random() * 2 + 1) + 'rem';
                particle.style.animationDuration = (Math.random() * 3 + 2) + 's';
                particle.style.animationDelay = (Math.random() * 0.5) + 's';
                document.body.appendChild(particle);

                setTimeout(() => particle.remove(), 5000);
            }
        }

        // ===== TOAST NOTIFICATION SYSTEM =====

        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toastContainer');

            const icons = {
                error: 'âŒ',
                success: 'âœ…',
                info: 'â„¹ï¸',
                warning: 'âš ï¸'
            };

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="toast-icon">${icons[type]}</div>
                <div class="toast-message">${message}</div>
                <button class="toast-close" onclick="this.parentElement.remove()">Ã—</button>
            `;

            container.appendChild(toast);

            // Auto remove after duration
            setTimeout(() => {
                toast.style.animation = 'toastSlideOut 0.3s ease forwards';
                setTimeout(() => toast.remove(), 300);
            }, duration);

            console.log(`Toast: [${type.toUpperCase()}] ${message}`);
        }

        // ===== CARD SHAKE ANIMATION (Invalid Play) =====

        function shakeCard(cardElement) {
            cardElement.classList.add('invalid');
            setTimeout(() => {
                cardElement.classList.remove('invalid');
            }, 500);
        }

        // ===== CARD FLYING ANIMATION TO WINNER =====

        function flyCardsToWinner(winnerPlayerIndex) {
            const trickCards = document.querySelectorAll('#trickArea .card');
            const winnerArea = document.getElementById(`playerArea${winnerPlayerIndex}`);

            if (!winnerArea || trickCards.length === 0) return;

            const winnerRect = winnerArea.getBoundingClientRect();
            const winnerX = winnerRect.left + winnerRect.width / 2;
            const winnerY = winnerRect.top + winnerRect.height / 2;

            trickCards.forEach((card, index) => {
                const cardRect = card.getBoundingClientRect();
                const cardX = cardRect.left + cardRect.width / 2;
                const cardY = cardRect.top + cardRect.height / 2;

                const deltaX = winnerX - cardX;
                const deltaY = winnerY - cardY;

                // Mid-point for arc animation
                const midX = deltaX / 2;
                const midY = deltaY / 2 - 100; // Arc up

                const rotation = (Math.random() - 0.5) * 360;

                card.style.setProperty('--fly-x', `${deltaX}px`);
                card.style.setProperty('--fly-y', `${deltaY}px`);
                card.style.setProperty('--fly-x-mid', `${midX}px`);
                card.style.setProperty('--fly-y-mid', `${midY}px`);
                card.style.setProperty('--fly-rotate', `${rotation}deg`);

                // Add flying class with delay
                setTimeout(() => {
                    card.classList.add('flying');

                    // Create particle trail
                    createCardTrail(cardX, cardY, winnerX, winnerY);
                }, index * 100);
            });

            console.log(`ðŸš€ Cards flying to ${gameState.players[winnerPlayerIndex]}`);
        }

        function createCardTrail(startX, startY, endX, endY) {
            const particles = ['âœ¨', 'â­', 'ðŸ’«', 'ðŸŒŸ'];
            const steps = 10;

            for (let i = 0; i < steps; i++) {
                setTimeout(() => {
                    const progress = i / steps;
                    const x = startX + (endX - startX) * progress;
                    const y = startY + (endY - startY) * progress;

                    const particle = document.createElement('div');
                    particle.className = 'card-trail-particle';
                    particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                    particle.style.left = x + 'px';
                    particle.style.top = y + 'px';
                    particle.style.setProperty('--drift-x', `${(Math.random() - 0.5) * 50}px`);
                    particle.style.setProperty('--drift-y', `${(Math.random() - 0.5) * 50}px`);

                    document.body.appendChild(particle);

                    setTimeout(() => particle.remove(), 1000);
                }, i * 50);
            }
        }

        // ===== CONFETTI CELEBRATION SYSTEM =====

        function launchConfetti() {
            const colors = ['#8B5CF6', '#06B6D4', '#EC4899', '#F59E0B', '#10B981', '#EF4444', '#FBBF24', '#A78BFA'];
            const emojis = ['ðŸŽ‰', 'â­', 'âœ¨', 'ðŸ†', 'ðŸ‘‘', 'ðŸŽŠ', 'ðŸ’Ž', 'ðŸŒŸ'];

            // Launch 200 colorful confetti pieces
            for (let i = 0; i < 200; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-20px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animation = `confettiFall ${Math.random() * 2 + 3}s ease-out forwards`;
                    confetti.style.width = (Math.random() * 10 + 5) + 'px';
                    confetti.style.height = (Math.random() * 10 + 5) + 'px';

                    // Random shapes
                    if (Math.random() > 0.5) {
                        confetti.style.borderRadius = '0'; // Square
                    }

                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 5000);
                }, i * 15);
            }

            // Launch 50 emoji celebration particles
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const emoji = document.createElement('div');
                    emoji.style.position = 'fixed';
                    emoji.style.left = Math.random() * 100 + 'vw';
                    emoji.style.top = '-20px';
                    emoji.style.fontSize = (Math.random() * 20 + 20) + 'px';
                    emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    emoji.style.pointerEvents = 'none';
                    emoji.style.zIndex = '9999';
                    emoji.style.animation = `confettiFall ${Math.random() * 2 + 3}s ease-out forwards`;

                    document.body.appendChild(emoji);
                    setTimeout(() => emoji.remove(), 5000);
                }, i * 40);
            }

            // Launch sparkle explosion from center
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.textContent = 'âœ¨';
                    sparkle.style.position = 'fixed';
                    sparkle.style.left = '50%';
                    sparkle.style.top = '50%';
                    sparkle.style.fontSize = '2rem';
                    sparkle.style.pointerEvents = 'none';
                    sparkle.style.zIndex = '9999';

                    const angle = (Math.PI * 2 * i) / 30;
                    const distance = 150 + Math.random() * 200;
                    const tx = Math.cos(angle) * distance;
                    const ty = Math.sin(angle) * distance;

                    sparkle.style.animation = `sparkleExplode 1.5s ease-out forwards`;
                    sparkle.style.setProperty('--tx', tx + 'px');
                    sparkle.style.setProperty('--ty', ty + 'px');

                    document.body.appendChild(sparkle);
                    setTimeout(() => sparkle.remove(), 1500);
                }, i * 20);
            }
        }

        // ===== ELIMINATION SYSTEM =====

        const eliminationMessages = [
            "Mission failed. Better luck next time! ðŸŽ¯",
            "Your wizard has left the building ðŸšª",
            "The cards have spoken... farewell! ðŸƒ",
            "Disconnected from the tournament matrix ðŸ”Œ",
            "Your journey ends here, brave wizard âš”ï¸",
            "The tournament gods have decided ðŸŒ©ï¸",
            "You've been outplayed... literally! ðŸ‘‹",
            "Time to hang up your wizard hat ðŸŽ©",
            "Not today, champion. Not today. âŒ",
            "The elimination train has no brakes! ðŸš‚"
        ];

        const winnerMessages = [
            "Absolute mastery! Your wizard skills are legendary!",
            "Flawless victory! You've conquered the tournament!",
            "The prophecy has been fulfilled! Hail the champion!",
            "Unbelievable! You're the ultimate wizard master!",
            "Legendary performance! The cards bow to you!",
            "Supreme excellence! You are the chosen one!"
        ];

        function generateEliminationSchedule(numPlayers) {
            const schedule = [];

            // Fixed elimination rounds based on player count
            // Pattern: Eliminate player-by-player until 3 final players remain
            switch(numPlayers) {
                case 9:
                    schedule.push(6, 7, 8, 10, 12, 15); // 6 eliminations: 9â†’3
                    break;
                case 8:
                    schedule.push(7, 8, 10, 12, 15); // 5 eliminations: 8â†’3
                    break;
                case 7:
                    schedule.push(8, 10, 12, 15); // 4 eliminations: 7â†’3
                    break;
                case 6:
                    schedule.push(10, 12, 15); // 3 eliminations: 6â†’3
                    break;
                case 5:
                    schedule.push(12, 15); // 2 eliminations: 5â†’3
                    break;
                case 4:
                    schedule.push(15); // 1 elimination: 4â†’3
                    break;
                // 3 or fewer: no eliminations, play all 20 rounds
            }

            return schedule;
        }

        function launchEliminationParticles() {
            const emojis = ['ðŸ’€', 'âš¡', 'ðŸ’¥', 'ðŸ”¥', 'â˜ ï¸', 'âŒ'];

            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'elimination-particle';
                    particle.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    particle.style.left = '50%';
                    particle.style.top = '50%';

                    const angle = (Math.PI * 2 * i) / 20;
                    const distance = 200 + Math.random() * 200;
                    const tx = Math.cos(angle) * distance;
                    const ty = Math.sin(angle) * distance;

                    particle.style.setProperty('--tx', tx + 'px');
                    particle.style.setProperty('--ty', ty + 'px');

                    document.body.appendChild(particle);
                    setTimeout(() => particle.remove(), 1000);
                }, i * 50);
            }
        }

        function closeEliminationModal() {
            document.getElementById('eliminationModal').classList.remove('active');
        }

        function eliminatePlayer() {
            const activePlayers = gameState.players.filter(p => !gameState.eliminated.includes(p));

            // Always end with 3 final players
            if (activePlayers.length <= 3) {
                console.log('âœ“ Final 3 players reached!');
                showToast('Final 3 players! Play to round 20!', 'info', 3000);
                return;
            }

            // Find player(s) with lowest score (excluding eliminated)
            const scores = activePlayers.map(p => ({
                name: p,
                score: gameState.scores[p]
            }));

            const lowestScore = Math.min(...scores.map(s => s.score));
            const lowestPlayers = scores.filter(s => s.score === lowestScore);

            // For now, eliminate first player if tied (TODO: implement duel system)
            const eliminated = lowestPlayers[0].name;

            // Add to eliminated list
            if (!gameState.eliminated) {
                gameState.eliminated = [];
            }
            gameState.eliminated.push(eliminated);

            console.log(`ðŸ’€ ${eliminated} has been eliminated! (Score: ${lowestScore})`);

            // Show elimination modal
            showEliminationAnimation(eliminated, lowestScore);

            // Update statistics
            updateStatistics();
        }

        function showEliminationAnimation(playerName, finalScore) {
            // Launch elimination particles
            launchEliminationParticles();

            // Play elimination sound
            playSound('error'); // Use error sound as elimination sound

            // Show modal
            const modal = document.getElementById('eliminationModal');
            document.getElementById('eliminatedName').textContent = playerName;
            document.getElementById('eliminatedRound').textContent = gameState.currentRound;
            document.getElementById('eliminatedScore').textContent = finalScore;

            // Random elimination message
            const message = eliminationMessages[Math.floor(Math.random() * eliminationMessages.length)];
            document.getElementById('eliminationMessage').textContent = message;

            modal.classList.add('active');

            // Show toast
            showToast(`${playerName} has been eliminated!`, 'error', 3000);
        }

        // ===== STATISTICS DASHBOARD =====

        function updateStatistics() {
            const dashboard = document.getElementById('statsDashboard');

            if (gameState.phase === 'setup' || gameState.phase === 'dealing') {
                dashboard.style.display = 'none';
                return;
            }

            dashboard.style.display = 'block';

            // Active players
            const activePlayers = gameState.players.filter((_, idx) =>
                !gameState.eliminated || !gameState.eliminated[idx]
            ).length;
            document.getElementById('statActivePlayers').textContent = activePlayers;

            // Leader
            let maxScore = -Infinity;
            let leader = 'â€”';
            gameState.players.forEach(player => {
                if (gameState.scores[player] > maxScore) {
                    maxScore = gameState.scores[player];
                    leader = player;
                }
            });
            document.getElementById('statLeader').textContent = leader;

            // Average score
            const totalScore = gameState.players.reduce((sum, player) =>
                sum + gameState.scores[player], 0
            );
            const avgScore = Math.round(totalScore / gameState.players.length);
            document.getElementById('statAvgScore').textContent = avgScore;

            // Highest score
            document.getElementById('statHighScore').textContent = maxScore;
        }

        // ===== INITIALIZATION =====

        window.onload = function() {
            generatePlayerInputs();
            console.log('ðŸŽ´ Wizard Complete Game Loaded!');
            initializeSocket();
        };

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /*   ONLINE MULTIPLAYER CLIENT CODE                                 */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        let socket = null;
        let onlineMode = false;
        let currentRoom = null;
        let currentPlayerName = '';
        let isHost = false;

        // Initialize Socket.io connection
        function initializeSocket() {
            try {
                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                // SERVER CONNECTION
                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                // Server hosted on Render: https://wizard-game-server-wvwp.onrender.com
                const RENDER_SERVER = 'https://wizard-game-server-wvwp.onrender.com';

                // Auto-detect environment
                const isLocalhost = window.location.hostname === 'localhost' ||
                                   window.location.hostname === '127.0.0.1';

                const isRenderDomain = window.location.hostname.includes('onrender.com');

                let serverUrl;
                if (isLocalhost) {
                    serverUrl = 'http://localhost:3000'; // Local development
                } else if (isRenderDomain) {
                    // On Render: use same domain (server and files hosted together)
                    serverUrl = window.location.origin;
                } else {
                    // GitHub Pages: connect to Render server
                    serverUrl = RENDER_SERVER;
                }

                console.log(`ðŸ”Œ Connecting to: ${serverUrl}`);
                socket = io(serverUrl, {
                    transports: ['websocket', 'polling'],
                    reconnection: true,
                    reconnectionDelay: 1000,
                    reconnectionAttempts: 5
                });

                socket.on('connect', () => {
                    console.log('âœ… Connected to server');
                    document.getElementById('connectionIndicator').className = 'status-indicator connected';
                    document.getElementById('connectionText').textContent = 'Connected to server';
                });

                socket.on('disconnect', () => {
                    console.log('âŒ Disconnected from server');
                    document.getElementById('connectionIndicator').className = 'status-indicator disconnected';
                    document.getElementById('connectionText').textContent = 'Disconnected - Reconnecting...';
                });

                // Handle room created
                socket.on('room-created', ({ roomCode, playerList }) => {
                    console.log('ðŸŽ¯ Room created:', roomCode);
                    currentRoom = roomCode;
                    isHost = true;
                    onlineMode = true;
                    document.getElementById('displayRoomCode').textContent = roomCode;
                    updatePlayersList(playerList);
                    showWaitingRoom();

                    // Update status (host alone, waiting for players)
                    updateWaitingStatus(playerList, false);
                });

                // Handle room joined
                socket.on('room-joined', ({ roomCode, playerList }) => {
                    console.log('âœ… Joined room:', roomCode);
                    currentRoom = roomCode;
                    isHost = false;
                    onlineMode = true;
                    document.getElementById('displayRoomCode').textContent = roomCode;
                    updatePlayersList(playerList);
                    showWaitingRoom();
                });

                // Handle join error
                socket.on('join-error', ({ error }) => {
                    console.error('âŒ Join error:', error);
                    const errorEl = document.getElementById('joinError');
                    errorEl.textContent = error;
                    errorEl.style.display = 'block';
                });

                // Handle player joined
                socket.on('player-joined', ({ playerName: newPlayer, playerList }) => {
                    console.log('ðŸ‘¤ Player joined:', newPlayer);
                    updatePlayersList(playerList);
                    showToast(`${newPlayer} joined!`, 'info', 2000);
                    playSound('cardPlace');

                    // Update waiting status (updateWaitingStatus handles button display)
                    updateWaitingStatus(playerList, false);
                });

                // Handle player left
                socket.on('player-left', ({ playerName: leftPlayer, playerList }) => {
                    console.log('ðŸ‘‹ Player left:', leftPlayer);
                    updatePlayersList(playerList);
                    showToast(`${leftPlayer} left`, 'info', 2000);
                });

                // Handle player list updated (when someone clicks READY)
                socket.on('player-list-updated', ({ playerList, canStart }) => {
                    updatePlayersList(playerList);
                    updateWaitingStatus(playerList, canStart);
                });

                // Handle game started
                socket.on('game-started', ({ gameState }) => {
                    console.log('ðŸŽ® Game started!');
                    startOnlineGame();
                });

            } catch (error) {
                console.error('Failed to initialize socket:', error);
                document.getElementById('connectionText').textContent = 'Server offline - Local mode only';
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /*   LOBBY UI NAVIGATION FUNCTIONS                                  */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        function showCreateRoom() {
            currentPlayerName = document.getElementById('playerNameInput').value.trim();
            if (!currentPlayerName) {
                showToast('Please enter your name first!', 'error', 2000);
                document.getElementById('playerNameInput').focus();
                return;
            }
            if (!socket || !socket.connected) {
                showToast('Not connected to server. Please check if server is running.', 'error', 3000);
                return;
            }
            socket.emit('create-room', { playerName: currentPlayerName });
        }

        function showJoinRoom() {
            currentPlayerName = document.getElementById('playerNameInput').value.trim();
            if (!currentPlayerName) {
                showToast('Please enter your name first!', 'error', 2000);
                document.getElementById('playerNameInput').focus();
                return;
            }
            if (!socket || !socket.connected) {
                showToast('Not connected to server. Please check if server is running.', 'error', 3000);
                return;
            }
            document.getElementById('lobbyScreen').style.display = 'none';
            document.getElementById('joinRoomScreen').style.display = 'flex';
        }

        function joinRoom() {
            const roomCode = document.getElementById('roomCodeInput').value.trim();
            if (!roomCode || roomCode.length !== 6) {
                const errorEl = document.getElementById('joinError');
                errorEl.textContent = 'Please enter a valid 6-digit room code';
                errorEl.style.display = 'block';
                return;
            }
            socket.emit('join-room', { roomCode, playerName: currentPlayerName });
        }

        function backToLobby() {
            document.getElementById('joinRoomScreen').style.display = 'none';
            document.getElementById('lobbyScreen').style.display = 'flex';
            document.getElementById('joinError').style.display = 'none';
            document.getElementById('roomCodeInput').value = '';
        }

        function showWaitingRoom() {
            document.getElementById('lobbyScreen').style.display = 'none';
            document.getElementById('joinRoomScreen').style.display = 'none';
            document.getElementById('waitingRoomScreen').style.display = 'flex';

            // Everyone (including host) needs to click READY
            const readyBtn = document.getElementById('readyBtn');
            readyBtn.style.display = 'flex';

            // Reset ready state
            readyBtn.classList.remove('active');
            document.getElementById('readyBtnText').textContent = 'READY';
        }

        function playLocal() {
            console.log('ðŸ  Starting local game');
            onlineMode = false;
            document.getElementById('lobbyScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'flex';
        }

        function toggleReady() {
            socket.emit('player-ready', { roomCode: currentRoom });
            const btn = document.getElementById('readyBtn');
            const text = document.getElementById('readyBtnText');

            if (btn.classList.contains('active')) {
                btn.classList.remove('active');
                text.textContent = 'READY';
            } else {
                btn.classList.add('active');
                text.textContent = 'NOT READY';
            }
        }

        function startOnlineGame() {
            if (!isHost) return;

            // Get player count from room
            const playerCards = document.querySelectorAll('.player-card');
            const playerCount = playerCards.length;

            // Emit start game event
            socket.emit('start-game', {
                roomCode: currentRoom,
                gameState: {
                    playerCount,
                    playerNames: Array.from(playerCards).map(card =>
                        card.querySelector('.player-name-display').textContent.replace(/HOST|READY/g, '').trim()
                    )
                }
            });

            // Hide waiting room, show setup screen
            document.getElementById('waitingRoomScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'flex';

            // Auto-select player count
            const buttons = document.querySelectorAll('.player-count-btn');
            buttons.forEach(btn => btn.classList.remove('selected'));
            const targetBtn = document.querySelector(`[onclick*="selectPlayerCount(${playerCount}"]`);
            if (targetBtn) {
                targetBtn.classList.add('selected');
                selectPlayerCount(playerCount, targetBtn);
            }
        }

        function leaveRoom() {
            if (currentRoom) {
                socket.emit('leave-room', { roomCode: currentRoom });
            }
            currentRoom = null;
            isHost = false;
            onlineMode = false;

            document.getElementById('waitingRoomScreen').style.display = 'none';
            document.getElementById('lobbyScreen').style.display = 'flex';

            // Reset ready button
            const btn = document.getElementById('readyBtn');
            btn.classList.remove('active');
            document.getElementById('readyBtnText').textContent = 'READY';
        }

        function leaveGame() {
            // Show custom modal instead of browser confirm
            document.getElementById('leaveGameModal').classList.add('active');
            playSound('cardPlace');
        }

        function closeLeaveGameModal() {
            document.getElementById('leaveGameModal').classList.remove('active');
            playSound('cardPlace');
        }

        function confirmLeaveGame() {
            document.getElementById('leaveGameModal').classList.remove('active');
            playSound('bidConfirm');

            // Leave online room if in online mode
            if (onlineMode && currentRoom) {
                socket.emit('leave-room', { roomCode: currentRoom });
            }

            // Reset all game state
            currentRoom = null;
            isHost = false;
            onlineMode = false;

            // Hide game screen, show lobby
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('waitingRoomScreen').style.display = 'none';
            document.getElementById('lobbyScreen').style.display = 'flex';

            // Reset ready button
            const btn = document.getElementById('readyBtn');
            btn.classList.remove('active');
            document.getElementById('readyBtnText').textContent = 'READY';

            showToast('Returned to lobby', 'info', 2000);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /*   WAITING ROOM UI UPDATES                                        */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        function updatePlayersList(playerList) {
            const container = document.getElementById('playersList');
            document.getElementById('playerCountBadge').textContent = `${playerList.length}/6`;

            container.innerHTML = playerList.map(player => `
                <div class="player-card ${player.isReady ? 'ready' : ''} ${player.isHost ? 'host' : ''}">
                    <div class="player-info-left">
                        <div class="player-avatar">${player.name.charAt(0).toUpperCase()}</div>
                        <div>
                            <div class="player-name-display">
                                ${player.name}
                                ${player.isHost ? '<span class="player-badge badge-host">HOST</span>' : ''}
                                ${player.isReady ? '<span class="player-badge badge-ready">âœ“ READY</span>' : ''}
                            </div>
                        </div>
                    </div>
                    <div class="player-status">
                        ${player.connected ? 'ðŸŸ¢' : 'ðŸ”´'}
                    </div>
                </div>
            `).join('');
        }

        function updateWaitingStatus(playerList, canStart) {
            const readyCount = playerList.filter(p => p.isReady).length;
            const totalCount = playerList.length;
            const minPlayers = 3;

            const waitingText = document.getElementById('waitingText');
            const startBtn = document.getElementById('startGameBtn');

            if (totalCount < minPlayers) {
                const needed = minPlayers - totalCount;
                waitingText.textContent = `Waiting for ${needed} more player${needed > 1 ? 's' : ''} to join... (Min: ${minPlayers} players)`;
                waitingText.style.color = 'var(--text-secondary)';
                if (isHost) startBtn.style.display = 'none';
            } else if (readyCount < totalCount) {
                const notReady = totalCount - readyCount;
                const notReadyPlayers = playerList.filter(p => !p.isReady).map(p => p.name).join(', ');
                waitingText.textContent = `Waiting for ${notReady} player${notReady > 1 ? 's' : ''} to ready up: ${notReadyPlayers}`;
                waitingText.style.color = 'var(--accent)';
                if (isHost) startBtn.style.display = 'none';
            } else {
                waitingText.textContent = 'ðŸŽ‰ All players ready! Host can start the game now!';
                waitingText.style.color = 'var(--success)';
                if (isHost) startBtn.style.display = 'flex';
            }
        }

        function copyRoomCode() {
            const code = document.getElementById('displayRoomCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showToast('Room code copied to clipboard!', 'success', 1500);
                playSound('cardPlace');
            }).catch(() => {
                showToast('Could not copy code', 'error', 1500);
            });
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /*   UTILITY FUNCTIONS                                              */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        function hideAllScreens() {
            document.getElementById('lobbyScreen').style.display = 'none';
            document.getElementById('joinRoomScreen').style.display = 'none';
            document.getElementById('waitingRoomScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'none';
        }

        console.log('ðŸŽ® Wizard Online Multiplayer System Loaded!');
    </script>
</body>
</html>
