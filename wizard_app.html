<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#8B5CF6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Wizard Tournament â€¢ Professional Score Tracker</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%238B5CF6;stop-opacity:1' /><stop offset='100%25' style='stop-color:%2306B6D4;stop-opacity:1' /></linearGradient></defs><circle cx='50' cy='50' r='45' fill='url(%23grad)'/><text x='50' y='70' font-size='60' font-family='Arial' font-weight='bold' fill='white' text-anchor='middle'>W</text></svg>">

    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">

    <!-- Apple Touch Icons - iOS Optimized -->
    <link rel="apple-touch-icon" href="./icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="192x192" href="./icons/icon-192x192.png">
    <meta name="apple-mobile-web-app-title" content="Wizard">

    <!-- Additional PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Wizard Tournament">
    <link rel="shortcut icon" href="./icons/icon-192x192.png">

    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileColor" content="#8B5CF6">
    <meta name="msapplication-TileImage" content="./icons/icon-192x192.png">
    <meta name="msapplication-config" content="none">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;900&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            /* Professional Color System */
            --primary: #8B5CF6;
            --primary-light: #A78BFA;
            --primary-dark: #7C3AED;
            --secondary: #06B6D4;
            --secondary-light: #22D3EE;
            --accent: #EC4899;
            --accent-light: #F472B6;
            --success: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;

            /* Dark Professional Theme */
            --bg-primary: #0F172A;
            --bg-secondary: #1E293B;
            --bg-tertiary: #334155;
            --surface: rgba(30, 41, 59, 0.8);
            --surface-glass: rgba(139, 92, 246, 0.1);

            /* Text Hierarchy */
            --text-primary: #F1F5F9;
            --text-secondary: #CBD5E1;
            --text-tertiary: #94A3B8;
            --text-muted: #64748B;

            /* Shadows & Effects */
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.4);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.5);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.6);
            --glow-primary: 0 0 20px rgba(139, 92, 246, 0.5);
            --glow-secondary: 0 0 20px rgba(6, 182, 212, 0.5);
            --glow-danger: 0 0 20px rgba(239, 68, 68, 0.5);

            /* Spacing System */
            --space-xs: 0.5rem;
            --space-sm: 1rem;
            --space-md: 1.5rem;
            --space-lg: 2rem;
            --space-xl: 3rem;

            /* Border Radius System */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 9999px;

            /* Animation Timing */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 400ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background System */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg,
                var(--bg-primary) 0%,
                var(--bg-secondary) 50%,
                var(--bg-primary) 100%);
            animation: gradientShift 15s ease infinite;
            z-index: -2;
        }

        body::after {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background:
                radial-gradient(circle at 20% 30%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(6, 182, 212, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(236, 72, 153, 0.1) 0%, transparent 50%);
            animation: orbsMove 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes gradientShift {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(-5%, 5%); }
        }

        @keyframes orbsMove {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(3%, -3%) rotate(180deg); }
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-md);
            position: relative;
            z-index: 1;
        }

        /* Professional Header */
        .header {
            text-align: center;
            padding: var(--space-lg) 0;
            margin-bottom: var(--space-lg);
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, transparent 70%);
            filter: blur(80px);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
            50% { transform: translate(-50%, -50%) scale(1.15); opacity: 0.8; }
        }

        .logo {
            font-family: 'Orbitron', monospace;
            font-size: clamp(2.5rem, 8vw, 4rem);
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 4px;
            position: relative;
            display: inline-block;
            animation: logoGlow 3s ease-in-out infinite;
        }

        @keyframes logoGlow {
            0%, 100% { filter: drop-shadow(0 0 15px rgba(139, 92, 246, 0.6)); }
            50% { filter: drop-shadow(0 0 30px rgba(139, 92, 246, 0.9)); }
        }

        .tagline {
            font-size: clamp(0.875rem, 2vw, 1.125rem);
            color: var(--text-secondary);
            margin-top: var(--space-sm);
            font-weight: 600;
            letter-spacing: 4px;
            text-transform: uppercase;
        }

        /* Glass Card System */
        .glass-card {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: var(--radius-xl);
            padding: var(--space-lg);
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
            transition: all var(--transition-base);
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                transparent,
                rgba(139, 92, 246, 0.1),
                transparent);
            transition: left 0.6s;
        }

        .glass-card:hover::before {
            left: 100%;
        }

        .glass-card:hover {
            border-color: rgba(139, 92, 246, 0.5);
            box-shadow: 0 12px 48px rgba(139, 92, 246, 0.3);
        }

        /* Section Title */
        .section-title {
            font-family: 'Orbitron', monospace;
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--primary), var(--secondary));
            border-radius: var(--radius-full);
            box-shadow: var(--glow-primary);
        }

        /* Input System */
        .input-group {
            margin-bottom: var(--space-md);
        }

        .input-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--text-secondary);
            margin-bottom: var(--space-xs);
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .input-field {
            width: 100%;
            padding: 1rem 1.25rem;
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 500;
            transition: all var(--transition-base);
            outline: none;
        }

        .input-field:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.2), var(--glow-primary);
            background: rgba(15, 23, 42, 0.9);
        }

        .input-field:hover {
            border-color: rgba(139, 92, 246, 0.5);
        }

        /* Professional Number Spinner */
        .number-spinner {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: var(--radius-md);
            padding: 0.25rem;
            transition: all var(--transition-base);
            max-width: 120px;
        }

        .number-spinner:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }

        .spinner-btn {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border: none;
            border-radius: var(--radius-sm);
            color: white;
            font-size: 0.875rem;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-fast);
            outline: none;
            flex-shrink: 0;
        }

        .spinner-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.6);
        }

        .spinner-btn:active {
            transform: scale(0.95);
        }

        .spinner-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
        }

        .spinner-input {
            flex: 1;
            min-width: 40px;
            text-align: center;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-family: 'Orbitron', monospace;
            font-size: 1rem;
            font-weight: 700;
            outline: none;
        }

        /* Large Spinner for Setup */
        .number-spinner-large {
            max-width: 100%;
            padding: 0.5rem;
        }

        .number-spinner-large .spinner-btn {
            width: 48px;
            height: 48px;
            font-size: 1.5rem;
        }

        .number-spinner-large .spinner-input {
            font-size: 1.5rem;
            min-width: 60px;
        }

        /* Grid System */
        .grid {
            display: grid;
            gap: var(--space-md);
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        /* Professional Button System */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-xs);
            padding: 1rem 2rem;
            font-family: 'Orbitron', monospace;
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-base);
            position: relative;
            overflow: hidden;
            outline: none;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 400px;
            height: 400px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: var(--shadow-md), var(--glow-primary);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg), 0 0 35px rgba(139, 92, 246, 0.7);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg), 0 0 25px rgba(16, 185, 129, 0.6);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #DC2626 100%);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg), var(--glow-danger);
        }

        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-group {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }

        /* Statistics Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .stat-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            text-align: center;
            transition: all var(--transition-base);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity var(--transition-base);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: rgba(139, 92, 246, 0.5);
            box-shadow: 0 8px 32px rgba(139, 92, 246, 0.3);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 700;
            margin-bottom: var(--space-xs);
        }

        .stat-value {
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: var(--space-xs);
            font-weight: 500;
        }

        /* Avatar System */
        .player-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', monospace;
            font-size: 1.125rem;
            font-weight: 900;
            color: white;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            transition: all var(--transition-base);
        }

        .player-avatar:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
        }

        .avatar-large {
            width: 120px;
            height: 120px;
            font-size: 3.5rem;
            border-width: 5px;
            animation: avatarEntrance 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes avatarEntrance {
            from {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            to {
                transform: scale(1) rotate(0);
                opacity: 1;
            }
        }

        /* Schedule Box */
        .schedule-box {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border: 2px solid rgba(236, 72, 153, 0.3);
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            margin-bottom: var(--space-md);
            position: relative;
            overflow: hidden;
        }

        .schedule-box::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(236, 72, 153, 0.2) 0%, transparent 70%);
            animation: scheduleGlow 4s ease-in-out infinite;
        }

        @keyframes scheduleGlow {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.3); opacity: 0.8; }
        }

        .schedule-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--accent-light);
            margin-bottom: var(--space-sm);
        }

        .schedule-items {
            display: grid;
            gap: var(--space-xs);
        }

        .schedule-item {
            background: rgba(15, 23, 42, 0.6);
            border-left: 4px solid var(--accent);
            padding: var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            font-weight: 600;
            transition: all var(--transition-fast);
        }

        .schedule-item:hover {
            background: rgba(15, 23, 42, 0.9);
            transform: translateX(6px);
            border-left-color: var(--accent-light);
        }

        .next-elimination {
            margin-top: var(--space-sm);
            padding: var(--space-sm);
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid var(--danger);
            border-radius: var(--radius-sm);
            font-weight: 700;
            color: var(--danger);
            text-align: center;
            animation: dangerPulse 2s ease-in-out infinite;
        }

        @keyframes dangerPulse {
            0%, 100% { box-shadow: 0 0 15px rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 0 30px rgba(239, 68, 68, 0.7); }
        }

        /* Game Info Bar */
        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
            padding: var(--space-md);
            background: rgba(30, 41, 59, 0.5);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(6, 182, 212, 0.3);
        }

        .info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        .info-label {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 700;
        }

        .info-value {
            font-family: 'Orbitron', monospace;
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Professional Table */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius-lg);
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3) 0%, rgba(6, 182, 212, 0.3) 100%);
        }

        th {
            padding: 1.25rem 1rem;
            text-align: left;
            font-family: 'Orbitron', monospace;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            border-bottom: 2px solid rgba(139, 92, 246, 0.5);
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid rgba(139, 92, 246, 0.1);
            transition: all var(--transition-fast);
        }

        tr {
            transition: all var(--transition-base);
        }

        tbody tr:hover:not(.eliminated) {
            background: rgba(139, 92, 246, 0.15);
            transform: scale(1.01);
        }

        tr.eliminated {
            opacity: 0.35;
            filter: grayscale(1);
        }

        tr.eliminated td {
            text-decoration: line-through;
        }

        tr.winner {
            background: rgba(16, 185, 129, 0.25);
            box-shadow: inset 0 0 30px rgba(16, 185, 129, 0.4);
        }

        tr.danger-zone {
            background: rgba(239, 68, 68, 0.15);
            animation: dangerFlash 2s ease-in-out infinite;
        }

        @keyframes dangerFlash {
            0%, 100% { background: rgba(239, 68, 68, 0.15); }
            50% { background: rgba(239, 68, 68, 0.3); }
        }

        /* Professional Badge System */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .badge-active {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .badge-eliminated {
            background: rgba(148, 163, 184, 0.2);
            color: var(--text-tertiary);
            border: 1px solid var(--text-tertiary);
        }

        .badge-winner {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
            animation: winnerShine 1.5s ease-in-out infinite;
        }

        @keyframes winnerShine {
            0%, 100% { box-shadow: 0 0 15px rgba(245, 158, 11, 0.6); }
            50% { box-shadow: 0 0 30px rgba(245, 158, 11, 0.9); }
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
            animation: dangerPulse 2s ease-in-out infinite;
        }

        /* Score Display */
        .score {
            font-family: 'Orbitron', monospace;
            font-size: 1.125rem;
            font-weight: 700;
        }

        .score-positive {
            color: var(--success);
            text-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        .score-negative {
            color: var(--danger);
            text-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }

        /* Rank Display */
        .rank-display {
            font-family: 'Orbitron', monospace;
            font-size: 1.25rem;
            font-weight: 700;
        }

        /* Alert System */
        .alert {
            padding: var(--space-md);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-md);
            font-weight: 600;
            border-left: 4px solid;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border-color: var(--success);
        }

        .alert-danger {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border-color: var(--danger);
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border-color: var(--warning);
        }

        .alert-info {
            background: rgba(6, 182, 212, 0.2);
            color: var(--secondary-light);
            border-color: var(--secondary);
        }

        /* Professional Footer */
        .footer {
            margin-top: var(--space-xl);
            padding: var(--space-lg);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 1px;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(139, 92, 246, 0.5) 50%,
                transparent 100%);
            margin-bottom: var(--space-md);
        }

        .designer-signature {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-md) var(--space-lg);
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: var(--radius-lg);
            position: relative;
            overflow: hidden;
            transition: all var(--transition-base);
        }

        .designer-signature::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg,
                rgba(139, 92, 246, 0.1) 0%,
                rgba(6, 182, 212, 0.1) 50%,
                rgba(236, 72, 153, 0.1) 100%);
            opacity: 0;
            transition: opacity var(--transition-base);
        }

        .designer-signature:hover::before {
            opacity: 1;
        }

        .designer-signature:hover {
            border-color: rgba(139, 92, 246, 0.7);
            transform: translateY(-3px);
            box-shadow: 0 8px 32px rgba(139, 92, 246, 0.4);
        }

        .designer-label {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 700;
        }

        .designer-name {
            font-family: 'Orbitron', monospace;
            font-size: 1.75rem;
            font-weight: 900;
            background: linear-gradient(135deg,
                var(--primary-light) 0%,
                var(--secondary-light) 50%,
                var(--accent-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 3px;
            position: relative;
            animation: signatureGlow 3s ease-in-out infinite;
        }

        @keyframes signatureGlow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(139, 92, 246, 0.5)); }
            50% { filter: drop-shadow(0 0 25px rgba(139, 92, 246, 0.8)); }
        }

        .designer-title {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 600;
            letter-spacing: 1.5px;
        }

        /* Professional Custom Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-md);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(139, 92, 246, 0.4);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8), var(--glow-primary);
            animation: modalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px) scale(0.9);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }

        .modal-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--space-md);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            animation: iconPulse 2s ease-in-out infinite;
        }

        .modal-icon-warning {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid var(--danger);
            color: var(--danger);
        }

        .modal-icon-success {
            background: rgba(245, 158, 11, 0.2);
            border: 3px solid var(--warning);
            color: var(--warning);
            font-size: 4rem;
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 20px rgba(239, 68, 68, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(239, 68, 68, 0.6); }
        }

        .modal-title {
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
            text-align: center;
            background: linear-gradient(135deg, var(--warning) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-text {
            color: var(--text-secondary);
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: var(--space-lg);
            text-align: center;
        }

        .modal-buttons {
            display: flex;
            gap: var(--space-sm);
            justify-content: center;
            flex-wrap: wrap;
        }

        .modal-btn {
            flex: 1;
            min-width: 140px;
            padding: 1rem 1.5rem;
            font-family: 'Orbitron', monospace;
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-base);
            outline: none;
        }

        .modal-btn-cancel {
            background: rgba(148, 163, 184, 0.2);
            color: var(--text-secondary);
            border: 2px solid rgba(148, 163, 184, 0.3);
        }

        .modal-btn-cancel:hover {
            background: rgba(148, 163, 184, 0.3);
            border-color: rgba(148, 163, 184, 0.5);
            transform: translateY(-2px);
        }

        .modal-btn-confirm {
            background: linear-gradient(135deg, var(--danger) 0%, #DC2626 100%);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .modal-btn-confirm:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg), var(--glow-danger);
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: var(--shadow-md), var(--glow-primary);
        }

        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg), 0 0 35px rgba(139, 92, 246, 0.7);
        }

        /* Confetti Animation */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--warning);
            border-radius: 50%;
            animation: confettiFall 3s ease-out forwards;
            pointer-events: none;
            z-index: 9999;
            box-shadow: 0 0 10px currentColor;
        }

        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Sparkle Explosion Animation */
        @keyframes sparkleExplode {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) scale(0.3) rotate(360deg);
                opacity: 0;
            }
        }

        /* Trophy Icon */
        .trophy-icon {
            font-size: 6rem;
            display: inline-block;
            animation: trophyBounce 1s ease-in-out infinite;
        }

        @keyframes trophyBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        /* Elimination Modal & Animations */
        .modal-icon-eliminated {
            background: rgba(239, 68, 68, 0.2);
            border: 3px solid var(--danger);
            color: var(--danger);
            font-size: 4rem;
            animation: skullBounce 0.6s ease-in-out 3, glitchEffect 0.8s ease-in-out infinite;
        }

        @keyframes skullBounce {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.2) rotate(-15deg); }
            75% { transform: scale(1.2) rotate(15deg); }
        }

        @keyframes glitchEffect {
            0%, 100% {
                transform: translate(0, 0);
                filter: hue-rotate(0deg);
            }
            20% {
                transform: translate(-2px, 2px);
                filter: hue-rotate(90deg);
            }
            40% {
                transform: translate(2px, -2px);
                filter: hue-rotate(180deg);
            }
            60% {
                transform: translate(-2px, -2px);
                filter: hue-rotate(270deg);
            }
            80% {
                transform: translate(2px, 2px);
                filter: hue-rotate(360deg);
            }
        }

        .eliminated-avatar {
            animation: avatarElimination 1s ease-out;
            filter: grayscale(1);
        }

        @keyframes avatarElimination {
            0% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: scale(1.5) rotate(180deg);
                opacity: 0.5;
            }
            100% {
                transform: scale(0.8) rotate(360deg);
                opacity: 0.3;
            }
        }

        .elimination-title {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--danger);
            text-shadow: 0 0 20px rgba(239, 68, 68, 0.8);
            animation: dangerShake 0.5s ease-in-out 3;
        }

        @keyframes dangerShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Elimination Particles */
        .elimination-particle {
            position: fixed;
            font-size: 1.5rem;
            pointer-events: none;
            z-index: 9999;
            animation: particleExplode 1.5s ease-out forwards;
        }

        @keyframes particleExplode {
            0% {
                transform: translate(0, 0) rotate(0deg) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) rotate(720deg) scale(0.3);
                opacity: 0;
            }
        }

        /* Red Danger Particles */
        .danger-particle {
            position: fixed;
            width: 8px;
            height: 8px;
            background: var(--danger);
            border-radius: 50%;
            animation: dangerParticleFall 2s ease-out forwards;
            pointer-events: none;
            z-index: 9999;
            box-shadow: 0 0 10px var(--danger);
        }

        @keyframes dangerParticleFall {
            to {
                transform: translateY(100vh) translateX(var(--drift)) rotate(360deg);
                opacity: 0;
            }
        }

        /* Glitch Text Effect */
        .glitch-text {
            position: relative;
            animation: textGlitch 0.3s ease-in-out infinite;
        }

        @keyframes textGlitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(2px, -2px); }
            60% { transform: translate(-2px, -2px); }
            80% { transform: translate(2px, 2px); }
            100% { transform: translate(0); }
        }

        /* Hidden Utility */
        .hidden {
            display: none !important;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .container {
                padding: var(--space-sm);
            }

            .glass-card {
                padding: var(--space-md);
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .game-info {
                flex-direction: column;
            }

            table {
                font-size: 0.875rem;
            }

            th, td {
                padding: 0.875rem 0.625rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .designer-name {
                font-size: 1.5rem;
            }

            .trophy-icon {
                font-size: 4rem;
            }

            .avatar-large {
                width: 100px;
                height: 100px;
                font-size: 3rem;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(139, 92, 246, 0.3);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .player-name-with-avatar {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .winner-score-display {
            font-family: 'Orbitron', monospace;
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--warning) 0%, var(--accent) 50%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin: var(--space-md) 0;
            animation: scoreGlow 2s ease-in-out infinite;
        }

        @keyframes scoreGlow {
            0%, 100% { filter: drop-shadow(0 0 15px rgba(245, 158, 11, 0.6)); }
            50% { filter: drop-shadow(0 0 35px rgba(245, 158, 11, 0.9)); }
        }

        /* Professional Duel Tie-Breaker System */
        .duel-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin: 1rem 0;
            max-height: 60vh;
            overflow-y: auto;
        }

        .duel-players {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 1rem;
            flex-wrap: wrap;
            padding: 0.5rem;
        }

        .duel-player {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: var(--radius-md);
            min-width: 120px;
            max-width: 150px;
            transition: all 0.4s;
        }

        .duel-player.survivor {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.15);
            box-shadow: 0 0 25px rgba(16, 185, 129, 0.4);
        }

        .duel-player.eliminated {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.15);
            opacity: 0.6;
        }

        .duel-player-info {
            text-align: center;
            width: 100%;
        }

        .duel-player-name {
            font-family: 'Orbitron', monospace;
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .duel-player-score {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .duel-card {
            width: 110px;
            height: 150px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
            border-radius: 8px;
        }

        .duel-card.flipped {
            transform: rotateY(180deg);
        }

        .duel-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            overflow: hidden;
            border: 3px solid rgba(139, 92, 246, 0.6);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.4);
        }

        .duel-card-pattern {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .duel-card-front {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            transform: rotateY(180deg);
            border-radius: 8px;
            overflow: hidden;
            border: 3px solid #ddd;
            box-shadow: 0 0 30px rgba(245, 158, 11, 0.8), 0 0 50px rgba(139, 92, 246, 0.6);
        }

        /* Real Playing Card Design */
        .playing-card-content {
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 5px;
            padding: 0.4rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .card-corner {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.1rem;
            line-height: 1;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .card-corner-top {
            position: absolute;
            top: 0.4rem;
            left: 0.4rem;
        }

        .card-corner-bottom {
            position: absolute;
            bottom: 0.4rem;
            right: 0.4rem;
            transform: rotate(180deg);
        }

        .card-rank {
            font-family: 'Georgia', 'Times New Roman', serif;
            font-size: 1.5rem;
            font-weight: 900;
            line-height: 1;
            letter-spacing: -0.05em;
        }

        .card-suit {
            font-size: 1.1rem;
            line-height: 1;
        }

        .card-center {
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.15));
        }

        .card-suit-large {
            font-size: 3.5rem;
            line-height: 1;
            opacity: 1;
        }

        .card-back-design {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background:
                radial-gradient(circle at 50% 50%, #3730a3 0%, #1e1b4b 50%, #0f172a 100%);
            border-radius: 5px;
            overflow: hidden;
        }

        .card-back-circle {
            width: 55px;
            height: 55px;
            border: 4px solid rgba(139, 92, 246, 0.8);
            border-radius: 50%;
            position: absolute;
            box-shadow:
                0 0 20px rgba(139, 92, 246, 0.6),
                inset 0 0 20px rgba(139, 92, 246, 0.4);
        }

        .card-back-lines {
            width: 100%;
            height: 100%;
            background:
                repeating-linear-gradient(45deg,
                    transparent,
                    transparent 8px,
                    rgba(139, 92, 246, 0.2) 8px,
                    rgba(139, 92, 246, 0.2) 16px),
                repeating-linear-gradient(-45deg,
                    transparent,
                    transparent 8px,
                    rgba(139, 92, 246, 0.2) 8px,
                    rgba(139, 92, 246, 0.2) 16px);
        }

        .duel-vs {
            font-family: 'Orbitron', monospace;
            font-size: 1.25rem;
            font-weight: 900;
            color: var(--text-muted);
            align-self: center;
        }

        .duel-instruction {
            font-family: 'Orbitron', monospace;
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-align: center;
            padding: 0.75rem;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: var(--radius-md);
        }

        .duel-results {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .duel-result-item {
            font-family: 'Orbitron', monospace;
            font-size: 0.875rem;
            font-weight: 600;
            text-align: center;
            padding: 0.75rem;
            border-radius: var(--radius-md);
            border: 2px solid;
        }

        .duel-result-item.survivor {
            background: rgba(16, 185, 129, 0.15);
            border-color: var(--success);
            color: var(--success);
        }

        .duel-result-item.eliminated {
            background: rgba(239, 68, 68, 0.15);
            border-color: var(--danger);
            color: var(--danger);
        }

        @keyframes cardDraw {
            0% {
                transform: translateY(-50%) rotate(-5deg);
                opacity: 0;
            }
            100% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
        }

        .duel-card.drawing {
            animation: cardDraw 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .duel-card {
                width: 90px;
                height: 130px;
            }

            .card-rank {
                font-size: 1.25rem;
            }

            .card-suit {
                font-size: 0.9rem;
            }

            .card-suit-large {
                font-size: 2.75rem;
            }

            .card-back-circle {
                width: 45px;
                height: 45px;
            }

            .duel-player {
                min-width: 100px;
                max-width: 110px;
            }
        }

        /* ===== Tunisian Rules Button & Modal ===== */
        .rules-fab {
            position: fixed;
            bottom: 24px;
            left: 24px;
            z-index: 99998;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.85rem 1.4rem;
            border: 2px solid rgba(255, 206, 49, 0.5);
            border-radius: 50px;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(50, 30, 80, 0.95));
            backdrop-filter: blur(15px);
            color: #FFD700;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(255, 206, 49, 0.3), 0 0 40px rgba(139, 92, 246, 0.2);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            animation: fabPulse 3s ease-in-out infinite;
        }

        .rules-fab:hover {
            transform: scale(1.08) translateY(-2px);
            box-shadow: 0 8px 30px rgba(255, 206, 49, 0.5), 0 0 60px rgba(139, 92, 246, 0.4);
            border-color: #FFD700;
        }

        .rules-fab:active {
            transform: scale(0.97);
        }

        .rules-fab .fab-flag {
            font-size: 1.4rem;
        }

        @keyframes fabPulse {
            0%, 100% { box-shadow: 0 4px 20px rgba(255, 206, 49, 0.3), 0 0 40px rgba(139, 92, 246, 0.2); }
            50% { box-shadow: 0 4px 25px rgba(255, 206, 49, 0.5), 0 0 50px rgba(139, 92, 246, 0.35); }
        }

        /* Rules Modal Overlay */
        .rules-modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 99999;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .rules-modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .rules-modal-box {
            background: linear-gradient(145deg, #1E293B 0%, #0F172A 100%);
            border: 2px solid rgba(255, 206, 49, 0.3);
            border-radius: 24px;
            max-width: 700px;
            width: 100%;
            max-height: 88vh;
            overflow-y: auto;
            overflow-x: hidden;
            direction: ltr;
            padding: 2.5rem 2rem;
            position: relative;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.7), 0 0 80px rgba(139, 92, 246, 0.15);
            animation: modalPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 206, 49, 0.5) rgba(30, 41, 59, 0.3);
        }

        .rules-modal-content {
            direction: rtl;
            text-align: right;
        }

        @keyframes modalPop {
            from { opacity: 0; transform: scale(0.85) translateY(30px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .rules-modal-box::-webkit-scrollbar {
            width: 8px;
        }

        .rules-modal-box::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.3);
            border-radius: 4px;
        }

        .rules-modal-box::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #FFD700, #FF8C00);
            border-radius: 4px;
            border: 1px solid rgba(255, 206, 49, 0.3);
        }

        .rules-modal-box::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #FFE44D, #FFD700);
        }

        .rules-close {
            position: sticky;
            top: 0;
            float: right;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.15);
            background: rgba(239, 68, 68, 0.2);
            color: #fff;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 10;
        }

        .rules-close:hover {
            background: rgba(239, 68, 68, 0.5);
            transform: rotate(90deg) scale(1.1);
        }

        .rules-modal-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .rules-modal-header h2 {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            font-weight: 900;
            color: #FFD700;
            margin-bottom: 0.5rem;
        }

        .rules-modal-header p {
            color: var(--text-tertiary);
            font-size: 1rem;
        }

        .tn-section {
            background: rgba(139, 92, 246, 0.06);
            border-radius: 16px;
            padding: 1.4rem;
            margin-bottom: 1.2rem;
            border-right: 4px solid var(--primary);
            transition: all 0.3s ease;
        }

        .tn-section:hover {
            background: rgba(139, 92, 246, 0.12);
            transform: translateX(-4px);
        }

        .tn-section h4 {
            font-size: 1.15rem;
            margin-bottom: 0.8rem;
            color: var(--secondary-light);
        }

        .tn-section p, .tn-section li {
            color: var(--text-secondary);
            line-height: 2;
            font-size: 1rem;
        }

        .tn-section ul, .tn-section ol {
            padding-right: 1.3rem;
            padding-left: 0;
        }

        .tn-section ul {
            list-style: none;
            padding: 0;
        }

        .tn-score-box {
            padding: 1.1rem;
            border-radius: 14px;
            margin-bottom: 0.8rem;
        }

        .tn-score-good { background: rgba(16, 185, 129, 0.12); border: 1px solid rgba(16, 185, 129, 0.25); }
        .tn-score-bad { background: rgba(239, 68, 68, 0.12); border: 1px solid rgba(239, 68, 68, 0.25); }

        .tn-table {
            width: 100%;
            border-collapse: collapse;
            direction: rtl;
            text-align: right;
        }

        .tn-table td, .tn-table th {
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid rgba(139, 92, 246, 0.15);
        }

        .tn-priority-table td:first-child {
            font-weight: 700;
            white-space: nowrap;
        }

        .tn-summary {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.12), rgba(6, 182, 212, 0.08));
            border: 1px solid rgba(139, 92, 246, 0.25);
            border-radius: 16px;
            padding: 1.5rem;
        }

        .tn-summary ol {
            padding-right: 1.3rem;
            padding-left: 0;
            font-size: 1.05rem;
        }

        .tn-summary li {
            margin-bottom: 0.4rem;
            color: var(--text-secondary);
            line-height: 1.9;
        }

        .tn-got-it {
            display: block;
            width: 100%;
            margin-top: 2rem;
            padding: 1rem;
            border: none;
            border-radius: 14px;
            background: linear-gradient(135deg, #FFD700, #FF8C00);
            color: #1a1a2e;
            font-family: 'Inter', sans-serif;
            font-size: 1.15rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 206, 49, 0.3);
        }

        .tn-got-it:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 206, 49, 0.5);
        }

        @media (max-width: 768px) {
            .rules-fab {
                bottom: 16px;
                left: 16px;
                padding: 0.7rem 1.1rem;
                font-size: 0.9rem;
            }

            .rules-modal-box {
                padding: 1.8rem 1.2rem;
                border-radius: 18px;
            }

            .rules-modal-header h2 {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Professional Header -->
        <header class="header">
            <button id="muteBtn" onclick="toggleMute()" style="position: fixed; top: 20px; right: 20px; z-index: 10000; width: 60px; height: 60px; border-radius: 50%; border: 2px solid rgba(139, 92, 246, 0.5); background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(15px); color: white; font-size: 1.75rem; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 8px 32px rgba(139, 92, 246, 0.6)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 16px rgba(0, 0, 0, 0.5)'" title="Mute/Unmute">ðŸ”Š</button>
            <h1 class="logo">WIZARD</h1>
            <p class="tagline">Tournament Score Tracker</p>
        </header>

        <!-- Setup Section -->
        <section id="setupSection">
            <div class="glass-card">
                <h2 class="section-title">Tournament Setup</h2>

                <div class="grid">
                    <div class="input-group">
                        <label class="input-label">Number of Players</label>
                        <div class="number-spinner number-spinner-large">
                            <button class="spinner-btn" onclick="changePlayerCount(-1)">âˆ’</button>
                            <input type="number" class="spinner-input" id="numPlayers" min="2" max="9" value="6" readonly>
                            <button class="spinner-btn" onclick="changePlayerCount(1)">+</button>
                        </div>
                    </div>
                </div>

                <div class="schedule-box" id="schedulePreview">
                    <h3 class="schedule-title">Elimination Schedule</h3>
                    <p id="scheduleDesc" style="color: var(--text-secondary); margin-bottom: var(--space-sm); font-weight: 500;"></p>
                    <div class="schedule-items" id="scheduleItems"></div>
                    <div style="margin-top: var(--space-sm); display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: center; justify-content: center;">
                        <span style="display: inline-flex; align-items: center; gap: 0.3rem; background: rgba(139, 92, 246, 0.15); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 20px; padding: 0.3rem 0.7rem; font-size: 0.8rem; font-weight: 600; color: var(--primary-light);">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 8v4l3 3"/></svg>
                            20 Rounds
                        </span>
                        <span style="display: inline-flex; align-items: center; gap: 0.3rem; background: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 20px; padding: 0.3rem 0.7rem; font-size: 0.8rem; font-weight: 600; color: #F87171;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></svg>
                            Lowest Eliminated
                        </span>
                        <span style="display: inline-flex; align-items: center; gap: 0.3rem; background: rgba(255, 215, 0, 0.15); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 20px; padding: 0.3rem 0.7rem; font-size: 0.8rem; font-weight: 600; color: #FFD700;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6-6 6 6"/><path d="M12 3v18"/><path d="M3 21h18"/></svg>
                            Final 3
                        </span>
                    </div>
                </div>

                <div id="playerNamesContainer" class="grid grid-2"></div>

                <div style="margin-top: var(--space-lg); text-align: center;">
                    <button class="btn btn-primary" onclick="startGame()">
                        Start Tournament
                    </button>
                </div>
            </div>
        </section>

        <!-- Game Section -->
        <section id="gameSection" class="hidden">
            <!-- Statistics Dashboard -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Current Round</div>
                    <div class="stat-value"><span id="currentRound">1</span>/<span id="maxRounds">20</span></div>
                    <div class="stat-subtitle">Progress</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Cards Dealt</div>
                    <div class="stat-value" id="cardsDealt">1</div>
                    <div class="stat-subtitle">Per Player</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Active Players</div>
                    <div class="stat-value" id="activePlayers">6</div>
                    <div class="stat-subtitle">In Competition</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Eliminated</div>
                    <div class="stat-value" id="eliminatedCount">0</div>
                    <div class="stat-subtitle">Total</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Average Score</div>
                    <div class="stat-value" id="avgScore">0</div>
                    <div class="stat-subtitle">Active Players</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Highest Score</div>
                    <div class="stat-value" id="highScore">0</div>
                    <div class="stat-subtitle" id="leaderName">Current Leader</div>
                </div>
            </div>

            <div class="schedule-box" id="gameScheduleBox">
                <h3 class="schedule-title">Tournament Status</h3>
                <p id="gameScheduleDesc" style="color: var(--text-secondary); margin-bottom: var(--space-sm); font-weight: 500;"></p>
                <div class="next-elimination" id="nextElimination"></div>
            </div>

            <div id="alertContainer"></div>

            <div class="glass-card">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Player</th>
                                <th>Status</th>
                                <th>Bid</th>
                                <th>Actual</th>
                                <th>Round</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody id="gameTableBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Round Totals Bar -->
            <div id="roundTotalsBar" style="display: none; margin-top: 0.75rem; padding: 0.6rem 1rem; background: rgba(30, 41, 59, 0.7); border: 1px solid rgba(139, 92, 246, 0.2); border-radius: 12px; backdrop-filter: blur(10px);">
                <div style="display: flex; justify-content: center; align-items: center; gap: 1.5rem; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 0.4rem;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#A78BFA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
                        <span style="font-size: 0.8rem; color: var(--text-tertiary); font-weight: 600;">Bids</span>
                        <span id="totalBids" style="font-family: 'Orbitron', monospace; font-size: 1rem; font-weight: 800; color: var(--primary-light);">0</span>
                    </div>
                    <div style="width: 1px; height: 20px; background: rgba(139, 92, 246, 0.3);"></div>
                    <div style="display: flex; align-items: center; gap: 0.4rem;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#22D3EE" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                        <span style="font-size: 0.8rem; color: var(--text-tertiary); font-weight: 600;">Actual</span>
                        <span id="totalActual" style="font-family: 'Orbitron', monospace; font-size: 1rem; font-weight: 800; color: var(--secondary-light);">0</span>
                    </div>
                    <div style="width: 1px; height: 20px; background: rgba(139, 92, 246, 0.3);"></div>
                    <div style="display: flex; align-items: center; gap: 0.4rem;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#94A3B8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>
                        <span style="font-size: 0.8rem; color: var(--text-tertiary); font-weight: 600;">Tricks</span>
                        <span id="totalTricks" style="font-family: 'Orbitron', monospace; font-size: 1rem; font-weight: 800; color: var(--text-secondary);">0</span>
                    </div>
                </div>
            </div>

            <div class="btn-group" style="margin-top: var(--space-lg);">
                <button class="btn btn-success" id="calculateBtn" onclick="calculateRound()">
                    Calculate Round
                </button>
                <button class="btn btn-primary" id="nextRoundBtn" onclick="nextRound()" disabled>
                    Next Round
                </button>
                <button class="btn btn-danger" onclick="resetGame()">
                    New Game
                </button>
            </div>
        </section>

        <!-- Tunisian Rules Floating Button -->
        <button class="rules-fab" onclick="openTunisianRules()">
            <span class="fab-flag">ðŸ‡¹ðŸ‡³</span>
            <span>ÙƒÙŠÙØ§Ø´ ØªÙ„Ø¹Ø¨ØŸ</span>
        </button>

        <!-- Tunisian Rules Modal -->
        <div class="rules-modal-overlay" id="tunisianRulesModal">
            <div class="rules-modal-box">
              <div class="rules-modal-content">
                <button class="rules-close" onclick="closeTunisianRules()" style="float: left;">âœ•</button>

                <div class="rules-modal-header">
                    <h2>ðŸ‡¹ðŸ‡³ ÙƒÙŠÙØ§Ø´ ØªÙ„Ø¹Ø¨ Wizard</h2>
                    <p>Ø´Ø±Ø­ Ø¨Ø³ÙŠØ· Ø¨Ø§Ù„ØªÙˆÙ†Ø³ÙŠ Ù„Ø£ÙŠ ÙˆØ§Ø­Ø¯ ÙŠØ­Ø¨ ÙŠØªØ¹Ù„Ù‘Ù…</p>
                </div>

                <div class="tn-section" style="border-right-color: #FFD700;">
                    <h4>ðŸŽ¯ Ø´Ù†Ùˆ Ø§Ù„Ù‡Ø¯ÙØŸ</h4>
                    <p style="font-size: 1.1rem;">
                        Ø§Ù„Ù„Ø¹Ø¨Ø© ÙÙƒØ±ØªÙ‡Ø§ Ø³Ø§Ù‡Ù„Ø©: <strong style="color: #FFD700;">ØªÙˆÙ‚Ù‘Ø¹ Ù‚Ø¯Ù‘Ø§Ø´ Ù…Ù† "ØªØ±ÙŠÙƒ" Ø¨Ø§Ø´ ØªØ±Ø¨Ø­</strong> ÙÙŠ ÙƒÙ„ Ø¬ÙˆÙ„Ø©.
                        <br>Ø§Ù„ØªØ±ÙŠÙƒ ÙŠØ¹Ù†ÙŠ = Ù„Ù…Ù‘Ø© ÙˆØ­Ø¯Ø© (ÙƒÙ„ ÙˆØ§Ø­Ø¯ ÙŠØ­Ø· ÙƒØ§Ø±Ø·Ø©ØŒ ÙˆØ§Ø­Ø¯ ÙŠØ±Ø¨Ø­Ù‡Ù… Ø§Ù„ÙƒÙ„).
                        <br><br>ÙƒÙŠ ØªÙ‚ÙˆÙ„ Ù…Ø«Ù„Ø§ <strong>"Ø¨Ø§Ø´ Ù†Ø±Ø¨Ø­ 2"</strong> Ùˆ Ø¨Ø§Ù„ÙØ¹Ù„ ØªØ±Ø¨Ø­ 2 Ø¨Ø§Ù„Ø¶Ø¨Ø· â† <span style="color: #10B981;">ØªØ§Ø®Ùˆ Ù†Ù‚Ø§Ø·!</span>
                        <br>ÙƒÙŠ ØªØºÙ„Ø· â† <span style="color: #EF4444;">ØªØ®Ø³Ø± Ù†Ù‚Ø§Ø·.</span>
                        <br><br><strong>Ø§Ù„Ù„ÙŠ ÙŠØ¬Ù…Ù‘Ø¹ Ø£ÙƒØ«Ø± Ù†Ù‚Ø§Ø· ÙÙŠ Ø¢Ø®Ø± Ø§Ù„Ø¨Ø·ÙˆÙ„Ø© = Ø§Ù„Ø±Ø§Ø¨Ø­! ðŸ†</strong>
                    </p>
                </div>

                <div class="tn-section" style="border-right-color: #8B5CF6;">
                    <h4>ðŸŽ´ Ø§Ù„ÙƒÙˆØ§Ø±Ø·</h4>
                    <p>Ø§Ù„Ø¬Ùˆ ÙÙŠÙ‡ <strong>60 ÙƒØ§Ø±Ø·Ø©</strong>ØŒ Ù…Ø´ 52 ÙƒÙŠÙ…Ø§ Ø§Ù„Ø¹Ø§Ø¯ÙŠ:</p>
                    <ul style="margin-top: 0.5rem;">
                        <li style="margin-bottom: 0.4rem;">ðŸª¨ <strong style="color: #CD853F;">Ø§Ù„Ù‚Ø²Ù… (Dwarf)</strong> â€” Ø£ØµÙØ±ØŒ 13 ÙƒØ§Ø±Ø·Ø© (Ù…Ù† 1 Ù„Ù€ 13)</li>
                        <li style="margin-bottom: 0.4rem;">ðŸŒ¿ <strong style="color: #90EE90;">Ø§Ù„Ø¥Ù„Ù (Elf)</strong> â€” Ø£Ø®Ø¶Ø±ØŒ 13 ÙƒØ§Ø±Ø·Ø©</li>
                        <li style="margin-bottom: 0.4rem;">âš”ï¸ <strong style="color: #FF6347;">Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚ (Giant)</strong> â€” Ø£Ø­Ù…Ø±ØŒ 13 ÙƒØ§Ø±Ø·Ø©</li>
                        <li style="margin-bottom: 0.4rem;">ðŸ’§ <strong style="color: #87CEEB;">Ø§Ù„Ø¥Ù†Ø³Ø§Ù† (Human)</strong> â€” Ø£Ø²Ø±Ù‚ØŒ 13 ÙƒØ§Ø±Ø·Ø©</li>
                    </ul>
                    <p style="margin-top: 1rem; margin-bottom: 0.5rem; color: var(--text-tertiary); font-size: 0.9rem;">âœ¨ ÙƒÙˆØ§Ø±Ø· Ø®Ø§ØµÙ‘Ø© (Ù…Ø§ Ø¹Ù†Ø¯Ù‡Ù…Ø´ Ù„ÙˆÙ†ØŒ ÙŠØªÙ„Ø¹Ø¨Ùˆ ÙˆÙ‚ØªØ§Ø´ Ù…Ø§ ØªØ­Ø¨):</p>
                    <div style="display: flex; flex-direction: column; gap: 0.6rem;">
                        <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 140, 0, 0.08)); border: 1px solid rgba(255, 215, 0, 0.35); border-radius: 12px; padding: 0.8rem 1rem; display: flex; align-items: center; gap: 0.6rem;">
                            <span style="font-size: 1.8rem;">â­</span>
                            <div>
                                <strong style="color: #FFD700; font-size: 1.05rem;">Ø§Ù„Ø³Ø§Ø­Ø± (Wizard)</strong><span style="color: var(--text-tertiary);"> â€” 4 ÙƒÙˆØ§Ø±Ø·</span>
                                <br><span style="color: #FFD700;">Ø¯ÙŠÙ…Ø§ ÙŠØ±Ø¨Ø­! ðŸ’ª Ù…Ø§ ÙŠØºÙ„Ø¨Ùˆ Ø­ØªÙ‰ Ø­Ø§Ø¬Ø©</span>
                            </div>
                        </div>
                        <div style="background: linear-gradient(135deg, rgba(255, 105, 180, 0.15), rgba(236, 72, 153, 0.08)); border: 1px solid rgba(255, 105, 180, 0.35); border-radius: 12px; padding: 0.8rem 1rem; display: flex; align-items: center; gap: 0.6rem;">
                            <span style="font-size: 1.8rem;">ðŸƒ</span>
                            <div>
                                <strong style="color: #FF69B4; font-size: 1.05rem;">Ø§Ù„Ù…Ù‡Ø±Ù‘Ø¬ (Jester)</strong><span style="color: var(--text-tertiary);"> â€” 4 ÙƒÙˆØ§Ø±Ø·</span>
                                <br><span style="color: #EF4444;">Ø¯ÙŠÙ…Ø§ ÙŠØ®Ø³Ø± ðŸ˜… Ù…Ø§ ÙŠØ±Ø¨Ø­ Ø£Ø¨Ø¯Ø§</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tn-section" style="border-right-color: #10B981;">
                    <h4>ðŸŽ® Ø§Ù„Ù„Ø¹Ø¨Ø© ÙƒÙŠÙØ§Ø´ ØªÙ…Ø´ÙŠØŸ</h4>
                    <ol style="padding-right: 1.5rem;">
                        <li style="margin-bottom: 1rem;">
                            <strong style="color: #A78BFA;">ðŸƒ Ø§Ù„ØªÙˆØ²ÙŠØ¹</strong><br>
                            Ø§Ù„Ø¬ÙˆÙ„Ø© 1 â† ÙƒØ§Ø±Ø·Ø© ÙˆØ­Ø¯Ø© Ù„ÙƒÙ„ Ù„Ø¹Ù‘Ø§Ø¨<br>
                            Ø§Ù„Ø¬ÙˆÙ„Ø© 2 â† ÙƒØ§Ø±Ø·ØªÙŠÙ†<br>
                            Ø§Ù„Ø¬ÙˆÙ„Ø© 5 â† 5 ÙƒÙˆØ§Ø±Ø·... ÙˆÙ‡ÙƒÙ‘Ø§ Ù„Ø­Ø¯ Ø§Ù„Ø¬ÙˆÙ„Ø© 20!
                        </li>
                        <li style="margin-bottom: 1rem;">
                            <strong style="color: #A78BFA;">ðŸŽº Ø§Ù„Ø£ØªÙˆ (Trump)</strong><br>
                            Ø¨Ø¹Ø¯ Ø§Ù„ØªÙˆØ²ÙŠØ¹ØŒ Ù†Ù‚Ù„Ø¨Ùˆ ÙƒØ§Ø±Ø·Ø© Ù…Ù† Ø§Ù„Ø¨Ø§Ù‚ÙŠ. Ø§Ù„Ù„ÙˆÙ† Ù…ØªØ§Ø¹Ù‡Ø§ Ù‡Ùˆ <strong>"Ø§Ù„Ø£ØªÙˆ"</strong> = Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù„ÙŠ ÙŠØºÙ„Ø¨ Ø§Ù„ÙƒÙ„.
                            <br><span style="color: var(--text-tertiary);">â­ ÙƒØ§Ù† Ø·Ù„Ø¹ Ø³Ø§Ø­Ø± â† Ø§Ù„Ù…ÙˆØ²Ù‘Ø¹ ÙŠØ®ØªØ§Ø± Ø§Ù„Ø£ØªÙˆ</span>
                            <br><span style="color: var(--text-tertiary);">ðŸƒ ÙƒØ§Ù† Ø·Ù„Ø¹ Ù…Ù‡Ø±Ù‘Ø¬ â† Ù…Ø§ ÙÙ…Ù‘Ø§Ø´ Ø£ØªÙˆ Ù‡Ø§Ù„Ø¬ÙˆÙ„Ø©</span>
                        </li>
                        <li style="margin-bottom: 1rem;">
                            <strong style="color: #A78BFA;">ðŸ“¢ Ø§Ù„Ù…Ø²Ø§ÙŠØ¯Ø© (Bid)</strong><br>
                            ÙƒÙ„ ÙˆØ§Ø­Ø¯ ÙŠØ´ÙˆÙ ÙƒÙˆØ§Ø±Ø·Ùˆ Ùˆ ÙŠÙ‚ÙˆÙ„ Ù‚Ø¯Ù‘Ø§Ø´ Ø¨Ø§Ø´ ÙŠØ±Ø¨Ø­.<br>
                            <em style="color: var(--text-tertiary);">Ù…Ø«Ø§Ù„: Ø¹Ù†Ø¯Ùƒ Ø³Ø§Ø­Ø± + 13 Ø£ØªÙˆ â† Ù‚ÙˆÙ„ 2</em>
                        </li>
                        <li style="margin-bottom: 1rem;">
                            <strong style="color: #A78BFA;">ðŸŽ´ Ø§Ù„Ù„Ø¹Ø¨</strong><br>
                            ÙˆØ§Ø­Ø¯ ÙŠØ¨Ø¯Ø§ ÙŠØ­Ø· ÙƒØ§Ø±Ø·Ø© â† Ø§Ù„Ø¨Ø§Ù‚ÙŠ ÙŠØªØ¨Ù‘Ø¹Ùˆ <strong>Ù†ÙØ³ Ø§Ù„Ù„ÙˆÙ†</strong>.<br>
                            Ù…Ø§ Ø¹Ù†Ø¯ÙƒØ´ Ù†ÙØ³ Ø§Ù„Ù„ÙˆÙ†ØŸ â† Ø­Ø· Ø£ÙŠ Ø­Ø§Ø¬Ø© (ØªÙ†Ø¬Ù‘Ù… ØªØ¶Ø±Ø¨ Ø¨Ø§Ù„Ø£ØªÙˆ!)<br>
                            Ø§Ù„Ø³Ø§Ø­Ø± â­ Ùˆ Ø§Ù„Ù…Ù‡Ø±Ù‘Ø¬ ðŸƒ â† ØªÙ„Ø¹Ø¨Ù‡Ù… ÙˆÙ‚ØªØ§Ø´ Ù…Ø§ ØªØ­Ø¨.
                        </li>
                        <li style="margin-bottom: 0.5rem;">
                            <strong style="color: #A78BFA;">ðŸ† Ø´ÙƒÙˆÙ† ÙŠØ±Ø¨Ø­ Ø§Ù„ØªØ±ÙŠÙƒØŸ</strong><br>
                            <table class="tn-table tn-priority-table" style="margin-top: 0.5rem;">
                                <tr>
                                    <td style="color: #FFD700;">1. â­ Ø§Ù„Ø³Ø§Ø­Ø±</td>
                                    <td>Ø¯ÙŠÙ…Ø§ ÙŠØ±Ø¨Ø­! (ÙƒØ§Ù† Ø²ÙˆØ² â† Ø§Ù„Ø£ÙˆÙ„ ÙŠØ±Ø¨Ø­)</td>
                                </tr>
                                <tr>
                                    <td style="color: #F59E0B;">2. ðŸŽº Ø§Ù„Ø£ØªÙˆ</td>
                                    <td>ÙŠØºÙ„Ø¨ ÙƒÙ„ Ø´ÙŠ Ù…Ø§Ø¹Ø¯Ø§ Ø§Ù„Ø³Ø§Ø­Ø±</td>
                                </tr>
                                <tr>
                                    <td style="color: #A78BFA;">3. ðŸŽ´ Ù„ÙˆÙ† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</td>
                                    <td>Ø§Ù„Ø£ÙƒØ¨Ø± ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù„ÙˆÙ† ÙŠØ±Ø¨Ø­</td>
                                </tr>
                                <tr>
                                    <td style="color: #EF4444;">4. ðŸƒ Ø§Ù„Ù…Ù‡Ø±Ù‘Ø¬</td>
                                    <td>Ø¯ÙŠÙ…Ø§ ÙŠØ®Ø³Ø±!</td>
                                </tr>
                            </table>
                        </li>
                    </ol>
                </div>

                <div class="tn-section" style="border-right-color: #F59E0B;">
                    <h4>ðŸ’° Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·</h4>
                    <div class="tn-score-box tn-score-good">
                        <strong style="color: #10B981; font-size: 1.1rem;">âœ… ÙƒÙŠ ØªØµÙŠØ¨ Ø§Ù„ØªÙˆÙ‚Ù‘Ø¹ Ø¨Ø§Ù„Ø¶Ø¨Ø·:</strong><br>
                        <span style="font-size: 1.4rem; color: #FFD700; font-weight: 800;">20 + (10 Ã— Ø¹Ø¯Ø¯ Ø§Ù„ØªØ±ÙŠÙƒØ§Øª)</span><br>
                        <span style="color: var(--text-tertiary);">Ù…Ø«Ø§Ù„: Ù‚Ù„Øª 3 Ùˆ Ø±Ø¨Ø­Øª 3 â† 20 + 30 = <strong style="color: #10B981;">+50 Ù†Ù‚Ø·Ø©</strong></span><br>
                        <span style="color: var(--text-tertiary);">Ù…Ø«Ø§Ù„: Ù‚Ù„Øª 0 Ùˆ Ù…Ø§ Ø±Ø¨Ø­Øª Ø­ØªÙ‰ Ø­Ø§Ø¬Ø© â† <strong style="color: #10B981;">+20 Ù†Ù‚Ø·Ø©</strong> ðŸŽ‰</span>
                    </div>
                    <div class="tn-score-box tn-score-bad">
                        <strong style="color: #EF4444; font-size: 1.1rem;">âŒ ÙƒÙŠ ØªØºÙ„Ø·:</strong><br>
                        <span style="font-size: 1.4rem; color: #EF4444; font-weight: 800;">-10 Ã— Ø§Ù„ÙØ±Ù‚</span><br>
                        <span style="color: var(--text-tertiary);">Ù…Ø«Ø§Ù„: Ù‚Ù„Øª 2 Ùˆ Ø±Ø¨Ø­Øª 5 â† ÙØ±Ù‚ 3 â† <strong style="color: #EF4444;">-30 Ù†Ù‚Ø·Ø©</strong></span><br>
                        <span style="color: var(--text-tertiary);">Ù…Ø«Ø§Ù„: Ù‚Ù„Øª 4 Ùˆ Ø±Ø¨Ø­Øª 1 â† ÙØ±Ù‚ 3 â† <strong style="color: #EF4444;">-30 Ù†Ù‚Ø·Ø©</strong></span>
                    </div>
                </div>

                <div class="tn-section" style="border-right-color: #EF4444;">
                    <h4>ðŸ’€ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ù‚ØµØ§Ø¡</h4>
                    <p>Ø§Ù„Ù„Ø¹Ø¨Ø© ÙÙŠÙ‡Ø§ Ø¥Ù‚ØµØ§Ø¡! ÙÙŠ Ø¬ÙˆÙ„Ø§Øª Ù…Ø¹ÙŠÙ‘Ù†Ø©ØŒ Ø§Ù„Ù„ÙŠ Ø¹Ù†Ø¯Ù‡ <strong>Ø£Ù‚Ù„ Ù†Ù‚Ø§Ø· ÙŠØ·ÙŠØ­</strong>:</p>
                    <table class="tn-table" style="margin-top: 0.5rem;">
                        <tr style="background: rgba(139, 92, 246, 0.1);">
                            <th style="color: var(--text-primary);">Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø¹Ù‘Ø§Ø¨Ø©</th>
                            <th style="color: var(--text-primary);">Ø§Ù„Ø¥Ù‚ØµØ§Ø¡ ÙÙŠ Ø§Ù„Ø¬ÙˆÙ„Ø©</th>
                        </tr>
                        <tr><td>6 Ù„Ø¹Ù‘Ø§Ø¨Ø©</td><td>10ØŒ 12ØŒ 15</td></tr>
                        <tr><td>5 Ù„Ø¹Ù‘Ø§Ø¨Ø©</td><td>12ØŒ 15</td></tr>
                        <tr><td>4 Ù„Ø¹Ù‘Ø§Ø¨Ø©</td><td>15</td></tr>
                        <tr><td>3 Ù„Ø¹Ù‘Ø§Ø¨Ø©</td><td>Ù…Ø§ ÙÙ…Ù‘Ø§Ø´ Ø¥Ù‚ØµØ§Ø¡ âœŒï¸</td></tr>
                    </table>
                    <p style="margin-top: 0.7rem; color: var(--text-tertiary);">ÙÙŠ Ø§Ù„Ø¢Ø®Ø± ÙŠØ¨Ù‚Ø§Ùˆ 3 Ù„Ø¹Ù‘Ø§Ø¨Ø© ÙŠØªÙ†Ø§ÙØ³Ùˆ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©! ðŸ†</p>
                </div>

                <div class="tn-section" style="border-right-color: #EC4899;">
                    <h4>ðŸ§  Ù†ØµØ§Ø¦Ø­ Ø°Ù‡Ø¨ÙŠØ©</h4>
                    <ul>
                        <li style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>Ø§Ù„Ø³Ø§Ø­Ø± â­ = ØªØ±ÙŠÙƒ Ù…Ø¶Ù…ÙˆÙ†</strong> â€” Ø¯ÙŠÙ…Ø§ Ø­Ø³Ø¨Ùˆ ÙÙŠ Ø§Ù„Ù…Ø²Ø§ÙŠØ¯Ø©</li>
                        <li style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>Ø§Ù„Ù€13 ÙÙŠ Ø§Ù„Ø£ØªÙˆ = Ø´Ø¨Ù‡ Ù…Ø¶Ù…ÙˆÙ†</strong> (Ø£ÙƒØ¨Ø± ÙƒØ§Ø±Ø·Ø© ÙÙŠ Ø§Ù„Ù„ÙˆÙ†)</li>
                        <li style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>Ù…Ø§ Ø¹Ù†Ø¯ÙƒØ´ Ù„ÙˆÙ† Ù…Ø¹ÙŠÙ‘Ù†ØŸ</strong> ÙØ±ØµØ© Ø¨Ø§Ø´ ØªØ¶Ø±Ø¨ Ø¨Ø§Ù„Ø£ØªÙˆ!</li>
                        <li style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>ÙƒØ§Ù† Ù…Ø´ Ù…ØªØ£ÙƒØ¯ â† Ù‚ÙˆÙ„ 0</strong> ÙˆØ§Ø±Ø¨Ø­ 20 Ù†Ù‚Ø·Ø© Ø³Ù‡Ù„Ø©</li>
                        <li style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>Ø§Ù„Ù…Ù‡Ø±Ù‘Ø¬ ðŸƒ</strong> Ø§Ø³ØªØ¹Ù…Ù„Ùˆ ÙƒÙŠ Ù…Ø§ ØªØ­Ø¨Ø´ ØªØ±Ø¨Ø­ Ø§Ù„ØªØ±ÙŠÙƒ</li>
                        <li style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>Ø®Ø¨Ù‘ÙŠ Ø§Ù„Ø³Ø§Ø­Ø± â­</strong> Ù„Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø³Ø§Ø³ØŒ Ù…Ø§ ØªÙ„Ø¹Ø¨ÙˆØ´ Ù…Ù† Ø§Ù„Ø£ÙˆÙ„!</li>
                        <li style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>Ø§Ù„Ø¯Ù‚Ø© &gt; Ø§Ù„Ø·Ù…Ø¹!</strong> Ø£Ø­Ø³Ù†Ù„Ùƒ ØªÙ‚ÙˆÙ„ 1 Ùˆ ØªØµÙŠØ¨ (+30) Ø®ÙŠØ± Ù…Ø§ ØªÙ‚ÙˆÙ„ 4 Ùˆ ØªØºÙ„Ø· (-30)</li>
                        <li style="margin-bottom: 0.5rem;">ðŸ’¡ <strong>Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†:</strong> Ø´ÙˆÙ Ø´ÙƒÙˆÙ† Ø­Ø§Ø¨ ÙŠØ±Ø¨Ø­ ÙˆØ´ÙƒÙˆÙ† Ù„Ø§ØŒ ÙˆØ£Ù„Ø¹Ø¨ Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨Ù‡Ù…</li>
                    </ul>
                </div>

                <div class="tn-section tn-summary" style="border-right-color: #06B6D4;">
                    <h4 style="color: #FFD700;">âš¡ Ù…Ù„Ø®Ù‘Øµ Ø³Ø±ÙŠØ¹ â€” Ø¥Ø¨Ø¯Ø§ ØªÙˆ!</h4>
                    <ol style="padding-right: 1.5rem;">
                        <li>ÙƒÙ„ Ø¬ÙˆÙ„Ø© ØªØªÙˆØ²Ù‘Ø¹ ÙƒÙˆØ§Ø±Ø· (Ø¬ÙˆÙ„Ø© 1 = ÙƒØ§Ø±Ø·Ø©ØŒ Ø¬ÙˆÙ„Ø© 2 = 2...)</li>
                        <li>Ù†Ø­Ø¯Ø¯Ùˆ Ø§Ù„Ø£ØªÙˆ (Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù„ÙŠ ÙŠØºÙ„Ø¨)</li>
                        <li>ÙƒÙ„ ÙˆØ§Ø­Ø¯ ÙŠÙ‚ÙˆÙ„ Ù‚Ø¯Ù‘Ø§Ø´ Ù…Ù† ØªØ±ÙŠÙƒ Ø¨Ø§Ø´ ÙŠØ±Ø¨Ø­</li>
                        <li>Ù†Ù„Ø¹Ø¨Ùˆ â€” Ù„Ø§Ø²Ù… ØªØªØ¨Ù‘Ø¹ Ø§Ù„Ù„ÙˆÙ†</li>
                        <li>â­ Ø§Ù„Ø³Ø§Ø­Ø± ÙŠØºÙ„Ø¨ Ø§Ù„ÙƒÙ„ØŒ ðŸƒ Ø§Ù„Ù…Ù‡Ø±Ù‘Ø¬ ÙŠØ®Ø³Ø± Ø¯ÙŠÙ…Ø§</li>
                        <li>ØµØ¨Øª Ø§Ù„ØªÙˆÙ‚Ù‘Ø¹ â† ØªØ±Ø¨Ø­ Ù†Ù‚Ø§Ø· ðŸŽ‰</li>
                        <li>ØºÙ„Ø·Øª â† ØªØ®Ø³Ø± Ù†Ù‚Ø§Ø· ðŸ˜…</li>
                        <li>Ø£ÙƒØ«Ø± Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„Ø¢Ø®Ø± = Ø§Ù„Ø¨Ø·Ù„! ðŸ†</li>
                    </ol>
                </div>

                <button class="tn-got-it" onclick="closeTunisianRules()">
                    âœ… ÙÙ‡Ù…ØªØŒ ÙŠÙ„Ù‘Ø§ Ù†Ù„Ø¹Ø¨Ùˆ!
                </button>
              </div>
            </div>
        </div>

        <!-- Professional Footer -->
        <footer class="footer">
            <div class="designer-signature">
                <span class="designer-label">Made with â¤ï¸ by</span>
                <span class="designer-name">S3MAH</span>
                <span class="designer-title" style="direction: rtl;">ÙƒÙŠ ÙŠØ­Ø· ÙƒØ§Ø±Ø·Ø©â€¦ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© ØªØ³ÙƒØª. ðŸ–¤ðŸ§™â€â™‚ï¸</span>
            </div>
        </footer>

        <!-- Custom Confirmation Modal -->
        <div class="modal-overlay" id="confirmModal">
            <div class="modal">
                <div class="modal-icon modal-icon-warning">âš </div>
                <h3 class="modal-title">Start New Tournament?</h3>
                <p class="modal-text">All current progress will be permanently lost. This action cannot be undone.</p>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-cancel" onclick="closeModal()">Cancel</button>
                    <button class="modal-btn modal-btn-confirm" onclick="confirmReset()">Start New Game</button>
                </div>
            </div>
        </div>

        <!-- Winner Celebration Modal -->
        <div class="modal-overlay" id="winnerModal">
            <div class="modal">
                <div class="modal-icon modal-icon-success">
                    <span class="trophy-icon">ðŸ†</span>
                </div>
                <h3 class="modal-title" id="winnerTitle">VICTORY!</h3>
                <div style="display: flex; flex-direction: column; align-items: center; gap: var(--space-md); margin: var(--space-lg) 0;">
                    <div id="winnerAvatar"></div>
                    <div style="text-align: center;">
                        <p style="font-size: 1.125rem; color: var(--text-secondary); margin-bottom: var(--space-xs);">Tournament Champion</p>
                        <p id="winnerName" style="font-family: 'Orbitron', monospace; font-size: 1.75rem; font-weight: 900; color: var(--text-primary);"></p>
                    </div>
                </div>
                <div class="winner-score-display" id="winnerScore"></div>
                <p class="modal-text" id="winnerMessage">Absolute mastery! Your wizard skills are legendary!</p>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-primary" onclick="closeWinnerModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Elimination Modal -->
        <div class="modal-overlay" id="eliminationModal">
            <div class="modal">
                <div class="modal-icon modal-icon-eliminated">
                    ðŸ’€
                </div>
                <h3 class="elimination-title">ELIMINATED!</h3>
                <div style="display: flex; flex-direction: column; align-items: center; gap: var(--space-md); margin: var(--space-lg) 0;">
                    <div id="eliminatedAvatar"></div>
                    <div style="text-align: center;">
                        <p style="font-size: 1.125rem; color: var(--text-secondary); margin-bottom: var(--space-xs);">Player Disconnected</p>
                        <p id="eliminatedName" style="font-family: 'Orbitron', monospace; font-size: 1.75rem; font-weight: 900; color: var(--danger);"></p>
                    </div>
                </div>
                <div style="font-family: 'Orbitron', monospace; font-size: 1.5rem; font-weight: 700; color: var(--text-muted); text-align: center; margin: var(--space-md) 0;">
                    Round <span id="eliminatedRound"></span> â€¢ Score: <span id="eliminatedScore"></span>
                </div>
                <p class="modal-text glitch-text" id="eliminationMessage">Your wizard has left the building ðŸšª</p>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-primary" onclick="closeEliminationModal()">Continue</button>
                </div>
            </div>
        </div>

        <!-- Professional Duel Tie-Breaker Modal -->
        <div class="modal-overlay" id="duelModal">
            <div class="modal" style="max-width: 95%; max-height: 90vh; overflow-y: auto;">
                <h3 class="modal-title" style="background: linear-gradient(135deg, var(--danger) 0%, var(--warning) 50%, var(--accent) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size: 1.75rem;">
                    TIE-BREAKER DUEL
                </h3>
                <p class="modal-text" style="font-size: 1rem; color: var(--text-secondary); margin: 0.5rem 0;">
                    <span id="duelStoryline">Multiple players tied | Card draw determines elimination</span>
                </p>

                <div class="duel-instruction" id="duelInstruction">
                    Highest card survives | Lowest card eliminated
                </div>

                <div class="duel-container">
                    <div class="duel-players" id="duelPlayers">
                        <!-- Dynamically generated duel cards -->
                    </div>
                </div>

                <div id="duelResults" class="duel-results" style="display: none;">
                    <!-- Results displayed here -->
                </div>

                <div class="modal-buttons" id="duelButtons">
                    <button class="modal-btn modal-btn-primary" onclick="startDuelDraw()">DRAW CARDS</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Professional Audio System ðŸŽµ
        let audioContext;
        let masterVolume = 0.7; // 0.0 to 1.0
        let isMuted = false;

        // Initialize Audio Context (must be after user interaction)
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // Professional Sound Generator
        function playSound(type, options = {}) {
            if (isMuted || !audioContext) return;

            initAudio();
            const now = audioContext.currentTime;

            switch(type) {
                case 'click':
                    playClick(now);
                    break;
                case 'success':
                    playSuccess(now);
                    break;
                case 'error':
                    playError(now);
                    break;
                case 'victory':
                    playVictoryFanfare(now);
                    break;
                case 'elimination':
                    playEliminationSound(now);
                    break;
                case 'whoosh':
                    playWhoosh(now);
                    break;
                case 'chime':
                    playChime(now);
                    break;
                case 'scoreTick':
                    playScoreTick(now);
                    break;
                case 'roundComplete':
                    playRoundComplete(now);
                    break;
                case 'danger':
                    playDangerAlert(now);
                    break;
                case 'duelStart':
                    playDuelStart(now);
                    break;
                case 'cardFlip':
                    playCardFlip(now);
                    break;
                case 'duelVictory':
                    playDuelVictory(now);
                    break;
                case 'lightning':
                    playLightning(now);
                    break;
            }
        }

        // UI Click Sound - Sharp, professional
        function playClick(startTime) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();

            osc.connect(gain);
            gain.connect(audioContext.destination);

            osc.frequency.setValueAtTime(800, startTime);
            gain.gain.setValueAtTime(0.15 * masterVolume, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.05);

            osc.start(startTime);
            osc.stop(startTime + 0.05);
        }

        // Success Sound - Ascending happy notes
        function playSuccess(startTime) {
            const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
            notes.forEach((freq, i) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();

                osc.connect(gain);
                gain.connect(audioContext.destination);

                osc.frequency.setValueAtTime(freq, startTime + i * 0.08);
                osc.type = 'sine';
                gain.gain.setValueAtTime(0.2 * masterVolume, startTime + i * 0.08);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + i * 0.08 + 0.3);

                osc.start(startTime + i * 0.08);
                osc.stop(startTime + i * 0.08 + 0.3);
            });
        }

        // Error Sound - Descending buzz
        function playError(startTime) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();

            osc.connect(gain);
            gain.connect(audioContext.destination);

            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(300, startTime);
            osc.frequency.exponentialRampToValueAtTime(150, startTime + 0.2);
            gain.gain.setValueAtTime(0.2 * masterVolume, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.2);

            osc.start(startTime);
            osc.stop(startTime + 0.2);
        }

        // Epic Victory Fanfare - Triumphant melody
        function playVictoryFanfare(startTime) {
            const melody = [
                { freq: 523.25, duration: 0.2 }, // C5
                { freq: 659.25, duration: 0.2 }, // E5
                { freq: 783.99, duration: 0.2 }, // G5
                { freq: 1046.50, duration: 0.4 }, // C6
                { freq: 783.99, duration: 0.15 }, // G5
                { freq: 1046.50, duration: 0.6 }  // C6 (hold)
            ];

            let time = startTime;
            melody.forEach(note => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();

                osc.connect(gain);
                gain.connect(audioContext.destination);

                osc.type = 'triangle';
                osc.frequency.setValueAtTime(note.freq, time);
                gain.gain.setValueAtTime(0.3 * masterVolume, time);
                gain.gain.exponentialRampToValueAtTime(0.01, time + note.duration);

                osc.start(time);
                osc.stop(time + note.duration);

                time += note.duration;
            });

            // Add bass drum hits
            [0, 0.4, 0.7].forEach(offset => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();

                osc.connect(gain);
                gain.connect(audioContext.destination);

                osc.frequency.setValueAtTime(80, startTime + offset);
                osc.frequency.exponentialRampToValueAtTime(40, startTime + offset + 0.1);
                osc.type = 'sine';
                gain.gain.setValueAtTime(0.4 * masterVolume, startTime + offset);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + offset + 0.1);

                osc.start(startTime + offset);
                osc.stop(startTime + offset + 0.1);
            });
        }

        // Elimination Sound - Dramatic descent
        function playEliminationSound(startTime) {
            // Dramatic descending tone
            const osc1 = audioContext.createOscillator();
            const gain1 = audioContext.createGain();

            osc1.connect(gain1);
            gain1.connect(audioContext.destination);

            osc1.type = 'sawtooth';
            osc1.frequency.setValueAtTime(440, startTime);
            osc1.frequency.exponentialRampToValueAtTime(55, startTime + 0.8);
            gain1.gain.setValueAtTime(0.25 * masterVolume, startTime);
            gain1.gain.exponentialRampToValueAtTime(0.01, startTime + 0.8);

            osc1.start(startTime);
            osc1.stop(startTime + 0.8);

            // Add dramatic hit
            const osc2 = audioContext.createOscillator();
            const gain2 = audioContext.createGain();

            osc2.connect(gain2);
            gain2.connect(audioContext.destination);

            osc2.type = 'sine';
            osc2.frequency.setValueAtTime(100, startTime + 0.5);
            osc2.frequency.exponentialRampToValueAtTime(40, startTime + 0.8);
            gain2.gain.setValueAtTime(0.5 * masterVolume, startTime + 0.5);
            gain2.gain.exponentialRampToValueAtTime(0.01, startTime + 0.8);

            osc2.start(startTime + 0.5);
            osc2.stop(startTime + 0.8);
        }

        // Whoosh Sound - For confetti/particles
        function playWhoosh(startTime) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();

            osc.connect(gain);
            gain.connect(audioContext.destination);

            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(1200, startTime);
            osc.frequency.exponentialRampToValueAtTime(400, startTime + 0.3);
            gain.gain.setValueAtTime(0.15 * masterVolume, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);

            osc.start(startTime);
            osc.stop(startTime + 0.3);
        }

        // Chime Sound - Pleasant notification
        function playChime(startTime) {
            [880, 1108.73, 1318.51].forEach((freq, i) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();

                osc.connect(gain);
                gain.connect(audioContext.destination);

                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, startTime);
                gain.gain.setValueAtTime(0.15 * masterVolume, startTime);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.8);

                osc.start(startTime);
                osc.stop(startTime + 0.8);
            });
        }

        // Score Tick - Quick blip for counting
        function playScoreTick(startTime) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();

            osc.connect(gain);
            gain.connect(audioContext.destination);

            osc.frequency.setValueAtTime(1200, startTime);
            gain.gain.setValueAtTime(0.08 * masterVolume, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.03);

            osc.start(startTime);
            osc.stop(startTime + 0.03);
        }

        // Round Complete - Satisfying completion
        function playRoundComplete(startTime) {
            const notes = [659.25, 783.99, 1046.50]; // E5, G5, C6
            notes.forEach((freq, i) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();

                osc.connect(gain);
                gain.connect(audioContext.destination);

                osc.type = 'triangle';
                osc.frequency.setValueAtTime(freq, startTime + i * 0.1);
                gain.gain.setValueAtTime(0.2 * masterVolume, startTime + i * 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + i * 0.1 + 0.4);

                osc.start(startTime + i * 0.1);
                osc.stop(startTime + i * 0.1 + 0.4);
            });
        }

        // Danger Alert - Warning sound
        function playDangerAlert(startTime) {
            [0, 0.2].forEach(offset => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();

                osc.connect(gain);
                gain.connect(audioContext.destination);

                osc.frequency.setValueAtTime(880, startTime + offset);
                gain.gain.setValueAtTime(0.15 * masterVolume, startTime + offset);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + offset + 0.1);

                osc.start(startTime + offset);
                osc.stop(startTime + offset + 0.1);
            });
        }

        // Duel Start - Epic dramatic intro
        function playDuelStart(startTime) {
            // Deep dramatic chord
            [220, 277.18, 329.63].forEach((freq, i) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();

                osc.connect(gain);
                gain.connect(audioContext.destination);

                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(freq, startTime);
                gain.gain.setValueAtTime(0.2 * masterVolume, startTime);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + 1.5);

                osc.start(startTime);
                osc.stop(startTime + 1.5);
            });

            // Thunder rumble
            const rumble = audioContext.createOscillator();
            const rumbleGain = audioContext.createGain();

            rumble.connect(rumbleGain);
            rumbleGain.connect(audioContext.destination);

            rumble.type = 'sine';
            rumble.frequency.setValueAtTime(60, startTime);
            rumble.frequency.exponentialRampToValueAtTime(40, startTime + 1);
            rumbleGain.gain.setValueAtTime(0.3 * masterVolume, startTime);
            rumbleGain.gain.exponentialRampToValueAtTime(0.01, startTime + 1);

            rumble.start(startTime);
            rumble.stop(startTime + 1);
        }

        // Card Flip - Quick magical flip
        function playCardFlip(startTime) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();

            osc.connect(gain);
            gain.connect(audioContext.destination);

            osc.type = 'sine';
            osc.frequency.setValueAtTime(1200, startTime);
            osc.frequency.exponentialRampToValueAtTime(1800, startTime + 0.1);
            gain.gain.setValueAtTime(0.15 * masterVolume, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.1);

            osc.start(startTime);
            osc.stop(startTime + 0.1);
        }

        // Duel Victory - Triumphant but tense
        function playDuelVictory(startTime) {
            const notes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
            notes.forEach((freq, i) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();

                osc.connect(gain);
                gain.connect(audioContext.destination);

                osc.type = 'triangle';
                osc.frequency.setValueAtTime(freq, startTime + i * 0.15);
                gain.gain.setValueAtTime(0.25 * masterVolume, startTime + i * 0.15);
                gain.gain.exponentialRampToValueAtTime(0.01, startTime + i * 0.15 + 0.4);

                osc.start(startTime + i * 0.15);
                osc.stop(startTime + i * 0.15 + 0.4);
            });
        }

        // Lightning - Electric crackle
        function playLightning(startTime) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();

            osc.connect(gain);
            gain.connect(audioContext.destination);

            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(2000, startTime);
            osc.frequency.exponentialRampToValueAtTime(100, startTime + 0.15);
            gain.gain.setValueAtTime(0.25 * masterVolume, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.15);

            osc.start(startTime);
            osc.stop(startTime + 0.15);
        }

        // Toggle Mute
        function toggleMute() {
            isMuted = !isMuted;
            const btn = document.getElementById('muteBtn');
            if (btn) {
                btn.textContent = isMuted ? 'ðŸ”‡' : 'ðŸ”Š';
                btn.title = isMuted ? 'Unmute' : 'Mute';
            }
            playSound('click');
        }

        // Game State Management
        let gameState = {
            players: [],
            currentRound: 1,
            cardsDealt: 1,
            maxRounds: 20,
            eliminationSchedule: [],
            roundCalculated: false
        };

        // Avatar Color Palettes
        const avatarGradients = [
            ['#8B5CF6', '#EC4899'],  // Purple to Pink
            ['#06B6D4', '#3B82F6'],  // Cyan to Blue
            ['#F59E0B', '#EF4444'],  // Amber to Red
            ['#10B981', '#059669'],  // Green to Emerald
            ['#8B5CF6', '#06B6D4'],  // Purple to Cyan
            ['#EC4899', '#F59E0B'],  // Pink to Amber
            ['#3B82F6', '#10B981'],  // Blue to Green
            ['#EF4444', '#8B5CF6'],  // Red to Purple
            ['#059669', '#06B6D4'],  // Emerald to Cyan
        ];

        // Funny Elimination Messages
        const eliminationMessages = [
            "Mission failed. Better luck next time! ðŸŽ¯",
            "Your wizard has left the building ðŸšª",
            "The cards have spoken... farewell! ðŸƒ",
            "Disconnected from the tournament matrix ðŸ”Œ",
            "Your journey ends here, brave wizard âš”ï¸",
            "The tournament gods have decided ðŸŒ©ï¸",
            "You've been outplayed... literally! ðŸ‘‹",
            "Time to hang up your wizard hat ðŸŽ©",
            "Not today, champion. Not today. âŒ",
            "The elimination train has no brakes! ðŸš‚"
        ];

        // Winner celebration messages
        const winnerMessages = [
            "Absolute mastery! Your wizard skills are legendary!",
            "Flawless victory! You've conquered the tournament!",
            "The prophecy has been fulfilled! Hail the champion!",
            "Unbelievable! You're the ultimate wizard master!",
            "Legendary performance! The cards bow to you!",
            "Supreme excellence! You are the chosen one!",
            "Perfection achieved! All hail the wizard king/queen!"
        ];

        // Professional Duel Messages
        const duelStorylines = [
            "Multiple players tied | Card draw determines elimination",
            "Tie-breaker required | Draw to determine survivor",
            "Equal scores detected | Highest card wins",
            "Tournament rule invoked | Card draw elimination",
            "Tie must be broken | Draw for survival"
        ];

        const duelMessages = {
            instruction: [
                "Highest card survives | Lowest card eliminated",
                "Draw determines fate | High survives, low eliminated",
                "Card values decide | Highest stays, lowest goes",
                "Elimination by draw | Highest card wins"
            ],
            survivor: [
                "SURVIVED | Card value sufficient",
                "CONTINUES | Draw successful",
                "REMAINS | Higher card drawn",
                "SAVED | Superior draw",
                "ADVANCES | Winning card"
            ],
            eliminated: [
                "ELIMINATED | Lowest card drawn",
                "REMOVED | Insufficient card value",
                "OUT | Draw unsuccessful",
                "DISCONNECTED | Lowest value",
                "ELIMINATED | Card too low"
            ]
        };

        // Duel State
        let duelState = {
            players: [],
            cards: {},
            tiedPlayers: [],
            inProgress: false
        };

        // FIXED Round Elimination Schedule (Tournament Style)
        // ALL players play all 20 rounds
        // Eliminate by SCORE at fixed rounds
        // ALL player counts â†’ end with 3 final players
        function generateEliminationSchedule(numPlayers) {
            const schedule = [];

            // Fixed elimination rounds based on player count
            // Pattern: Eliminate player-by-player until 3 final players remain
            switch(numPlayers) {
                case 9:
                    schedule.push(6, 7, 8, 10, 12, 15); // 6 eliminations: 9â†’3
                    break;
                case 8:
                    schedule.push(7, 8, 10, 12, 15); // 5 eliminations: 8â†’3
                    break;
                case 7:
                    schedule.push(8, 10, 12, 15); // 4 eliminations: 7â†’3
                    break;
                case 6:
                    schedule.push(10, 12, 15); // 3 eliminations: 6â†’3
                    break;
                case 5:
                    schedule.push(12, 15); // 2 eliminations: 5â†’3
                    break;
                case 4:
                    schedule.push(15); // 1 elimination: 4â†’3
                    break;
                // 3 or fewer: no eliminations, play all 20 rounds
            }

            return schedule;
        }

        // All games play 20 rounds (standard Wizard)
        function calculateMaxRound(numPlayers) {
            return 20; // ALWAYS 20 rounds
        }

        function getScheduleDescription(numPlayers) {
            const schedule = generateEliminationSchedule(numPlayers);

            if (numPlayers <= 3) {
                return `${numPlayers} players: Play all 20 rounds â€¢ No eliminations`;
            } else {
                return `${numPlayers} players: Eliminate at fixed rounds â†’ Final 3 players play to round 20`;
            }
        }

        // Generate Avatar
        function generateAvatar(name, playerIndex) {
            const initials = name.trim().split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
            const gradient = avatarGradients[playerIndex % avatarGradients.length];
            return {
                initials,
                gradient,
                style: `background: linear-gradient(135deg, ${gradient[0]}, ${gradient[1]});`
            };
        }

        function createAvatarHTML(avatar, sizeClass = '') {
            return `<div class="player-avatar ${sizeClass}" style="${avatar.style}">${avatar.initials}</div>`;
        }

        function changePlayerCount(delta) {
            const input = document.getElementById('numPlayers');
            const currentValue = parseInt(input.value);
            const newValue = currentValue + delta;

            if (newValue >= 2 && newValue <= 9) {
                playSound('click'); // UI click feedback
                input.value = newValue;
                updatePlayerNames();
                updateSchedulePreview();
            } else {
                playSound('error'); // Boundary error
            }
        }

        function updateSchedulePreview() {
            const numPlayers = parseInt(document.getElementById('numPlayers').value);
            const schedule = generateEliminationSchedule(numPlayers);

            document.getElementById('scheduleDesc').textContent = getScheduleDescription(numPlayers);

            const container = document.getElementById('scheduleItems');
            container.innerHTML = '';

            if (schedule.length > 0) {
                let currentPlayers = numPlayers;
                schedule.forEach((round, idx) => {
                    const div = document.createElement('div');
                    div.className = 'schedule-item';
                    div.textContent = `Round ${round}: Eliminate lowest scorer (${currentPlayers} â†’ ${currentPlayers - 1} players)`;
                    container.appendChild(div);
                    currentPlayers--;
                });

                // Show final round info
                const finalDiv = document.createElement('div');
                finalDiv.className = 'schedule-item';
                finalDiv.style.borderLeftColor = 'var(--success)';
                finalDiv.textContent = `Final 3 players: Continue playing rounds ${schedule[schedule.length - 1] + 1}-20`;
                container.appendChild(finalDiv);
            } else {
                const div = document.createElement('div');
                div.className = 'schedule-item';
                div.style.borderLeftColor = 'var(--success)';
                div.textContent = `${numPlayers} players: Play all 20 rounds â€¢ No eliminations`;
                container.appendChild(div);
            }
        }

        function updatePlayerNames() {
            const numPlayers = parseInt(document.getElementById('numPlayers').value);
            const container = document.getElementById('playerNamesContainer');
            container.innerHTML = '';

            for (let i = 0; i < numPlayers; i++) {
                const div = document.createElement('div');
                div.className = 'input-group';
                div.innerHTML = `
                    <label class="input-label">Player ${i + 1}</label>
                    <input type="text" id="player${i}" class="input-field" placeholder="Player ${i + 1}" value="Player ${i + 1}">
                `;
                container.appendChild(div);
            }
        }

        function calculateScore(bid, actual) {
            return bid === actual ? 20 + (10 * actual) : -10 * Math.abs(bid - actual);
        }

        function startGame() {
            initAudio(); // Initialize audio on first user interaction
            playSound('chime'); // Pleasant game start sound

            const numPlayers = parseInt(document.getElementById('numPlayers').value);

            const players = [];
            for (let i = 0; i < numPlayers; i++) {
                const name = document.getElementById(`player${i}`).value.trim() || `Player ${i + 1}`;
                players.push({
                    name,
                    avatar: generateAvatar(name, i),
                    totalScore: 0,
                    eliminated: false,
                    eliminatedOnRound: null,
                    rounds: []
                });
            }

            gameState = {
                players,
                currentRound: 1,
                cardsDealt: 1,
                maxRounds: 20,  // ALL games play 20 rounds
                eliminationSchedule: generateEliminationSchedule(numPlayers),
                roundCalculated: false
            };

            document.getElementById('setupSection').classList.add('hidden');
            document.getElementById('gameSection').classList.remove('hidden');
            document.getElementById('maxRounds').textContent = 20;  // Always 20 rounds
            document.getElementById('gameScheduleDesc').textContent = getScheduleDescription(numPlayers);

            updateStatistics();
            updateNextElimination();
            renderTable();
            updateRoundTotals();
        }

        function updateStatistics() {
            const active = gameState.players.filter(p => !p.eliminated);
            const eliminated = gameState.players.filter(p => p.eliminated);

            document.getElementById('activePlayers').textContent = active.length;
            document.getElementById('eliminatedCount').textContent = eliminated.length;

            if (active.length > 0) {
                const avgScore = Math.round(active.reduce((sum, p) => sum + p.totalScore, 0) / active.length);
                const highScore = Math.max(...active.map(p => p.totalScore));
                const leader = active.find(p => p.totalScore === highScore);

                document.getElementById('avgScore').textContent = avgScore;
                document.getElementById('highScore').textContent = highScore;
                document.getElementById('leaderName').textContent = leader ? leader.name : 'Current Leader';
            }
        }

        function updateNextElimination() {
            const next = gameState.eliminationSchedule.find(r => r > gameState.currentRound - 1);
            const el = document.getElementById('nextElimination');
            const activePlayers = gameState.players.filter(p => !p.eliminated).length;

            if (next) {
                const rounds = next - gameState.currentRound + 1;
                el.textContent = `âš ï¸ Next Elimination: Round ${next} (in ${rounds} ${rounds === 1 ? 'round' : 'rounds'}) â€¢ Lowest scorer will be eliminated`;
                el.style.borderColor = 'var(--danger)';
                el.style.color = 'var(--danger)';
                el.style.background = 'rgba(239, 68, 68, 0.1)';
            } else if (activePlayers === 3) {
                el.innerHTML = '<span style="color: #FFD700;">&#9733;</span> Final 3 Players â€” Play to Round 20!';
                el.style.borderColor = 'var(--success)';
                el.style.color = 'var(--success)';
                el.style.background = 'rgba(16, 185, 129, 0.1)';
            } else {
                el.textContent = `âœ“ No more eliminations â€¢ ${activePlayers} players continue to round 20`;
                el.style.borderColor = 'var(--secondary)';
                el.style.color = 'var(--secondary)';
                el.style.background = 'rgba(6, 182, 212, 0.1)';
            }
        }

        function isNextRoundElimination() {
            return gameState.eliminationSchedule.includes(gameState.currentRound + 1);
        }

        // Create Professional Number Spinner
        function createNumberSpinner(id, disabled = false) {
            return `
                <div class="number-spinner">
                    <button class="spinner-btn" onclick="decrementValue('${id}')" ${disabled ? 'disabled' : ''}>âˆ’</button>
                    <input type="number" class="spinner-input" id="${id}" min="0" placeholder="0" value="0" ${disabled ? 'disabled' : ''} readonly>
                    <button class="spinner-btn" onclick="incrementValue('${id}')" ${disabled ? 'disabled' : ''}>+</button>
                </div>
            `;
        }

        function incrementValue(id) {
            const input = document.getElementById(id);
            if (!input.disabled) {
                playSound('click');
                const currentValue = parseInt(input.value) || 0;
                input.value = currentValue + 1;
                updateRoundTotals();
            }
        }

        function decrementValue(id) {
            const input = document.getElementById(id);
            if (!input.disabled) {
                const currentValue = parseInt(input.value) || 0;
                if (currentValue > 0) {
                    playSound('click');
                    input.value = currentValue - 1;
                    updateRoundTotals();
                } else {
                    playSound('error');
                }
            }
        }

        function updateRoundTotals() {
            const bar = document.getElementById('roundTotalsBar');
            if (!gameState || !gameState.players) return;

            const active = gameState.players.filter(p => !p.eliminated);
            let totalBids = 0, totalActual = 0;

            active.forEach(player => {
                const idx = gameState.players.indexOf(player);
                const bidEl = document.getElementById(`bid${idx}`);
                const actualEl = document.getElementById(`actual${idx}`);
                if (bidEl) totalBids += parseInt(bidEl.value) || 0;
                if (actualEl) totalActual += parseInt(actualEl.value) || 0;
            });

            document.getElementById('totalBids').textContent = totalBids;
            document.getElementById('totalActual').textContent = totalActual;
            document.getElementById('totalTricks').textContent = gameState.currentRound;
            bar.style.display = 'block';
        }

        function renderTable() {
            const tbody = document.getElementById('gameTableBody');
            tbody.innerHTML = '';

            const sorted = [...gameState.players].sort((a, b) => {
                if (a.eliminated && !b.eliminated) return 1;
                if (!a.eliminated && b.eliminated) return -1;
                return b.totalScore - a.totalScore;
            });

            const active = gameState.players.filter(p => !p.eliminated);
            const lowest = active.length > 0 ? Math.min(...active.map(p => p.totalScore)) : 0;
            const isElimNext = isNextRoundElimination();

            sorted.forEach((player, displayIdx) => {
                const originalIdx = gameState.players.indexOf(player);
                const row = document.createElement('tr');

                if (player.eliminated) row.classList.add('eliminated');
                else if (isWinner(player)) row.classList.add('winner');
                else if (isElimNext && player.totalScore === lowest && active.length > 3) row.classList.add('danger-zone');

                let rank = player.eliminated ? 'âœ—' : isWinner(player) ? 'â˜…' : (displayIdx + 1);

                let badge = '';
                if (player.eliminated) {
                    badge = `<span class="badge badge-eliminated">Out R${player.eliminatedOnRound}</span>`;
                } else if (isWinner(player)) {
                    badge = '<span class="badge badge-winner">Winner</span>';
                } else if (isElimNext && player.totalScore === lowest && active.length > 3) {
                    badge = '<span class="badge badge-danger">At Risk</span>';
                } else {
                    badge = '<span class="badge badge-active">Active</span>';
                }

                const lastRound = player.rounds[player.rounds.length - 1];
                const roundScore = lastRound ? lastRound.score : 0;
                const scoreClass = roundScore > 0 ? 'score-positive' : roundScore < 0 ? 'score-negative' : '';

                const isDisabled = player.eliminated || gameState.roundCalculated;

                row.innerHTML = `
                    <td class="rank-display">${rank}</td>
                    <td>
                        <div class="player-name-with-avatar">
                            ${createAvatarHTML(player.avatar)}
                            <span style="font-weight: 700;">${player.name}</span>
                        </div>
                    </td>
                    <td>${badge}</td>
                    <td>${createNumberSpinner('bid' + originalIdx, isDisabled)}</td>
                    <td>${createNumberSpinner('actual' + originalIdx, isDisabled)}</td>
                    <td><span class="score ${scoreClass}" id="roundScore${originalIdx}">${lastRound ? (roundScore >= 0 ? '+' : '') + roundScore : 'â€”'}</span></td>
                    <td><span class="score ${player.totalScore >= 0 ? 'score-positive' : 'score-negative'}">${player.totalScore}</span></td>
                `;
                tbody.appendChild(row);
            });

            document.getElementById('currentRound').textContent = gameState.currentRound;
            document.getElementById('cardsDealt').textContent = gameState.cardsDealt;
        }

        function calculateRound() {
            const active = gameState.players.filter(p => !p.eliminated);
            let valid = true;

            active.forEach(player => {
                const idx = gameState.players.indexOf(player);
                const bid = parseInt(document.getElementById(`bid${idx}`).value);
                const actual = parseInt(document.getElementById(`actual${idx}`).value);

                if (isNaN(bid) || isNaN(actual) || bid < 0 || actual < 0) {
                    valid = false;
                    return;
                }
            });

            if (!valid) {
                playSound('error'); // Error buzz for invalid input
                showAlert('Please enter valid bids and actuals for all active players', 'warning');
                return;
            }

            // Play score ticks as we calculate
            active.forEach((player, index) => {
                const idx = gameState.players.indexOf(player);
                const bid = parseInt(document.getElementById(`bid${idx}`).value);
                const actual = parseInt(document.getElementById(`actual${idx}`).value);
                const score = calculateScore(bid, actual);

                player.rounds.push({ bid, actual, score });
                player.totalScore += score;

                const scoreClass = score > 0 ? 'score-positive' : score < 0 ? 'score-negative' : '';
                document.getElementById(`roundScore${idx}`).textContent = (score >= 0 ? '+' : '') + score;
                document.getElementById(`roundScore${idx}`).className = `score ${scoreClass}`;

                // Play tick sound for each score (staggered)
                setTimeout(() => playSound('scoreTick'), index * 50);
            });

            gameState.roundCalculated = true;
            document.getElementById('calculateBtn').disabled = true;
            document.getElementById('nextRoundBtn').disabled = false;

            // Play success sound after calculation
            setTimeout(() => playSound('roundComplete'), active.length * 50 + 100);

            updateStatistics();
            renderTable();
            updateRoundTotals();
            showAlert('Round calculated successfully', 'success');
        }

        function nextRound() {
            if (gameState.eliminationSchedule.includes(gameState.currentRound)) {
                eliminatePlayer();
            }

            const active = gameState.players.filter(p => !p.eliminated);

            // Check if game should end - ALWAYS play 20 rounds OR only 1 player left
            if (active.length === 1 || gameState.currentRound >= 20) {
                showWinnerCelebration();
                return;
            }

            gameState.currentRound++;
            gameState.cardsDealt++;
            gameState.roundCalculated = false;

            playSound('chime'); // Pleasant chime for new round

            document.getElementById('calculateBtn').disabled = false;
            document.getElementById('nextRoundBtn').disabled = true;

            updateStatistics();
            updateNextElimination();
            renderTable();
            updateRoundTotals();
            showAlert(`Round ${gameState.currentRound} - ${gameState.cardsDealt} cards dealt`, 'info');
        }

        // âš”ï¸ WIZARD'S DUEL TIE-BREAKER SYSTEM âš”ï¸

        // Real playing card system (52 cards)
        const cardSuits = [
            { name: 'hearts', symbol: 'â™¥', color: '#EF4444' },
            { name: 'diamonds', symbol: 'â™¦', color: '#EF4444' },
            { name: 'clubs', symbol: 'â™£', color: '#1E293B' },
            { name: 'spades', symbol: 'â™ ', color: '#1E293B' }
        ];

        const cardRanks = [
            { rank: 'A', value: 14, display: 'A' },  // Ace = highest
            { rank: 'K', value: 13, display: 'K' },
            { rank: 'Q', value: 12, display: 'Q' },
            { rank: 'J', value: 11, display: 'J' },
            { rank: '10', value: 10, display: '10' },
            { rank: '9', value: 9, display: '9' },
            { rank: '8', value: 8, display: '8' },
            { rank: '7', value: 7, display: '7' },
            { rank: '6', value: 6, display: '6' },
            { rank: '5', value: 5, display: '5' },
            { rank: '4', value: 4, display: '4' },
            { rank: '3', value: 3, display: '3' },
            { rank: '2', value: 2, display: '2' }   // 2 = lowest
        ];

        function generateRandomCard() {
            const suitIndex = Math.floor(Math.random() * cardSuits.length);
            const rankIndex = Math.floor(Math.random() * cardRanks.length);

            const suit = cardSuits[suitIndex];
            const rankObj = cardRanks[rankIndex];

            const card = {
                rank: rankObj.rank,
                rankDisplay: rankObj.display,
                suit: suit.name,
                symbol: suit.symbol,
                color: suit.color,
                value: rankObj.value,
                display: `${rankObj.display}${suit.symbol}`
            };

            console.log('Generated card:', card);
            return card;
        }

        function initiateDuel(tiedPlayers) {
            duelState.players = tiedPlayers;
            duelState.cards = {};
            duelState.inProgress = true;

            // Generate random playing card for each player
            tiedPlayers.forEach(player => {
                duelState.cards[player.name] = generateRandomCard();
            });

            showDuelModal();
        }

        function showDuelModal() {
            playSound('duelStart'); // Epic duel intro sound

            const modal = document.getElementById('duelModal');
            const storyline = duelStorylines[Math.floor(Math.random() * duelStorylines.length)];
            const instruction = duelMessages.instruction[Math.floor(Math.random() * duelMessages.instruction.length)];

            document.getElementById('duelStoryline').textContent = storyline;
            document.getElementById('duelInstruction').textContent = instruction;

            // Build duel players UI
            const playersContainer = document.getElementById('duelPlayers');
            playersContainer.innerHTML = '';

            duelState.players.forEach((player, index) => {
                if (index > 0) {
                    const vs = document.createElement('div');
                    vs.className = 'duel-vs';
                    vs.textContent = 'VS';
                    playersContainer.appendChild(vs);
                }

                const playerDiv = document.createElement('div');
                playerDiv.className = 'duel-player';
                playerDiv.id = `duel-player-${index}`;

                // Get card from duelState
                const card = duelState.cards[player.name];

                // Debug: Log card data
                console.log(`${player.name} card:`, card);

                // Safety check - make sure card exists
                if (!card || !card.rank || !card.symbol || !card.color) {
                    console.error(`Invalid card for ${player.name}:`, card);
                    return;
                }

                playerDiv.innerHTML = `
                    <div class="duel-player-info">
                        ${createAvatarHTML(player.avatar, '')}
                        <div class="duel-player-name">${player.name}</div>
                        <div class="duel-player-score">Score: ${player.totalScore}</div>
                    </div>
                    <div class="duel-card drawing" id="duel-card-${index}" data-card-value="${card.value}" data-card-display="${card.display}">
                        <div class="duel-card-back">
                            <div class="duel-card-pattern">
                                <div class="card-back-design">
                                    <div class="card-back-circle"></div>
                                    <div class="card-back-lines"></div>
                                </div>
                            </div>
                        </div>
                        <div class="duel-card-front" id="duel-card-front-${index}">
                            <div class="playing-card-content">
                                <div class="card-corner card-corner-top">
                                    <div class="card-rank" style="color: ${card.color}">${card.rankDisplay}</div>
                                    <div class="card-suit" style="color: ${card.color}">${card.symbol}</div>
                                </div>
                                <div class="card-center">
                                    <div class="card-suit-large" style="color: ${card.color}">${card.symbol}</div>
                                </div>
                                <div class="card-corner card-corner-bottom">
                                    <div class="card-rank" style="color: ${card.color}">${card.rankDisplay}</div>
                                    <div class="card-suit" style="color: ${card.color}">${card.symbol}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                playersContainer.appendChild(playerDiv);
            });

            // Reset button and result
            document.getElementById('duelButtons').innerHTML = `
                <button class="modal-btn modal-btn-primary" onclick="startDuelDraw()">DRAW CARDS</button>
            `;
            document.getElementById('duelResults').style.display = 'none';

            modal.classList.add('active');
        }

        function startDuelDraw() {
            playSound('lightning'); // Electric sound

            // Disable button
            document.getElementById('duelButtons').innerHTML = `
                <button class="modal-btn modal-btn-secondary" disabled>DRAWING...</button>
            `;

            // Reveal cards one by one with dramatic timing
            duelState.players.forEach((player, index) => {
                setTimeout(() => {
                    playSound('cardFlip');
                    const card = document.getElementById(`duel-card-${index}`);
                    card.classList.add('flipped');
                }, index * 800); // Stagger reveals
            });

            // Determine winner after all cards revealed
            setTimeout(() => {
                determineDuelWinner();
            }, duelState.players.length * 800 + 1000);
        }

        function determineDuelWinner() {
            playSound('duelVictory');
            playSound('lightning');

            // Debug: Log all cards before creating results
            console.log('=== DUEL RESULTS ===');
            console.log('All cards in duelState:', duelState.cards);

            // Create array of all players with their card values and index
            const results = duelState.players.map((player, index) => {
                const card = duelState.cards[player.name];
                console.log(`${player.name} (index ${index}): card =`, card, `display = ${card.display}, value = ${card.value}`);
                return {
                    player: player,
                    index: index,
                    card: card,
                    cardValue: card.value
                };
            });

            // Sort by card value (highest to lowest)
            results.sort((a, b) => b.cardValue - a.cardValue);

            console.log('Sorted results:', results.map(r => `${r.player.name}: ${r.card.display} (${r.cardValue})`));

            // Winner = highest card, Loser = lowest card
            const winner = results[0];
            const loser = results[results.length - 1];

            console.log(`Winner: ${winner.player.name} with ${winner.card.display} (value: ${winner.cardValue})`);
            console.log(`Loser: ${loser.player.name} with ${loser.card.display} (value: ${loser.cardValue})`);

            // CHECK FOR TIE: If lowest value players have same value, REDRAW
            const lowestValue = loser.cardValue;
            const tiedForLowest = results.filter(r => r.cardValue === lowestValue);

            if (tiedForLowest.length > 1) {
                console.log(`TIE DETECTED! ${tiedForLowest.length} players with value ${lowestValue}. REDRAWING...`);

                // Show tie message
                const resultDiv = document.getElementById('duelResults');
                let tieHTML = '<div style="font-size: 1rem; color: var(--warning); margin-bottom: 0.5rem; text-align: center; font-weight: 700;">TIE DETECTED - REDRAWING</div>';

                tiedForLowest.forEach(tied => {
                    tieHTML += `
                        <div class="duel-result-item" style="border-color: var(--warning); color: var(--warning); background: rgba(245, 158, 11, 0.15);">
                            ${tied.player.name} drew ${tied.card.display} (Value: ${tied.cardValue}) | TIED - Draw again
                        </div>
                    `;
                });

                resultDiv.innerHTML = tieHTML;
                resultDiv.style.display = 'flex';

                // Update button to REDRAW
                document.getElementById('duelButtons').innerHTML = `
                    <button class="modal-btn modal-btn-primary" onclick="redrawTie()">DRAW AGAIN</button>
                `;

                // Store tied players for redraw
                duelState.tiedPlayers = tiedForLowest.map(t => t.player);
                return; // Stop here, wait for redraw
            }

            // Visual feedback
            setTimeout(() => {
                // Highlight winner in green
                const winnerDiv = document.getElementById(`duel-player-${winner.index}`);
                winnerDiv.classList.add('survivor');

                // Highlight loser in red
                const loserDiv = document.getElementById(`duel-player-${loser.index}`);
                loserDiv.classList.add('eliminated');

                // Show ALL players' results sorted by card value
                const resultDiv = document.getElementById('duelResults');
                const survivorMsg = duelMessages.survivor[Math.floor(Math.random() * duelMessages.survivor.length)];
                const eliminatedMsg = duelMessages.eliminated[Math.floor(Math.random() * duelMessages.eliminated.length)];

                let resultsHTML = '<div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem; text-align: center;">CARD DRAW RESULTS (Highest to Lowest)</div>';

                results.forEach((result, position) => {
                    const isWinner = result.index === winner.index;
                    const isLoser = result.index === loser.index;
                    const statusClass = isWinner ? 'survivor' : (isLoser ? 'eliminated' : '');
                    const statusMsg = isWinner ? survivorMsg : (isLoser ? eliminatedMsg : 'NEUTRAL | Middle value');

                    resultsHTML += `
                        <div class="duel-result-item ${statusClass}" style="${!statusClass ? 'border-color: var(--text-muted); color: var(--text-primary); background: rgba(100, 116, 139, 0.1);' : ''}">
                            ${result.player.name} drew ${result.card.display} (Value: ${result.cardValue}) | ${statusMsg}
                        </div>
                    `;
                });

                resultDiv.innerHTML = resultsHTML;
                resultDiv.style.display = 'flex';

                // Update button - Professional text
                document.getElementById('duelButtons').innerHTML = `
                    <button class="modal-btn modal-btn-primary" onclick="closeDuelModal(${gameState.players.indexOf(loser.player)})">CONTINUE</button>
                `;
            }, 500);
        }

        function redrawTie() {
            console.log('REDRAWING for tied players:', duelState.tiedPlayers.map(p => p.name));

            // Generate new cards for ONLY the tied players
            duelState.tiedPlayers.forEach(player => {
                const newCard = generateRandomCard();
                duelState.cards[player.name] = newCard;
                console.log(`${player.name} new card:`, newCard);
            });

            // Keep ALL original players but only show new cards for tied players
            showDuelModal();
        }

        function closeDuelModal(loserIndex) {
            document.getElementById('duelModal').classList.remove('active');

            duelState.inProgress = false;

            // Eliminate the loser
            const eliminated = gameState.players[loserIndex];
            eliminated.eliminated = true;
            eliminated.eliminatedOnRound = gameState.currentRound;

            // Clear tied players
            duelState.tiedPlayers = [];

            // Show standard elimination modal
            setTimeout(() => {
                showEliminationAnimation(eliminated);
                updateStatistics();
            }, 500);
        }

        function eliminatePlayer() {
            const active = gameState.players.filter(p => !p.eliminated);

            // Always end with 3 final players
            if (active.length <= 3) {
                showAlert('Final 3 players reached! Play to round 20!', 'info');
                return;
            }

            const lowest = Math.min(...active.map(p => p.totalScore));
            const toEliminate = active.filter(p => p.totalScore === lowest);

            // TIE-BREAKER: If multiple players tied (even if ALL tied), trigger DUEL!
            if (toEliminate.length > 1) {
                initiateDuel(toEliminate);
                return;
            }

            // Single player elimination (no tie)
            const eliminated = toEliminate[0];
            eliminated.eliminated = true;
            eliminated.eliminatedOnRound = gameState.currentRound;

            // Show elimination modal with animations
            showEliminationAnimation(eliminated);
            updateStatistics();
        }

        function showEliminationAnimation(player) {
            // ðŸ’€ DRAMATIC ELIMINATION SOUND
            playSound('elimination');

            // Set elimination details
            document.getElementById('eliminatedName').textContent = player.name;
            document.getElementById('eliminatedRound').textContent = player.eliminatedOnRound;
            document.getElementById('eliminatedScore').textContent = player.totalScore;
            document.getElementById('eliminatedAvatar').innerHTML = createAvatarHTML(player.avatar, 'avatar-large eliminated-avatar');

            // Random funny message
            const funnyMessage = eliminationMessages[Math.floor(Math.random() * eliminationMessages.length)];
            document.getElementById('eliminationMessage').textContent = funnyMessage;

            // Show modal
            document.getElementById('eliminationModal').classList.add('active');

            // Launch danger particles
            launchEliminationParticles();
        }

        function launchEliminationParticles() {
            // Emoji explosion particles
            const emojis = ['ðŸ’€', 'âš¡', 'ðŸ’¥', 'ðŸ”¥', 'â˜ ï¸', 'âŒ'];

            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'elimination-particle';
                    particle.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    particle.style.left = '50%';
                    particle.style.top = '50%';

                    const angle = (Math.PI * 2 * i) / 20;
                    const distance = 200 + Math.random() * 200;
                    const tx = Math.cos(angle) * distance;
                    const ty = Math.sin(angle) * distance;

                    particle.style.setProperty('--tx', tx + 'px');
                    particle.style.setProperty('--ty', ty + 'px');

                    document.body.appendChild(particle);

                    setTimeout(() => particle.remove(), 1500);
                }, i * 30);
            }

            // Red danger particles falling
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'danger-particle';
                    particle.style.left = Math.random() * 100 + 'vw';
                    particle.style.top = '-20px';
                    particle.style.setProperty('--drift', (Math.random() * 200 - 100) + 'px');

                    document.body.appendChild(particle);

                    setTimeout(() => particle.remove(), 2000);
                }, i * 40);
            }
        }

        function closeEliminationModal() {
            document.getElementById('eliminationModal').classList.remove('active');
        }

        function isWinner(player) {
            const active = gameState.players.filter(p => !p.eliminated);
            if (active.length === 1 && active[0] === player) return true;

            // Game ends at round 20 - highest scorer wins
            if (gameState.currentRound >= 20 && active.length > 1) {
                return active.sort((a, b) => b.totalScore - a.totalScore)[0] === player;
            }
            return false;
        }

        function showWinnerCelebration() {
            const active = gameState.players.filter(p => !p.eliminated);
            const winner = active.sort((a, b) => b.totalScore - a.totalScore)[0];

            // ðŸŽº EPIC VICTORY FANFARE!!!
            playSound('victory');

            document.getElementById('nextRoundBtn').disabled = true;
            document.getElementById('calculateBtn').disabled = true;

            // Set winner details
            document.getElementById('winnerName').textContent = winner.name;
            document.getElementById('winnerScore').textContent = `${winner.totalScore} Points`;
            document.getElementById('winnerAvatar').innerHTML = createAvatarHTML(winner.avatar, 'avatar-large');

            const randomMessage = winnerMessages[Math.floor(Math.random() * winnerMessages.length)];
            document.getElementById('winnerMessage').textContent = randomMessage;

            // Show modal
            document.getElementById('winnerModal').classList.add('active');

            // Launch confetti with whoosh sound
            launchConfetti();
            playSound('whoosh');

            updateStatistics();
            renderTable();
        }

        function launchConfetti() {
            const colors = ['#8B5CF6', '#06B6D4', '#EC4899', '#F59E0B', '#10B981', '#EF4444', '#FBBF24', '#A78BFA'];
            const emojis = ['ðŸŽ‰', 'â­', 'âœ¨', 'ðŸ†', 'ðŸ‘‘', 'ðŸŽŠ', 'ðŸ’Ž', 'ðŸŒŸ'];

            // Launch 200 colorful confetti pieces
            for (let i = 0; i < 200; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-20px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    confetti.style.width = (Math.random() * 10 + 5) + 'px';
                    confetti.style.height = (Math.random() * 10 + 5) + 'px';

                    // Random shapes
                    if (Math.random() > 0.5) {
                        confetti.style.borderRadius = '0'; // Square
                    }

                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 15);
            }

            // Launch 50 emoji celebration particles
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const emoji = document.createElement('div');
                    emoji.style.position = 'fixed';
                    emoji.style.left = Math.random() * 100 + 'vw';
                    emoji.style.top = '-20px';
                    emoji.style.fontSize = (Math.random() * 20 + 20) + 'px';
                    emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    emoji.style.pointerEvents = 'none';
                    emoji.style.zIndex = '9999';
                    emoji.style.animation = `confettiFall ${Math.random() * 2 + 3}s ease-out forwards`;

                    document.body.appendChild(emoji);
                    setTimeout(() => emoji.remove(), 5000);
                }, i * 40);
            }

            // Launch sparkle explosion from center
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.textContent = 'âœ¨';
                    sparkle.style.position = 'fixed';
                    sparkle.style.left = '50%';
                    sparkle.style.top = '50%';
                    sparkle.style.fontSize = '2rem';
                    sparkle.style.pointerEvents = 'none';
                    sparkle.style.zIndex = '9999';

                    const angle = (Math.PI * 2 * i) / 30;
                    const distance = 150 + Math.random() * 200;
                    const tx = Math.cos(angle) * distance;
                    const ty = Math.sin(angle) * distance;

                    sparkle.style.animation = `sparkleExplode 1.5s ease-out forwards`;
                    sparkle.style.setProperty('--tx', tx + 'px');
                    sparkle.style.setProperty('--ty', ty + 'px');

                    document.body.appendChild(sparkle);
                    setTimeout(() => sparkle.remove(), 1500);
                }, i * 20);
            }
        }

        function closeWinnerModal() {
            document.getElementById('winnerModal').classList.remove('active');
        }

        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            container.innerHTML = '';
            container.appendChild(alert);

            if (type === 'info' || type === 'success') {
                setTimeout(() => alert.remove(), 5000);
            }
        }

        // ===== TUNISIAN RULES MODAL =====
        function openTunisianRules() {
            document.getElementById('tunisianRulesModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            playSound('chime');
        }

        function closeTunisianRules() {
            document.getElementById('tunisianRulesModal').classList.remove('active');
            document.body.style.overflow = '';
            playSound('click');
        }

        // Close on backdrop click
        document.addEventListener('click', function(e) {
            if (e.target.id === 'tunisianRulesModal') {
                closeTunisianRules();
            }
        });

        function resetGame() {
            document.getElementById('confirmModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('confirmModal').classList.remove('active');
        }

        function confirmReset() {
            closeModal();

            // Reset button states to initial
            document.getElementById('calculateBtn').disabled = false;
            document.getElementById('nextRoundBtn').disabled = true;

            // Clear alert container
            document.getElementById('alertContainer').innerHTML = '';

            // Reset game state
            gameState = {
                players: [],
                currentRound: 1,
                cardsDealt: 1,
                maxRounds: 20,  // ALL games play 20 rounds
                eliminationSchedule: [],
                roundCalculated: false
            };

            // Show setup section, hide game section
            document.getElementById('setupSection').classList.remove('hidden');
            document.getElementById('gameSection').classList.add('hidden');
        }

        // Close modal on overlay click
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                closeModal();
                closeWinnerModal();
                closeEliminationModal();
            }
        });

        window.onload = function() {
            updatePlayerNames();
            updateSchedulePreview();
            createInstallButton();  // Show permanent install button
        };

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('[PWA] Service Worker registered successfully:', registration.scope);

                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New service worker available
                                    if (confirm('New version available! Reload to update?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('[PWA] Service Worker registration failed:', error);
                    });
            });
        }

        // PWA Installation Prompt
        let deferredPrompt;
        let installButton;

        // Create PERMANENT install button (always visible)
        function createInstallButton() {
            if (!installButton && !window.matchMedia('(display-mode: standalone)').matches) {
                installButton = document.createElement('button');
                installButton.className = 'btn btn-primary';
                installButton.innerHTML = 'ðŸ“± Install';
                installButton.style.cssText = 'position: fixed; bottom: 20px; right: 20px; z-index: 10000; box-shadow: 0 8px 32px rgba(139, 92, 246, 0.6); animation: pulse 2s ease-in-out infinite;';
                installButton.onclick = async () => {
                    if (deferredPrompt) {
                        // Auto install available
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log(`[PWA] User response: ${outcome}`);

                        if (outcome === 'accepted') {
                            installButton.remove();
                            showAlert('App installed successfully! ðŸŽ‰', 'success');
                        }
                        deferredPrompt = null;
                    } else {
                        // Show manual installation instructions
                        showInstallInstructions();
                    }
                };
                document.body.appendChild(installButton);
            }
        }

        // Show install instructions modal
        function showInstallInstructions() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isAndroid = /Android/.test(navigator.userAgent);

            let instructions = '';
            let title = '';

            if (isIOS) {
                title = 'ðŸ“± Install on iPhone/iPad';
                instructions = `
                    <div style="text-align: left; padding: 1rem;">
                        <p style="margin-bottom: 1rem; color: var(--warning); font-weight: 700;">âš ï¸ You MUST use Safari browser!</p>
                        <ol style="line-height: 2; padding-left: 1.5rem;">
                            <li>Tap the <strong>Share button</strong> <span style="font-size: 1.5rem;">â¬†ï¸</span> at the bottom</li>
                            <li>Scroll and tap <strong>"Add to Home Screen"</strong></li>
                            <li>Tap <strong>"Add"</strong> in top-right corner</li>
                            <li>The app icon appears on your home screen!</li>
                        </ol>
                        <p style="margin-top: 1rem; color: var(--text-tertiary); font-size: 0.875rem;">
                            Note: Other browsers (Chrome, Firefox) cannot install PWAs on iOS.
                        </p>
                    </div>
                `;
            } else if (isAndroid) {
                title = 'ðŸ“± Install on Android';
                instructions = `
                    <div style="text-align: left; padding: 1rem;">
                        <p style="margin-bottom: 1rem; color: var(--secondary); font-weight: 700;">Using Chrome browser:</p>
                        <ol style="line-height: 2; padding-left: 1.5rem;">
                            <li>Tap the <strong>three dots menu</strong> <span style="font-size: 1.5rem;">â‹®</span> (top-right)</li>
                            <li>Tap <strong>"Add to Home screen"</strong> or <strong>"Install app"</strong></li>
                            <li>Tap <strong>"Add"</strong> or <strong>"Install"</strong></li>
                            <li>The app icon appears on your home screen!</li>
                        </ol>
                        <p style="margin-top: 1rem; color: var(--text-tertiary); font-size: 0.875rem;">
                            Works in Chrome, Firefox, Samsung Internet, and Edge browsers.
                        </p>
                    </div>
                `;
            } else {
                title = 'ðŸ’» Install on Desktop';
                instructions = `
                    <div style="text-align: left; padding: 1rem;">
                        <ol style="line-height: 2; padding-left: 1.5rem;">
                            <li>Look for the <strong>install icon</strong> <span style="font-size: 1.5rem;">âŠ•</span> in the address bar</li>
                            <li>Click it and select <strong>"Install"</strong></li>
                            <li>The app opens in its own window!</li>
                        </ol>
                        <p style="margin-top: 1rem; color: var(--text-tertiary); font-size: 0.875rem;">
                            Works in Chrome, Edge, Brave, and Opera browsers.
                        </p>
                    </div>
                `;
            }

            // Create modal
            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-icon" style="background: rgba(139, 92, 246, 0.2); border: 3px solid var(--primary); color: var(--primary); font-size: 3rem;">
                        ðŸ“±
                    </div>
                    <h3 class="modal-title" style="font-size: 1.5rem;">${title}</h3>
                    ${instructions}
                    <div class="modal-buttons">
                        <button class="modal-btn modal-btn-primary" onclick="this.closest('.modal-overlay').remove()">Got it!</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Close on overlay click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('[PWA] Install prompt available');
            e.preventDefault();
            deferredPrompt = e;
        });

        window.addEventListener('appinstalled', () => {
            console.log('[PWA] App installed successfully');
            if (installButton) {
                installButton.remove();
            }
            showAlert('App installed! You can now use it offline.', 'success');
        });

        // Handle online/offline status
        window.addEventListener('online', () => {
            showAlert('Back online!', 'success');
        });

        window.addEventListener('offline', () => {
            showAlert('You are offline. Some features may be limited.', 'warning');
        });
    </script>
</body>
</html>
